function [T,L1Es_V,L1Es_DS00iNa_m,L1Es_DS00iNa_h,L1Es_DS00iNaP_m,L1Es_DS00iNaP_h,L1Es_DS00iDR_n,L1Es_DS02iKS_a,L1Es_DS02iKS_b,L1Es_DS02iHVA_u,L1Es_DS02iHVA_w,L1Es_DS00iKCa_c,L1Es_DS00CaDyn_cai,L1Es_DS00KDyn_ko,L1Es_TW03iH_m,L1Ed_V,L1Ed_DS00iNa_m,L1Ed_DS00iNa_h,L1Ed_DS00iNaP_m,L1Ed_DS00iNaP_h,L1Ed_DS00iDR_n,L1Ed_DS02iKS_a,L1Ed_DS02iKS_b,L1Ed_DS02iHVA_u,L1Ed_DS02iHVA_w,L1Ed_DS00iKCa_c,L1Ed_DS00CaDyn_cai,L1Ed_DS00KDyn_ko,L1Ed_TW03iH_m,L1FS_V,L1FS_DS00iNa_m,L1FS_DS00iNa_h,L1FS_DS00iDR_n,L1FS_DS00KDyn_ko,L1FS_TW03iH_m,L1RSNP_V,L1RSNP_DS00iNa_m,L1RSNP_DS00iNa_h,L1RSNP_DS00iDR_n,L1RSNP_DS00KDyn_ko,L1RSNP_TW03iH_m,L2Es_V,L2Es_DS00iNa_m,L2Es_DS00iNa_h,L2Es_DS00iNaP_m,L2Es_DS00iNaP_h,L2Es_DS00iDR_n,L2Es_DS02iKS_a,L2Es_DS02iKS_b,L2Es_DS02iHVA_u,L2Es_DS02iHVA_w,L2Es_DS00iKCa_c,L2Es_DS00CaDyn_cai,L2Es_DS00KDyn_ko,L2Es_TW03iH_m,L2Ed_V,L2Ed_DS00iNa_m,L2Ed_DS00iNa_h,L2Ed_DS00iNaP_m,L2Ed_DS00iNaP_h,L2Ed_DS00iDR_n,L2Ed_DS02iKS_a,L2Ed_DS02iKS_b,L2Ed_DS02iHVA_u,L2Ed_DS02iHVA_w,L2Ed_DS00iKCa_c,L2Ed_DS00CaDyn_cai,L2Ed_DS00KDyn_ko,L2Ed_TW03iH_m,L2FS_V,L2FS_DS00iNa_m,L2FS_DS00iNa_h,L2FS_DS00iDR_n,L2FS_DS00KDyn_ko,L2FS_TW03iH_m,L1Ed_L1Es_iAMPA_s,L1Ed_L1Es_iNMDA_s,L1FS_L1Es_iAMPA_s,L1FS_L1Es_iNMDA_s,L1Es_L1FS_iGABA_s,L1RSNP_L1Es_iAMPA_s,L1Ed_L1RSNP_iGABA_s,L1FS_L1FS_iGABA_s,L1RSNP_L1RSNP_iGABA_s,L1RSNP_L1FS_iGABA_s,L1FS_L1RSNP_iGABA_s,L2Ed_L2Es_iAMPA_s,L2Ed_L2Es_iNMDA_s,L2FS_L2Es_iAMPA_s,L2FS_L2Es_iNMDA_s,L2Es_L2FS_iGABA_s,L2FS_L2FS_iGABA_s,L2Ed_L1Es_iAMPA_s,L1Ed_input,L1Ed_L1Es_iAMPA_IAMPA,L1Ed_L1Es_iNMDA_BMg,L1Ed_L1Es_iNMDA_INMDA,L1Ed_L1Es_iNMDA_NT,L1Ed_L1RSNP_iGABA_IGABA,L1Es_L1FS_iGABA_IGABA,L1FS_L1Es_iAMPA_IAMPA,L1FS_L1Es_iNMDA_BMg,L1FS_L1Es_iNMDA_INMDA,L1FS_L1Es_iNMDA_NT,L1FS_L1FS_iGABA_IGABA,L1FS_L1RSNP_iGABA_IGABA,L1RSNP_L1Es_iAMPA_IAMPA,L1RSNP_L1FS_iGABA_IGABA,L1RSNP_L1RSNP_iGABA_IGABA,L2Ed_L1Es_iAMPA_IAMPA,L2Ed_L2Es_iAMPA_IAMPA,L2Ed_L2Es_iNMDA_BMg,L2Ed_L2Es_iNMDA_INMDA,L2Ed_L2Es_iNMDA_NT,L2Es_L2FS_iGABA_IGABA,L2FS_L2Es_iAMPA_IAMPA,L2FS_L2Es_iNMDA_BMg,L2FS_L2Es_iNMDA_INMDA,L2FS_L2Es_iNMDA_NT,L2FS_L2FS_iGABA_IGABA,L1Es_DS02iHVA_wtauHVA,L1Ed_sAMPA,L1Ed_DS02iHVA_wtauHVA,L2Es_DS02iHVA_wtauHVA,L2Ed_DS02iHVA_wtauHVA,L1Ed_L1Es_iAMPA_netcon,L1Ed_L1Es_iNMDA_netcon,L1FS_L1Es_iAMPA_netcon,L1FS_L1Es_iNMDA_netcon,L1Es_L1FS_iGABA_netcon,L1RSNP_L1Es_iAMPA_netcon,L1Ed_L1RSNP_iGABA_netcon,L1FS_L1FS_iGABA_netcon,L1RSNP_L1RSNP_iGABA_netcon,L1RSNP_L1FS_iGABA_netcon,L1FS_L1RSNP_iGABA_netcon,L2Ed_L2Es_iAMPA_netcon,L2Ed_L2Es_iNMDA_netcon,L2FS_L2Es_iAMPA_netcon,L2FS_L2Es_iNMDA_netcon,L2Es_L2FS_iGABA_netcon,L2FS_L2FS_iGABA_netcon,L2Ed_L1Es_iAMPA_netcon]=solve_ode
% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
p=load('params.mat','p'); p=p.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);
% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1Es_DS02iHVA_wtauHVA = 420/3;
L1Ed_sAMPA = getPoissonGating(0,p.L1Ed_dcAMPA,0,0,0,p.L1Ed_onset,p.L1Ed_offset,p.L1Ed_tauAMPA,T,p.L1Ed_Npop);
L1Ed_DS02iHVA_wtauHVA = 420/3;
L2Es_DS02iHVA_wtauHVA = 420/3;
L2Ed_DS02iHVA_wtauHVA = 420/3;
L1Ed_L1Es_iAMPA_netcon = [+0.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +0.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +0.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +0.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +0.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +0.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +0.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +0.00000000];
L1Ed_L1Es_iNMDA_netcon = [+0.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +0.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +0.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +0.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +0.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +0.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +0.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +0.00000000];
L1FS_L1Es_iAMPA_netcon =  ones(p.L1Es_Npop,p.L1FS_Npop);
L1FS_L1Es_iNMDA_netcon =  ones(p.L1Es_Npop,p.L1FS_Npop);
L1Es_L1FS_iGABA_netcon =  ones(p.L1FS_Npop,p.L1Es_Npop);
L1RSNP_L1Es_iAMPA_netcon =  ones(p.L1Es_Npop,p.L1RSNP_Npop);
L1Ed_L1RSNP_iGABA_netcon =  ones(p.L1RSNP_Npop,p.L1Ed_Npop);
L1FS_L1FS_iGABA_netcon = +0.00000000;
L1RSNP_L1RSNP_iGABA_netcon = +0.00000000;
L1RSNP_L1FS_iGABA_netcon =  ones(p.L1FS_Npop,p.L1RSNP_Npop);
L1FS_L1RSNP_iGABA_netcon =  ones(p.L1RSNP_Npop,p.L1FS_Npop);
L2Ed_L2Es_iAMPA_netcon = [+0.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +0.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +0.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +0.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +0.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +0.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +0.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +0.00000000];
L2Ed_L2Es_iNMDA_netcon = [+0.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +0.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +0.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +0.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +0.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +0.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +0.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +0.00000000];
L2FS_L2Es_iAMPA_netcon =  ones(p.L2Es_Npop,p.L2FS_Npop);
L2FS_L2Es_iNMDA_netcon =  ones(p.L2Es_Npop,p.L2FS_Npop);
L2Es_L2FS_iGABA_netcon =  ones(p.L2FS_Npop,p.L2Es_Npop);
L2FS_L2FS_iGABA_netcon = [+0.00000000   +1.00000000; +1.00000000   +0.00000000];
L2Ed_L1Es_iAMPA_netcon = [+1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000; +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000   +1.00000000];
% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
% seed the random number generator
rng(p.random_seed);
t=0; k=1;
% STATE_VARIABLES:
L1Es_V = zeros(nsamp,p.L1Es_Npop);
  L1Es_V(1,:) = -65*ones(1,p.L1Es_Npop);
L1Es_DS00iNa_m = zeros(nsamp,p.L1Es_Npop);
  L1Es_DS00iNa_m(1,:) = (((((-.2816*(( ((abs(-65-p.L1Es_DS00iNa_amV0)<p.L1Es_DS00iNa_eps).*p.L1Es_DS00iNa_eps+(abs(-65-p.L1Es_DS00iNa_amV0)>=p.L1Es_DS00iNa_eps).*-65-p.L1Es_DS00iNa_amV0))))./(-1+exp(-(( ((abs(-65-p.L1Es_DS00iNa_amV0)<p.L1Es_DS00iNa_eps).*p.L1Es_DS00iNa_eps+(abs(-65-p.L1Es_DS00iNa_amV0)>=p.L1Es_DS00iNa_eps).*-65-p.L1Es_DS00iNa_amV0)))/9.3))))./((((-.2816*(( ((abs(-65-p.L1Es_DS00iNa_amV0)<p.L1Es_DS00iNa_eps).*p.L1Es_DS00iNa_eps+(abs(-65-p.L1Es_DS00iNa_amV0)>=p.L1Es_DS00iNa_eps).*-65-p.L1Es_DS00iNa_amV0))))./(-1+exp(-(( ((abs(-65-p.L1Es_DS00iNa_amV0)<p.L1Es_DS00iNa_eps).*p.L1Es_DS00iNa_eps+(abs(-65-p.L1Es_DS00iNa_amV0)>=p.L1Es_DS00iNa_eps).*-65-p.L1Es_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(-65-p.L1Es_DS00iNa_bmV0)<p.L1Es_DS00iNa_eps).*p.L1Es_DS00iNa_eps+(abs(-65-p.L1Es_DS00iNa_bmV0)>=p.L1Es_DS00iNa_eps).*-65-p.L1Es_DS00iNa_bmV0))))./(-1+exp((( ((abs(-65-p.L1Es_DS00iNa_bmV0)<p.L1Es_DS00iNa_eps).*p.L1Es_DS00iNa_eps+(abs(-65-p.L1Es_DS00iNa_bmV0)>=p.L1Es_DS00iNa_eps).*-65-p.L1Es_DS00iNa_bmV0)))/6)))))))+p.L1Es_DS00iNa_IC_noise.*rand(1,p.L1Es_Npop);
L1Es_DS00iNa_h = zeros(nsamp,p.L1Es_Npop);
  L1Es_DS00iNa_h(1,:) = ((((p.L1Es_DS00iNa_hnascale.*.098./exp((-65-p.L1Es_DS00iNa_ahV0)/20)))./(((p.L1Es_DS00iNa_hnascale.*.098./exp((-65-p.L1Es_DS00iNa_ahV0)/20)))+((p.L1Es_DS00iNa_hnascale.*1.4./(1+exp(-(-65-p.L1Es_DS00iNa_bhV0)/10)))))))+p.L1Es_DS00iNa_IC_noise.*rand(1,p.L1Es_Npop);
L1Es_DS00iNaP_m = zeros(nsamp,p.L1Es_Npop);
  L1Es_DS00iNaP_m(1,:) = (((((-.2816*(( ((abs(-65+12)<p.L1Es_DS00iNaP_eps).*p.L1Es_DS00iNaP_eps+(abs(-65+12)>=p.L1Es_DS00iNaP_eps).*-65+12))))./(-1+exp(-(( ((abs(-65+12)<p.L1Es_DS00iNaP_eps).*p.L1Es_DS00iNaP_eps+(abs(-65+12)>=p.L1Es_DS00iNaP_eps).*-65+12)))/9.3))))./((((-.2816*(( ((abs(-65+12)<p.L1Es_DS00iNaP_eps).*p.L1Es_DS00iNaP_eps+(abs(-65+12)>=p.L1Es_DS00iNaP_eps).*-65+12))))./(-1+exp(-(( ((abs(-65+12)<p.L1Es_DS00iNaP_eps).*p.L1Es_DS00iNaP_eps+(abs(-65+12)>=p.L1Es_DS00iNaP_eps).*-65+12)))/9.3))))+(((.2464*(( ((abs(-65-15)<p.L1Es_DS00iNaP_eps).*p.L1Es_DS00iNaP_eps+(abs(-65-15)>=p.L1Es_DS00iNaP_eps).*-65-15))))./(-1+exp((( ((abs(-65-15)<p.L1Es_DS00iNaP_eps).*p.L1Es_DS00iNaP_eps+(abs(-65-15)>=p.L1Es_DS00iNaP_eps).*-65-15)))/6)))))))+p.L1Es_DS00iNaP_IC_noise.*rand(1,p.L1Es_Npop);
L1Es_DS00iNaP_h = zeros(nsamp,p.L1Es_Npop);
  L1Es_DS00iNaP_h(1,:) = ((((2.8e-5./exp((-65+42.8477)/4.0248)))./(((2.8e-5./exp((-65+42.8477)/4.0248)))+((.02./(1+exp(-(-65-413.9284)/148.2589)))))))+p.L1Es_DS00iNaP_IC_noise.*rand(1,p.L1Es_Npop);
L1Es_DS00iDR_n = zeros(nsamp,p.L1Es_Npop);
  L1Es_DS00iDR_n(1,:) = ((((-.018*(( ((abs(-65-p.L1Es_DS00iDR_anV0)<p.L1Es_DS00iDR_eps).*p.L1Es_DS00iDR_eps+(abs(-65-p.L1Es_DS00iDR_anV0)>=p.L1Es_DS00iDR_eps).*-65-p.L1Es_DS00iDR_anV0)))./(-1+exp(-(( ((abs(-65-p.L1Es_DS00iDR_anV0)<p.L1Es_DS00iDR_eps).*p.L1Es_DS00iDR_eps+(abs(-65-p.L1Es_DS00iDR_anV0)>=p.L1Es_DS00iDR_eps).*-65-p.L1Es_DS00iDR_anV0)))/25))))./(((-.018*(( ((abs(-65-p.L1Es_DS00iDR_anV0)<p.L1Es_DS00iDR_eps).*p.L1Es_DS00iDR_eps+(abs(-65-p.L1Es_DS00iDR_anV0)>=p.L1Es_DS00iDR_eps).*-65-p.L1Es_DS00iDR_anV0)))./(-1+exp(-(( ((abs(-65-p.L1Es_DS00iDR_anV0)<p.L1Es_DS00iDR_eps).*p.L1Es_DS00iDR_eps+(abs(-65-p.L1Es_DS00iDR_anV0)>=p.L1Es_DS00iDR_eps).*-65-p.L1Es_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(-65-p.L1Es_DS00iDR_bnV0)<p.L1Es_DS00iDR_eps).*p.L1Es_DS00iDR_eps+(abs(-65-p.L1Es_DS00iDR_bnV0)>=p.L1Es_DS00iDR_eps).*-65-p.L1Es_DS00iDR_bnV0)))./(-1+exp((( ((abs(-65-p.L1Es_DS00iDR_bnV0)<p.L1Es_DS00iDR_eps).*p.L1Es_DS00iDR_eps+(abs(-65-p.L1Es_DS00iDR_bnV0)>=p.L1Es_DS00iDR_eps).*-65-p.L1Es_DS00iDR_bnV0)))/12)))))))+p.L1Es_DS00iDR_IC_noise.*rand(1,p.L1Es_Npop);
L1Es_DS02iKS_a = zeros(nsamp,p.L1Es_Npop);
  L1Es_DS02iKS_a(1,:) = ((1./(1+exp(-(-65+34)/6.5))))+p.L1Es_DS02iKS_IC_noise.*rand(1,p.L1Es_Npop);
L1Es_DS02iKS_b = zeros(nsamp,p.L1Es_Npop);
  L1Es_DS02iKS_b(1,:) = ((1./(1+exp((-65+65)/6.6))))+p.L1Es_DS02iKS_IC_noise.*rand(1,p.L1Es_Npop);
L1Es_DS02iHVA_u = zeros(nsamp,p.L1Es_Npop);
  L1Es_DS02iHVA_u(1,:) = ((1./(1+exp(-(-65+24.6)/11.3))))+p.L1Es_DS02iHVA_IC_noise.*rand(1,p.L1Es_Npop);
L1Es_DS02iHVA_w = zeros(nsamp,p.L1Es_Npop);
  L1Es_DS02iHVA_w(1,:) = ((1./(1+exp((-65+12.6)/18.9))))+p.L1Es_DS02iHVA_IC_noise.*rand(1,p.L1Es_Npop);
L1Es_DS00iKCa_c = zeros(nsamp,p.L1Es_Npop);
  L1Es_DS00iKCa_c(1,:) = (((((-0.00642*(( ((abs(((-65+40*log10(.05)))+18)<p.L1Es_DS00iKCa_eps).*p.L1Es_DS00iKCa_eps+(abs(((-65+40*log10(.05)))+18)>=p.L1Es_DS00iKCa_eps).*((-65+40*log10(.05)))+18))))./(-1+exp((( ((abs(((-65+40*log10(.05)))+18)<p.L1Es_DS00iKCa_eps).*p.L1Es_DS00iKCa_eps+(abs(((-65+40*log10(.05)))+18)>=p.L1Es_DS00iKCa_eps).*((-65+40*log10(.05)))+18)))./(-12)))))./((((-0.00642*(( ((abs(((-65+40*log10(.05)))+18)<p.L1Es_DS00iKCa_eps).*p.L1Es_DS00iKCa_eps+(abs(((-65+40*log10(.05)))+18)>=p.L1Es_DS00iKCa_eps).*((-65+40*log10(.05)))+18))))./(-1+exp((( ((abs(((-65+40*log10(.05)))+18)<p.L1Es_DS00iKCa_eps).*p.L1Es_DS00iKCa_eps+(abs(((-65+40*log10(.05)))+18)>=p.L1Es_DS00iKCa_eps).*((-65+40*log10(.05)))+18)))./(-12)))))+((1.7*exp((((-65+40*log10(.05)))+152)./(-30.0)))))))+p.L1Es_DS00iKCa_IC_noise.*rand(1,p.L1Es_Npop);
L1Es_DS00CaDyn_cai = zeros(nsamp,p.L1Es_Npop);
  L1Es_DS00CaDyn_cai(1,:) =  p.L1Es_DS00CaDyn_cainf+p.L1Es_DS00CaDyn_IC_noise.*rand(1,p.L1Es_Npop);
L1Es_DS00KDyn_ko = zeros(nsamp,p.L1Es_Npop);
  L1Es_DS00KDyn_ko(1,:) =  p.L1Es_DS00KDyn_koinf+p.L1Es_DS00KDyn_IC_noise.*rand(1,p.L1Es_Npop);
L1Es_TW03iH_m = zeros(nsamp,p.L1Es_Npop);
  L1Es_TW03iH_m(1,:) =  p.L1Es_TW03iH_IC+p.L1Es_TW03iH_IC_noise.*rand(1,p.L1Es_Npop);
L1Ed_V = zeros(nsamp,p.L1Ed_Npop);
  L1Ed_V(1,:) = -65*ones(1,p.L1Ed_Npop);
L1Ed_DS00iNa_m = zeros(nsamp,p.L1Ed_Npop);
  L1Ed_DS00iNa_m(1,:) = (((((-.2816*(( ((abs(-65-p.L1Ed_DS00iNa_amV0)<p.L1Ed_DS00iNa_eps).*p.L1Ed_DS00iNa_eps+(abs(-65-p.L1Ed_DS00iNa_amV0)>=p.L1Ed_DS00iNa_eps).*-65-p.L1Ed_DS00iNa_amV0))))./(-1+exp(-(( ((abs(-65-p.L1Ed_DS00iNa_amV0)<p.L1Ed_DS00iNa_eps).*p.L1Ed_DS00iNa_eps+(abs(-65-p.L1Ed_DS00iNa_amV0)>=p.L1Ed_DS00iNa_eps).*-65-p.L1Ed_DS00iNa_amV0)))/9.3))))./((((-.2816*(( ((abs(-65-p.L1Ed_DS00iNa_amV0)<p.L1Ed_DS00iNa_eps).*p.L1Ed_DS00iNa_eps+(abs(-65-p.L1Ed_DS00iNa_amV0)>=p.L1Ed_DS00iNa_eps).*-65-p.L1Ed_DS00iNa_amV0))))./(-1+exp(-(( ((abs(-65-p.L1Ed_DS00iNa_amV0)<p.L1Ed_DS00iNa_eps).*p.L1Ed_DS00iNa_eps+(abs(-65-p.L1Ed_DS00iNa_amV0)>=p.L1Ed_DS00iNa_eps).*-65-p.L1Ed_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(-65-p.L1Ed_DS00iNa_bmV0)<p.L1Ed_DS00iNa_eps).*p.L1Ed_DS00iNa_eps+(abs(-65-p.L1Ed_DS00iNa_bmV0)>=p.L1Ed_DS00iNa_eps).*-65-p.L1Ed_DS00iNa_bmV0))))./(-1+exp((( ((abs(-65-p.L1Ed_DS00iNa_bmV0)<p.L1Ed_DS00iNa_eps).*p.L1Ed_DS00iNa_eps+(abs(-65-p.L1Ed_DS00iNa_bmV0)>=p.L1Ed_DS00iNa_eps).*-65-p.L1Ed_DS00iNa_bmV0)))/6)))))))+p.L1Ed_DS00iNa_IC_noise.*rand(1,p.L1Ed_Npop);
L1Ed_DS00iNa_h = zeros(nsamp,p.L1Ed_Npop);
  L1Ed_DS00iNa_h(1,:) = ((((p.L1Ed_DS00iNa_hnascale.*.098./exp((-65-p.L1Ed_DS00iNa_ahV0)/20)))./(((p.L1Ed_DS00iNa_hnascale.*.098./exp((-65-p.L1Ed_DS00iNa_ahV0)/20)))+((p.L1Ed_DS00iNa_hnascale.*1.4./(1+exp(-(-65-p.L1Ed_DS00iNa_bhV0)/10)))))))+p.L1Ed_DS00iNa_IC_noise.*rand(1,p.L1Ed_Npop);
L1Ed_DS00iNaP_m = zeros(nsamp,p.L1Ed_Npop);
  L1Ed_DS00iNaP_m(1,:) = (((((-.2816*(( ((abs(-65+12)<p.L1Ed_DS00iNaP_eps).*p.L1Ed_DS00iNaP_eps+(abs(-65+12)>=p.L1Ed_DS00iNaP_eps).*-65+12))))./(-1+exp(-(( ((abs(-65+12)<p.L1Ed_DS00iNaP_eps).*p.L1Ed_DS00iNaP_eps+(abs(-65+12)>=p.L1Ed_DS00iNaP_eps).*-65+12)))/9.3))))./((((-.2816*(( ((abs(-65+12)<p.L1Ed_DS00iNaP_eps).*p.L1Ed_DS00iNaP_eps+(abs(-65+12)>=p.L1Ed_DS00iNaP_eps).*-65+12))))./(-1+exp(-(( ((abs(-65+12)<p.L1Ed_DS00iNaP_eps).*p.L1Ed_DS00iNaP_eps+(abs(-65+12)>=p.L1Ed_DS00iNaP_eps).*-65+12)))/9.3))))+(((.2464*(( ((abs(-65-15)<p.L1Ed_DS00iNaP_eps).*p.L1Ed_DS00iNaP_eps+(abs(-65-15)>=p.L1Ed_DS00iNaP_eps).*-65-15))))./(-1+exp((( ((abs(-65-15)<p.L1Ed_DS00iNaP_eps).*p.L1Ed_DS00iNaP_eps+(abs(-65-15)>=p.L1Ed_DS00iNaP_eps).*-65-15)))/6)))))))+p.L1Ed_DS00iNaP_IC_noise.*rand(1,p.L1Ed_Npop);
L1Ed_DS00iNaP_h = zeros(nsamp,p.L1Ed_Npop);
  L1Ed_DS00iNaP_h(1,:) = ((((2.8e-5./exp((-65+42.8477)/4.0248)))./(((2.8e-5./exp((-65+42.8477)/4.0248)))+((.02./(1+exp(-(-65-413.9284)/148.2589)))))))+p.L1Ed_DS00iNaP_IC_noise.*rand(1,p.L1Ed_Npop);
L1Ed_DS00iDR_n = zeros(nsamp,p.L1Ed_Npop);
  L1Ed_DS00iDR_n(1,:) = ((((-.018*(( ((abs(-65-p.L1Ed_DS00iDR_anV0)<p.L1Ed_DS00iDR_eps).*p.L1Ed_DS00iDR_eps+(abs(-65-p.L1Ed_DS00iDR_anV0)>=p.L1Ed_DS00iDR_eps).*-65-p.L1Ed_DS00iDR_anV0)))./(-1+exp(-(( ((abs(-65-p.L1Ed_DS00iDR_anV0)<p.L1Ed_DS00iDR_eps).*p.L1Ed_DS00iDR_eps+(abs(-65-p.L1Ed_DS00iDR_anV0)>=p.L1Ed_DS00iDR_eps).*-65-p.L1Ed_DS00iDR_anV0)))/25))))./(((-.018*(( ((abs(-65-p.L1Ed_DS00iDR_anV0)<p.L1Ed_DS00iDR_eps).*p.L1Ed_DS00iDR_eps+(abs(-65-p.L1Ed_DS00iDR_anV0)>=p.L1Ed_DS00iDR_eps).*-65-p.L1Ed_DS00iDR_anV0)))./(-1+exp(-(( ((abs(-65-p.L1Ed_DS00iDR_anV0)<p.L1Ed_DS00iDR_eps).*p.L1Ed_DS00iDR_eps+(abs(-65-p.L1Ed_DS00iDR_anV0)>=p.L1Ed_DS00iDR_eps).*-65-p.L1Ed_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(-65-p.L1Ed_DS00iDR_bnV0)<p.L1Ed_DS00iDR_eps).*p.L1Ed_DS00iDR_eps+(abs(-65-p.L1Ed_DS00iDR_bnV0)>=p.L1Ed_DS00iDR_eps).*-65-p.L1Ed_DS00iDR_bnV0)))./(-1+exp((( ((abs(-65-p.L1Ed_DS00iDR_bnV0)<p.L1Ed_DS00iDR_eps).*p.L1Ed_DS00iDR_eps+(abs(-65-p.L1Ed_DS00iDR_bnV0)>=p.L1Ed_DS00iDR_eps).*-65-p.L1Ed_DS00iDR_bnV0)))/12)))))))+p.L1Ed_DS00iDR_IC_noise.*rand(1,p.L1Ed_Npop);
L1Ed_DS02iKS_a = zeros(nsamp,p.L1Ed_Npop);
  L1Ed_DS02iKS_a(1,:) = ((1./(1+exp(-(-65+34)/6.5))))+p.L1Ed_DS02iKS_IC_noise.*rand(1,p.L1Ed_Npop);
L1Ed_DS02iKS_b = zeros(nsamp,p.L1Ed_Npop);
  L1Ed_DS02iKS_b(1,:) = ((1./(1+exp((-65+65)/6.6))))+p.L1Ed_DS02iKS_IC_noise.*rand(1,p.L1Ed_Npop);
L1Ed_DS02iHVA_u = zeros(nsamp,p.L1Ed_Npop);
  L1Ed_DS02iHVA_u(1,:) = ((1./(1+exp(-(-65+24.6)/11.3))))+p.L1Ed_DS02iHVA_IC_noise.*rand(1,p.L1Ed_Npop);
L1Ed_DS02iHVA_w = zeros(nsamp,p.L1Ed_Npop);
  L1Ed_DS02iHVA_w(1,:) = ((1./(1+exp((-65+12.6)/18.9))))+p.L1Ed_DS02iHVA_IC_noise.*rand(1,p.L1Ed_Npop);
L1Ed_DS00iKCa_c = zeros(nsamp,p.L1Ed_Npop);
  L1Ed_DS00iKCa_c(1,:) = (((((-0.00642*(( ((abs(((-65+40*log10(.05)))+18)<p.L1Ed_DS00iKCa_eps).*p.L1Ed_DS00iKCa_eps+(abs(((-65+40*log10(.05)))+18)>=p.L1Ed_DS00iKCa_eps).*((-65+40*log10(.05)))+18))))./(-1+exp((( ((abs(((-65+40*log10(.05)))+18)<p.L1Ed_DS00iKCa_eps).*p.L1Ed_DS00iKCa_eps+(abs(((-65+40*log10(.05)))+18)>=p.L1Ed_DS00iKCa_eps).*((-65+40*log10(.05)))+18)))./(-12)))))./((((-0.00642*(( ((abs(((-65+40*log10(.05)))+18)<p.L1Ed_DS00iKCa_eps).*p.L1Ed_DS00iKCa_eps+(abs(((-65+40*log10(.05)))+18)>=p.L1Ed_DS00iKCa_eps).*((-65+40*log10(.05)))+18))))./(-1+exp((( ((abs(((-65+40*log10(.05)))+18)<p.L1Ed_DS00iKCa_eps).*p.L1Ed_DS00iKCa_eps+(abs(((-65+40*log10(.05)))+18)>=p.L1Ed_DS00iKCa_eps).*((-65+40*log10(.05)))+18)))./(-12)))))+((1.7*exp((((-65+40*log10(.05)))+152)./(-30.0)))))))+p.L1Ed_DS00iKCa_IC_noise.*rand(1,p.L1Ed_Npop);
L1Ed_DS00CaDyn_cai = zeros(nsamp,p.L1Ed_Npop);
  L1Ed_DS00CaDyn_cai(1,:) =  p.L1Ed_DS00CaDyn_cainf+p.L1Ed_DS00CaDyn_IC_noise.*rand(1,p.L1Ed_Npop);
L1Ed_DS00KDyn_ko = zeros(nsamp,p.L1Ed_Npop);
  L1Ed_DS00KDyn_ko(1,:) =  p.L1Ed_DS00KDyn_koinf+p.L1Ed_DS00KDyn_IC_noise.*rand(1,p.L1Ed_Npop);
L1Ed_TW03iH_m = zeros(nsamp,p.L1Ed_Npop);
  L1Ed_TW03iH_m(1,:) =  p.L1Ed_TW03iH_IC+p.L1Ed_TW03iH_IC_noise.*rand(1,p.L1Ed_Npop);
L1FS_V = zeros(nsamp,p.L1FS_Npop);
  L1FS_V(1,:) = -65*ones(1,p.L1FS_Npop);
L1FS_DS00iNa_m = zeros(nsamp,p.L1FS_Npop);
  L1FS_DS00iNa_m(1,:) = (((((-.2816*(( ((abs(-65-p.L1FS_DS00iNa_amV0)<p.L1FS_DS00iNa_eps).*p.L1FS_DS00iNa_eps+(abs(-65-p.L1FS_DS00iNa_amV0)>=p.L1FS_DS00iNa_eps).*-65-p.L1FS_DS00iNa_amV0))))./(-1+exp(-(( ((abs(-65-p.L1FS_DS00iNa_amV0)<p.L1FS_DS00iNa_eps).*p.L1FS_DS00iNa_eps+(abs(-65-p.L1FS_DS00iNa_amV0)>=p.L1FS_DS00iNa_eps).*-65-p.L1FS_DS00iNa_amV0)))/9.3))))./((((-.2816*(( ((abs(-65-p.L1FS_DS00iNa_amV0)<p.L1FS_DS00iNa_eps).*p.L1FS_DS00iNa_eps+(abs(-65-p.L1FS_DS00iNa_amV0)>=p.L1FS_DS00iNa_eps).*-65-p.L1FS_DS00iNa_amV0))))./(-1+exp(-(( ((abs(-65-p.L1FS_DS00iNa_amV0)<p.L1FS_DS00iNa_eps).*p.L1FS_DS00iNa_eps+(abs(-65-p.L1FS_DS00iNa_amV0)>=p.L1FS_DS00iNa_eps).*-65-p.L1FS_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(-65-p.L1FS_DS00iNa_bmV0)<p.L1FS_DS00iNa_eps).*p.L1FS_DS00iNa_eps+(abs(-65-p.L1FS_DS00iNa_bmV0)>=p.L1FS_DS00iNa_eps).*-65-p.L1FS_DS00iNa_bmV0))))./(-1+exp((( ((abs(-65-p.L1FS_DS00iNa_bmV0)<p.L1FS_DS00iNa_eps).*p.L1FS_DS00iNa_eps+(abs(-65-p.L1FS_DS00iNa_bmV0)>=p.L1FS_DS00iNa_eps).*-65-p.L1FS_DS00iNa_bmV0)))/6)))))))+p.L1FS_DS00iNa_IC_noise.*rand(1,p.L1FS_Npop);
L1FS_DS00iNa_h = zeros(nsamp,p.L1FS_Npop);
  L1FS_DS00iNa_h(1,:) = ((((p.L1FS_DS00iNa_hnascale.*.098./exp((-65-p.L1FS_DS00iNa_ahV0)/20)))./(((p.L1FS_DS00iNa_hnascale.*.098./exp((-65-p.L1FS_DS00iNa_ahV0)/20)))+((p.L1FS_DS00iNa_hnascale.*1.4./(1+exp(-(-65-p.L1FS_DS00iNa_bhV0)/10)))))))+p.L1FS_DS00iNa_IC_noise.*rand(1,p.L1FS_Npop);
L1FS_DS00iDR_n = zeros(nsamp,p.L1FS_Npop);
  L1FS_DS00iDR_n(1,:) = ((((-.018*(( ((abs(-65-p.L1FS_DS00iDR_anV0)<p.L1FS_DS00iDR_eps).*p.L1FS_DS00iDR_eps+(abs(-65-p.L1FS_DS00iDR_anV0)>=p.L1FS_DS00iDR_eps).*-65-p.L1FS_DS00iDR_anV0)))./(-1+exp(-(( ((abs(-65-p.L1FS_DS00iDR_anV0)<p.L1FS_DS00iDR_eps).*p.L1FS_DS00iDR_eps+(abs(-65-p.L1FS_DS00iDR_anV0)>=p.L1FS_DS00iDR_eps).*-65-p.L1FS_DS00iDR_anV0)))/25))))./(((-.018*(( ((abs(-65-p.L1FS_DS00iDR_anV0)<p.L1FS_DS00iDR_eps).*p.L1FS_DS00iDR_eps+(abs(-65-p.L1FS_DS00iDR_anV0)>=p.L1FS_DS00iDR_eps).*-65-p.L1FS_DS00iDR_anV0)))./(-1+exp(-(( ((abs(-65-p.L1FS_DS00iDR_anV0)<p.L1FS_DS00iDR_eps).*p.L1FS_DS00iDR_eps+(abs(-65-p.L1FS_DS00iDR_anV0)>=p.L1FS_DS00iDR_eps).*-65-p.L1FS_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(-65-p.L1FS_DS00iDR_bnV0)<p.L1FS_DS00iDR_eps).*p.L1FS_DS00iDR_eps+(abs(-65-p.L1FS_DS00iDR_bnV0)>=p.L1FS_DS00iDR_eps).*-65-p.L1FS_DS00iDR_bnV0)))./(-1+exp((( ((abs(-65-p.L1FS_DS00iDR_bnV0)<p.L1FS_DS00iDR_eps).*p.L1FS_DS00iDR_eps+(abs(-65-p.L1FS_DS00iDR_bnV0)>=p.L1FS_DS00iDR_eps).*-65-p.L1FS_DS00iDR_bnV0)))/12)))))))+p.L1FS_DS00iDR_IC_noise.*rand(1,p.L1FS_Npop);
L1FS_DS00KDyn_ko = zeros(nsamp,p.L1FS_Npop);
  L1FS_DS00KDyn_ko(1,:) =  p.L1FS_DS00KDyn_koinf+p.L1FS_DS00KDyn_IC_noise.*rand(1,p.L1FS_Npop);
L1FS_TW03iH_m = zeros(nsamp,p.L1FS_Npop);
  L1FS_TW03iH_m(1,:) =  p.L1FS_TW03iH_IC+p.L1FS_TW03iH_IC_noise.*rand(1,p.L1FS_Npop);
L1RSNP_V = zeros(nsamp,p.L1RSNP_Npop);
  L1RSNP_V(1,:) = -65*ones(1,p.L1RSNP_Npop);
L1RSNP_DS00iNa_m = zeros(nsamp,p.L1RSNP_Npop);
  L1RSNP_DS00iNa_m(1,:) = (((((-.2816*(( ((abs(-65-p.L1RSNP_DS00iNa_amV0)<p.L1RSNP_DS00iNa_eps).*p.L1RSNP_DS00iNa_eps+(abs(-65-p.L1RSNP_DS00iNa_amV0)>=p.L1RSNP_DS00iNa_eps).*-65-p.L1RSNP_DS00iNa_amV0))))./(-1+exp(-(( ((abs(-65-p.L1RSNP_DS00iNa_amV0)<p.L1RSNP_DS00iNa_eps).*p.L1RSNP_DS00iNa_eps+(abs(-65-p.L1RSNP_DS00iNa_amV0)>=p.L1RSNP_DS00iNa_eps).*-65-p.L1RSNP_DS00iNa_amV0)))/9.3))))./((((-.2816*(( ((abs(-65-p.L1RSNP_DS00iNa_amV0)<p.L1RSNP_DS00iNa_eps).*p.L1RSNP_DS00iNa_eps+(abs(-65-p.L1RSNP_DS00iNa_amV0)>=p.L1RSNP_DS00iNa_eps).*-65-p.L1RSNP_DS00iNa_amV0))))./(-1+exp(-(( ((abs(-65-p.L1RSNP_DS00iNa_amV0)<p.L1RSNP_DS00iNa_eps).*p.L1RSNP_DS00iNa_eps+(abs(-65-p.L1RSNP_DS00iNa_amV0)>=p.L1RSNP_DS00iNa_eps).*-65-p.L1RSNP_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(-65-p.L1RSNP_DS00iNa_bmV0)<p.L1RSNP_DS00iNa_eps).*p.L1RSNP_DS00iNa_eps+(abs(-65-p.L1RSNP_DS00iNa_bmV0)>=p.L1RSNP_DS00iNa_eps).*-65-p.L1RSNP_DS00iNa_bmV0))))./(-1+exp((( ((abs(-65-p.L1RSNP_DS00iNa_bmV0)<p.L1RSNP_DS00iNa_eps).*p.L1RSNP_DS00iNa_eps+(abs(-65-p.L1RSNP_DS00iNa_bmV0)>=p.L1RSNP_DS00iNa_eps).*-65-p.L1RSNP_DS00iNa_bmV0)))/6)))))))+p.L1RSNP_DS00iNa_IC_noise.*rand(1,p.L1RSNP_Npop);
L1RSNP_DS00iNa_h = zeros(nsamp,p.L1RSNP_Npop);
  L1RSNP_DS00iNa_h(1,:) = ((((p.L1RSNP_DS00iNa_hnascale.*.098./exp((-65-p.L1RSNP_DS00iNa_ahV0)/20)))./(((p.L1RSNP_DS00iNa_hnascale.*.098./exp((-65-p.L1RSNP_DS00iNa_ahV0)/20)))+((p.L1RSNP_DS00iNa_hnascale.*1.4./(1+exp(-(-65-p.L1RSNP_DS00iNa_bhV0)/10)))))))+p.L1RSNP_DS00iNa_IC_noise.*rand(1,p.L1RSNP_Npop);
L1RSNP_DS00iDR_n = zeros(nsamp,p.L1RSNP_Npop);
  L1RSNP_DS00iDR_n(1,:) = ((((-.018*(( ((abs(-65-p.L1RSNP_DS00iDR_anV0)<p.L1RSNP_DS00iDR_eps).*p.L1RSNP_DS00iDR_eps+(abs(-65-p.L1RSNP_DS00iDR_anV0)>=p.L1RSNP_DS00iDR_eps).*-65-p.L1RSNP_DS00iDR_anV0)))./(-1+exp(-(( ((abs(-65-p.L1RSNP_DS00iDR_anV0)<p.L1RSNP_DS00iDR_eps).*p.L1RSNP_DS00iDR_eps+(abs(-65-p.L1RSNP_DS00iDR_anV0)>=p.L1RSNP_DS00iDR_eps).*-65-p.L1RSNP_DS00iDR_anV0)))/25))))./(((-.018*(( ((abs(-65-p.L1RSNP_DS00iDR_anV0)<p.L1RSNP_DS00iDR_eps).*p.L1RSNP_DS00iDR_eps+(abs(-65-p.L1RSNP_DS00iDR_anV0)>=p.L1RSNP_DS00iDR_eps).*-65-p.L1RSNP_DS00iDR_anV0)))./(-1+exp(-(( ((abs(-65-p.L1RSNP_DS00iDR_anV0)<p.L1RSNP_DS00iDR_eps).*p.L1RSNP_DS00iDR_eps+(abs(-65-p.L1RSNP_DS00iDR_anV0)>=p.L1RSNP_DS00iDR_eps).*-65-p.L1RSNP_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(-65-p.L1RSNP_DS00iDR_bnV0)<p.L1RSNP_DS00iDR_eps).*p.L1RSNP_DS00iDR_eps+(abs(-65-p.L1RSNP_DS00iDR_bnV0)>=p.L1RSNP_DS00iDR_eps).*-65-p.L1RSNP_DS00iDR_bnV0)))./(-1+exp((( ((abs(-65-p.L1RSNP_DS00iDR_bnV0)<p.L1RSNP_DS00iDR_eps).*p.L1RSNP_DS00iDR_eps+(abs(-65-p.L1RSNP_DS00iDR_bnV0)>=p.L1RSNP_DS00iDR_eps).*-65-p.L1RSNP_DS00iDR_bnV0)))/12)))))))+p.L1RSNP_DS00iDR_IC_noise.*rand(1,p.L1RSNP_Npop);
L1RSNP_DS00KDyn_ko = zeros(nsamp,p.L1RSNP_Npop);
  L1RSNP_DS00KDyn_ko(1,:) =  p.L1RSNP_DS00KDyn_koinf+p.L1RSNP_DS00KDyn_IC_noise.*rand(1,p.L1RSNP_Npop);
L1RSNP_TW03iH_m = zeros(nsamp,p.L1RSNP_Npop);
  L1RSNP_TW03iH_m(1,:) =  p.L1RSNP_TW03iH_IC+p.L1RSNP_TW03iH_IC_noise.*rand(1,p.L1RSNP_Npop);
L2Es_V = zeros(nsamp,p.L2Es_Npop);
  L2Es_V(1,:) = -65*ones(1,p.L2Es_Npop);
L2Es_DS00iNa_m = zeros(nsamp,p.L2Es_Npop);
  L2Es_DS00iNa_m(1,:) = (((((-.2816*(( ((abs(-65-p.L2Es_DS00iNa_amV0)<p.L2Es_DS00iNa_eps).*p.L2Es_DS00iNa_eps+(abs(-65-p.L2Es_DS00iNa_amV0)>=p.L2Es_DS00iNa_eps).*-65-p.L2Es_DS00iNa_amV0))))./(-1+exp(-(( ((abs(-65-p.L2Es_DS00iNa_amV0)<p.L2Es_DS00iNa_eps).*p.L2Es_DS00iNa_eps+(abs(-65-p.L2Es_DS00iNa_amV0)>=p.L2Es_DS00iNa_eps).*-65-p.L2Es_DS00iNa_amV0)))/9.3))))./((((-.2816*(( ((abs(-65-p.L2Es_DS00iNa_amV0)<p.L2Es_DS00iNa_eps).*p.L2Es_DS00iNa_eps+(abs(-65-p.L2Es_DS00iNa_amV0)>=p.L2Es_DS00iNa_eps).*-65-p.L2Es_DS00iNa_amV0))))./(-1+exp(-(( ((abs(-65-p.L2Es_DS00iNa_amV0)<p.L2Es_DS00iNa_eps).*p.L2Es_DS00iNa_eps+(abs(-65-p.L2Es_DS00iNa_amV0)>=p.L2Es_DS00iNa_eps).*-65-p.L2Es_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(-65-p.L2Es_DS00iNa_bmV0)<p.L2Es_DS00iNa_eps).*p.L2Es_DS00iNa_eps+(abs(-65-p.L2Es_DS00iNa_bmV0)>=p.L2Es_DS00iNa_eps).*-65-p.L2Es_DS00iNa_bmV0))))./(-1+exp((( ((abs(-65-p.L2Es_DS00iNa_bmV0)<p.L2Es_DS00iNa_eps).*p.L2Es_DS00iNa_eps+(abs(-65-p.L2Es_DS00iNa_bmV0)>=p.L2Es_DS00iNa_eps).*-65-p.L2Es_DS00iNa_bmV0)))/6)))))))+p.L2Es_DS00iNa_IC_noise.*rand(1,p.L2Es_Npop);
L2Es_DS00iNa_h = zeros(nsamp,p.L2Es_Npop);
  L2Es_DS00iNa_h(1,:) = ((((p.L2Es_DS00iNa_hnascale.*.098./exp((-65-p.L2Es_DS00iNa_ahV0)/20)))./(((p.L2Es_DS00iNa_hnascale.*.098./exp((-65-p.L2Es_DS00iNa_ahV0)/20)))+((p.L2Es_DS00iNa_hnascale.*1.4./(1+exp(-(-65-p.L2Es_DS00iNa_bhV0)/10)))))))+p.L2Es_DS00iNa_IC_noise.*rand(1,p.L2Es_Npop);
L2Es_DS00iNaP_m = zeros(nsamp,p.L2Es_Npop);
  L2Es_DS00iNaP_m(1,:) = (((((-.2816*(( ((abs(-65+12)<p.L2Es_DS00iNaP_eps).*p.L2Es_DS00iNaP_eps+(abs(-65+12)>=p.L2Es_DS00iNaP_eps).*-65+12))))./(-1+exp(-(( ((abs(-65+12)<p.L2Es_DS00iNaP_eps).*p.L2Es_DS00iNaP_eps+(abs(-65+12)>=p.L2Es_DS00iNaP_eps).*-65+12)))/9.3))))./((((-.2816*(( ((abs(-65+12)<p.L2Es_DS00iNaP_eps).*p.L2Es_DS00iNaP_eps+(abs(-65+12)>=p.L2Es_DS00iNaP_eps).*-65+12))))./(-1+exp(-(( ((abs(-65+12)<p.L2Es_DS00iNaP_eps).*p.L2Es_DS00iNaP_eps+(abs(-65+12)>=p.L2Es_DS00iNaP_eps).*-65+12)))/9.3))))+(((.2464*(( ((abs(-65-15)<p.L2Es_DS00iNaP_eps).*p.L2Es_DS00iNaP_eps+(abs(-65-15)>=p.L2Es_DS00iNaP_eps).*-65-15))))./(-1+exp((( ((abs(-65-15)<p.L2Es_DS00iNaP_eps).*p.L2Es_DS00iNaP_eps+(abs(-65-15)>=p.L2Es_DS00iNaP_eps).*-65-15)))/6)))))))+p.L2Es_DS00iNaP_IC_noise.*rand(1,p.L2Es_Npop);
L2Es_DS00iNaP_h = zeros(nsamp,p.L2Es_Npop);
  L2Es_DS00iNaP_h(1,:) = ((((2.8e-5./exp((-65+42.8477)/4.0248)))./(((2.8e-5./exp((-65+42.8477)/4.0248)))+((.02./(1+exp(-(-65-413.9284)/148.2589)))))))+p.L2Es_DS00iNaP_IC_noise.*rand(1,p.L2Es_Npop);
L2Es_DS00iDR_n = zeros(nsamp,p.L2Es_Npop);
  L2Es_DS00iDR_n(1,:) = ((((-.018*(( ((abs(-65-p.L2Es_DS00iDR_anV0)<p.L2Es_DS00iDR_eps).*p.L2Es_DS00iDR_eps+(abs(-65-p.L2Es_DS00iDR_anV0)>=p.L2Es_DS00iDR_eps).*-65-p.L2Es_DS00iDR_anV0)))./(-1+exp(-(( ((abs(-65-p.L2Es_DS00iDR_anV0)<p.L2Es_DS00iDR_eps).*p.L2Es_DS00iDR_eps+(abs(-65-p.L2Es_DS00iDR_anV0)>=p.L2Es_DS00iDR_eps).*-65-p.L2Es_DS00iDR_anV0)))/25))))./(((-.018*(( ((abs(-65-p.L2Es_DS00iDR_anV0)<p.L2Es_DS00iDR_eps).*p.L2Es_DS00iDR_eps+(abs(-65-p.L2Es_DS00iDR_anV0)>=p.L2Es_DS00iDR_eps).*-65-p.L2Es_DS00iDR_anV0)))./(-1+exp(-(( ((abs(-65-p.L2Es_DS00iDR_anV0)<p.L2Es_DS00iDR_eps).*p.L2Es_DS00iDR_eps+(abs(-65-p.L2Es_DS00iDR_anV0)>=p.L2Es_DS00iDR_eps).*-65-p.L2Es_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(-65-p.L2Es_DS00iDR_bnV0)<p.L2Es_DS00iDR_eps).*p.L2Es_DS00iDR_eps+(abs(-65-p.L2Es_DS00iDR_bnV0)>=p.L2Es_DS00iDR_eps).*-65-p.L2Es_DS00iDR_bnV0)))./(-1+exp((( ((abs(-65-p.L2Es_DS00iDR_bnV0)<p.L2Es_DS00iDR_eps).*p.L2Es_DS00iDR_eps+(abs(-65-p.L2Es_DS00iDR_bnV0)>=p.L2Es_DS00iDR_eps).*-65-p.L2Es_DS00iDR_bnV0)))/12)))))))+p.L2Es_DS00iDR_IC_noise.*rand(1,p.L2Es_Npop);
L2Es_DS02iKS_a = zeros(nsamp,p.L2Es_Npop);
  L2Es_DS02iKS_a(1,:) = ((1./(1+exp(-(-65+34)/6.5))))+p.L2Es_DS02iKS_IC_noise.*rand(1,p.L2Es_Npop);
L2Es_DS02iKS_b = zeros(nsamp,p.L2Es_Npop);
  L2Es_DS02iKS_b(1,:) = ((1./(1+exp((-65+65)/6.6))))+p.L2Es_DS02iKS_IC_noise.*rand(1,p.L2Es_Npop);
L2Es_DS02iHVA_u = zeros(nsamp,p.L2Es_Npop);
  L2Es_DS02iHVA_u(1,:) = ((1./(1+exp(-(-65+24.6)/11.3))))+p.L2Es_DS02iHVA_IC_noise.*rand(1,p.L2Es_Npop);
L2Es_DS02iHVA_w = zeros(nsamp,p.L2Es_Npop);
  L2Es_DS02iHVA_w(1,:) = ((1./(1+exp((-65+12.6)/18.9))))+p.L2Es_DS02iHVA_IC_noise.*rand(1,p.L2Es_Npop);
L2Es_DS00iKCa_c = zeros(nsamp,p.L2Es_Npop);
  L2Es_DS00iKCa_c(1,:) = (((((-0.00642*(( ((abs(((-65+40*log10(.05)))+18)<p.L2Es_DS00iKCa_eps).*p.L2Es_DS00iKCa_eps+(abs(((-65+40*log10(.05)))+18)>=p.L2Es_DS00iKCa_eps).*((-65+40*log10(.05)))+18))))./(-1+exp((( ((abs(((-65+40*log10(.05)))+18)<p.L2Es_DS00iKCa_eps).*p.L2Es_DS00iKCa_eps+(abs(((-65+40*log10(.05)))+18)>=p.L2Es_DS00iKCa_eps).*((-65+40*log10(.05)))+18)))./(-12)))))./((((-0.00642*(( ((abs(((-65+40*log10(.05)))+18)<p.L2Es_DS00iKCa_eps).*p.L2Es_DS00iKCa_eps+(abs(((-65+40*log10(.05)))+18)>=p.L2Es_DS00iKCa_eps).*((-65+40*log10(.05)))+18))))./(-1+exp((( ((abs(((-65+40*log10(.05)))+18)<p.L2Es_DS00iKCa_eps).*p.L2Es_DS00iKCa_eps+(abs(((-65+40*log10(.05)))+18)>=p.L2Es_DS00iKCa_eps).*((-65+40*log10(.05)))+18)))./(-12)))))+((1.7*exp((((-65+40*log10(.05)))+152)./(-30.0)))))))+p.L2Es_DS00iKCa_IC_noise.*rand(1,p.L2Es_Npop);
L2Es_DS00CaDyn_cai = zeros(nsamp,p.L2Es_Npop);
  L2Es_DS00CaDyn_cai(1,:) =  p.L2Es_DS00CaDyn_cainf+p.L2Es_DS00CaDyn_IC_noise.*rand(1,p.L2Es_Npop);
L2Es_DS00KDyn_ko = zeros(nsamp,p.L2Es_Npop);
  L2Es_DS00KDyn_ko(1,:) =  p.L2Es_DS00KDyn_koinf+p.L2Es_DS00KDyn_IC_noise.*rand(1,p.L2Es_Npop);
L2Es_TW03iH_m = zeros(nsamp,p.L2Es_Npop);
  L2Es_TW03iH_m(1,:) =  p.L2Es_TW03iH_IC+p.L2Es_TW03iH_IC_noise.*rand(1,p.L2Es_Npop);
L2Ed_V = zeros(nsamp,p.L2Ed_Npop);
  L2Ed_V(1,:) = -65*ones(1,p.L2Ed_Npop);
L2Ed_DS00iNa_m = zeros(nsamp,p.L2Ed_Npop);
  L2Ed_DS00iNa_m(1,:) = (((((-.2816*(( ((abs(-65-p.L2Ed_DS00iNa_amV0)<p.L2Ed_DS00iNa_eps).*p.L2Ed_DS00iNa_eps+(abs(-65-p.L2Ed_DS00iNa_amV0)>=p.L2Ed_DS00iNa_eps).*-65-p.L2Ed_DS00iNa_amV0))))./(-1+exp(-(( ((abs(-65-p.L2Ed_DS00iNa_amV0)<p.L2Ed_DS00iNa_eps).*p.L2Ed_DS00iNa_eps+(abs(-65-p.L2Ed_DS00iNa_amV0)>=p.L2Ed_DS00iNa_eps).*-65-p.L2Ed_DS00iNa_amV0)))/9.3))))./((((-.2816*(( ((abs(-65-p.L2Ed_DS00iNa_amV0)<p.L2Ed_DS00iNa_eps).*p.L2Ed_DS00iNa_eps+(abs(-65-p.L2Ed_DS00iNa_amV0)>=p.L2Ed_DS00iNa_eps).*-65-p.L2Ed_DS00iNa_amV0))))./(-1+exp(-(( ((abs(-65-p.L2Ed_DS00iNa_amV0)<p.L2Ed_DS00iNa_eps).*p.L2Ed_DS00iNa_eps+(abs(-65-p.L2Ed_DS00iNa_amV0)>=p.L2Ed_DS00iNa_eps).*-65-p.L2Ed_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(-65-p.L2Ed_DS00iNa_bmV0)<p.L2Ed_DS00iNa_eps).*p.L2Ed_DS00iNa_eps+(abs(-65-p.L2Ed_DS00iNa_bmV0)>=p.L2Ed_DS00iNa_eps).*-65-p.L2Ed_DS00iNa_bmV0))))./(-1+exp((( ((abs(-65-p.L2Ed_DS00iNa_bmV0)<p.L2Ed_DS00iNa_eps).*p.L2Ed_DS00iNa_eps+(abs(-65-p.L2Ed_DS00iNa_bmV0)>=p.L2Ed_DS00iNa_eps).*-65-p.L2Ed_DS00iNa_bmV0)))/6)))))))+p.L2Ed_DS00iNa_IC_noise.*rand(1,p.L2Ed_Npop);
L2Ed_DS00iNa_h = zeros(nsamp,p.L2Ed_Npop);
  L2Ed_DS00iNa_h(1,:) = ((((p.L2Ed_DS00iNa_hnascale.*.098./exp((-65-p.L2Ed_DS00iNa_ahV0)/20)))./(((p.L2Ed_DS00iNa_hnascale.*.098./exp((-65-p.L2Ed_DS00iNa_ahV0)/20)))+((p.L2Ed_DS00iNa_hnascale.*1.4./(1+exp(-(-65-p.L2Ed_DS00iNa_bhV0)/10)))))))+p.L2Ed_DS00iNa_IC_noise.*rand(1,p.L2Ed_Npop);
L2Ed_DS00iNaP_m = zeros(nsamp,p.L2Ed_Npop);
  L2Ed_DS00iNaP_m(1,:) = (((((-.2816*(( ((abs(-65+12)<p.L2Ed_DS00iNaP_eps).*p.L2Ed_DS00iNaP_eps+(abs(-65+12)>=p.L2Ed_DS00iNaP_eps).*-65+12))))./(-1+exp(-(( ((abs(-65+12)<p.L2Ed_DS00iNaP_eps).*p.L2Ed_DS00iNaP_eps+(abs(-65+12)>=p.L2Ed_DS00iNaP_eps).*-65+12)))/9.3))))./((((-.2816*(( ((abs(-65+12)<p.L2Ed_DS00iNaP_eps).*p.L2Ed_DS00iNaP_eps+(abs(-65+12)>=p.L2Ed_DS00iNaP_eps).*-65+12))))./(-1+exp(-(( ((abs(-65+12)<p.L2Ed_DS00iNaP_eps).*p.L2Ed_DS00iNaP_eps+(abs(-65+12)>=p.L2Ed_DS00iNaP_eps).*-65+12)))/9.3))))+(((.2464*(( ((abs(-65-15)<p.L2Ed_DS00iNaP_eps).*p.L2Ed_DS00iNaP_eps+(abs(-65-15)>=p.L2Ed_DS00iNaP_eps).*-65-15))))./(-1+exp((( ((abs(-65-15)<p.L2Ed_DS00iNaP_eps).*p.L2Ed_DS00iNaP_eps+(abs(-65-15)>=p.L2Ed_DS00iNaP_eps).*-65-15)))/6)))))))+p.L2Ed_DS00iNaP_IC_noise.*rand(1,p.L2Ed_Npop);
L2Ed_DS00iNaP_h = zeros(nsamp,p.L2Ed_Npop);
  L2Ed_DS00iNaP_h(1,:) = ((((2.8e-5./exp((-65+42.8477)/4.0248)))./(((2.8e-5./exp((-65+42.8477)/4.0248)))+((.02./(1+exp(-(-65-413.9284)/148.2589)))))))+p.L2Ed_DS00iNaP_IC_noise.*rand(1,p.L2Ed_Npop);
L2Ed_DS00iDR_n = zeros(nsamp,p.L2Ed_Npop);
  L2Ed_DS00iDR_n(1,:) = ((((-.018*(( ((abs(-65-p.L2Ed_DS00iDR_anV0)<p.L2Ed_DS00iDR_eps).*p.L2Ed_DS00iDR_eps+(abs(-65-p.L2Ed_DS00iDR_anV0)>=p.L2Ed_DS00iDR_eps).*-65-p.L2Ed_DS00iDR_anV0)))./(-1+exp(-(( ((abs(-65-p.L2Ed_DS00iDR_anV0)<p.L2Ed_DS00iDR_eps).*p.L2Ed_DS00iDR_eps+(abs(-65-p.L2Ed_DS00iDR_anV0)>=p.L2Ed_DS00iDR_eps).*-65-p.L2Ed_DS00iDR_anV0)))/25))))./(((-.018*(( ((abs(-65-p.L2Ed_DS00iDR_anV0)<p.L2Ed_DS00iDR_eps).*p.L2Ed_DS00iDR_eps+(abs(-65-p.L2Ed_DS00iDR_anV0)>=p.L2Ed_DS00iDR_eps).*-65-p.L2Ed_DS00iDR_anV0)))./(-1+exp(-(( ((abs(-65-p.L2Ed_DS00iDR_anV0)<p.L2Ed_DS00iDR_eps).*p.L2Ed_DS00iDR_eps+(abs(-65-p.L2Ed_DS00iDR_anV0)>=p.L2Ed_DS00iDR_eps).*-65-p.L2Ed_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(-65-p.L2Ed_DS00iDR_bnV0)<p.L2Ed_DS00iDR_eps).*p.L2Ed_DS00iDR_eps+(abs(-65-p.L2Ed_DS00iDR_bnV0)>=p.L2Ed_DS00iDR_eps).*-65-p.L2Ed_DS00iDR_bnV0)))./(-1+exp((( ((abs(-65-p.L2Ed_DS00iDR_bnV0)<p.L2Ed_DS00iDR_eps).*p.L2Ed_DS00iDR_eps+(abs(-65-p.L2Ed_DS00iDR_bnV0)>=p.L2Ed_DS00iDR_eps).*-65-p.L2Ed_DS00iDR_bnV0)))/12)))))))+p.L2Ed_DS00iDR_IC_noise.*rand(1,p.L2Ed_Npop);
L2Ed_DS02iKS_a = zeros(nsamp,p.L2Ed_Npop);
  L2Ed_DS02iKS_a(1,:) = ((1./(1+exp(-(-65+34)/6.5))))+p.L2Ed_DS02iKS_IC_noise.*rand(1,p.L2Ed_Npop);
L2Ed_DS02iKS_b = zeros(nsamp,p.L2Ed_Npop);
  L2Ed_DS02iKS_b(1,:) = ((1./(1+exp((-65+65)/6.6))))+p.L2Ed_DS02iKS_IC_noise.*rand(1,p.L2Ed_Npop);
L2Ed_DS02iHVA_u = zeros(nsamp,p.L2Ed_Npop);
  L2Ed_DS02iHVA_u(1,:) = ((1./(1+exp(-(-65+24.6)/11.3))))+p.L2Ed_DS02iHVA_IC_noise.*rand(1,p.L2Ed_Npop);
L2Ed_DS02iHVA_w = zeros(nsamp,p.L2Ed_Npop);
  L2Ed_DS02iHVA_w(1,:) = ((1./(1+exp((-65+12.6)/18.9))))+p.L2Ed_DS02iHVA_IC_noise.*rand(1,p.L2Ed_Npop);
L2Ed_DS00iKCa_c = zeros(nsamp,p.L2Ed_Npop);
  L2Ed_DS00iKCa_c(1,:) = (((((-0.00642*(( ((abs(((-65+40*log10(.05)))+18)<p.L2Ed_DS00iKCa_eps).*p.L2Ed_DS00iKCa_eps+(abs(((-65+40*log10(.05)))+18)>=p.L2Ed_DS00iKCa_eps).*((-65+40*log10(.05)))+18))))./(-1+exp((( ((abs(((-65+40*log10(.05)))+18)<p.L2Ed_DS00iKCa_eps).*p.L2Ed_DS00iKCa_eps+(abs(((-65+40*log10(.05)))+18)>=p.L2Ed_DS00iKCa_eps).*((-65+40*log10(.05)))+18)))./(-12)))))./((((-0.00642*(( ((abs(((-65+40*log10(.05)))+18)<p.L2Ed_DS00iKCa_eps).*p.L2Ed_DS00iKCa_eps+(abs(((-65+40*log10(.05)))+18)>=p.L2Ed_DS00iKCa_eps).*((-65+40*log10(.05)))+18))))./(-1+exp((( ((abs(((-65+40*log10(.05)))+18)<p.L2Ed_DS00iKCa_eps).*p.L2Ed_DS00iKCa_eps+(abs(((-65+40*log10(.05)))+18)>=p.L2Ed_DS00iKCa_eps).*((-65+40*log10(.05)))+18)))./(-12)))))+((1.7*exp((((-65+40*log10(.05)))+152)./(-30.0)))))))+p.L2Ed_DS00iKCa_IC_noise.*rand(1,p.L2Ed_Npop);
L2Ed_DS00CaDyn_cai = zeros(nsamp,p.L2Ed_Npop);
  L2Ed_DS00CaDyn_cai(1,:) =  p.L2Ed_DS00CaDyn_cainf+p.L2Ed_DS00CaDyn_IC_noise.*rand(1,p.L2Ed_Npop);
L2Ed_DS00KDyn_ko = zeros(nsamp,p.L2Ed_Npop);
  L2Ed_DS00KDyn_ko(1,:) =  p.L2Ed_DS00KDyn_koinf+p.L2Ed_DS00KDyn_IC_noise.*rand(1,p.L2Ed_Npop);
L2Ed_TW03iH_m = zeros(nsamp,p.L2Ed_Npop);
  L2Ed_TW03iH_m(1,:) =  p.L2Ed_TW03iH_IC+p.L2Ed_TW03iH_IC_noise.*rand(1,p.L2Ed_Npop);
L2FS_V = zeros(nsamp,p.L2FS_Npop);
  L2FS_V(1,:) = -65*ones(1,p.L2FS_Npop);
L2FS_DS00iNa_m = zeros(nsamp,p.L2FS_Npop);
  L2FS_DS00iNa_m(1,:) = (((((-.2816*(( ((abs(-65-p.L2FS_DS00iNa_amV0)<p.L2FS_DS00iNa_eps).*p.L2FS_DS00iNa_eps+(abs(-65-p.L2FS_DS00iNa_amV0)>=p.L2FS_DS00iNa_eps).*-65-p.L2FS_DS00iNa_amV0))))./(-1+exp(-(( ((abs(-65-p.L2FS_DS00iNa_amV0)<p.L2FS_DS00iNa_eps).*p.L2FS_DS00iNa_eps+(abs(-65-p.L2FS_DS00iNa_amV0)>=p.L2FS_DS00iNa_eps).*-65-p.L2FS_DS00iNa_amV0)))/9.3))))./((((-.2816*(( ((abs(-65-p.L2FS_DS00iNa_amV0)<p.L2FS_DS00iNa_eps).*p.L2FS_DS00iNa_eps+(abs(-65-p.L2FS_DS00iNa_amV0)>=p.L2FS_DS00iNa_eps).*-65-p.L2FS_DS00iNa_amV0))))./(-1+exp(-(( ((abs(-65-p.L2FS_DS00iNa_amV0)<p.L2FS_DS00iNa_eps).*p.L2FS_DS00iNa_eps+(abs(-65-p.L2FS_DS00iNa_amV0)>=p.L2FS_DS00iNa_eps).*-65-p.L2FS_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(-65-p.L2FS_DS00iNa_bmV0)<p.L2FS_DS00iNa_eps).*p.L2FS_DS00iNa_eps+(abs(-65-p.L2FS_DS00iNa_bmV0)>=p.L2FS_DS00iNa_eps).*-65-p.L2FS_DS00iNa_bmV0))))./(-1+exp((( ((abs(-65-p.L2FS_DS00iNa_bmV0)<p.L2FS_DS00iNa_eps).*p.L2FS_DS00iNa_eps+(abs(-65-p.L2FS_DS00iNa_bmV0)>=p.L2FS_DS00iNa_eps).*-65-p.L2FS_DS00iNa_bmV0)))/6)))))))+p.L2FS_DS00iNa_IC_noise.*rand(1,p.L2FS_Npop);
L2FS_DS00iNa_h = zeros(nsamp,p.L2FS_Npop);
  L2FS_DS00iNa_h(1,:) = ((((p.L2FS_DS00iNa_hnascale.*.098./exp((-65-p.L2FS_DS00iNa_ahV0)/20)))./(((p.L2FS_DS00iNa_hnascale.*.098./exp((-65-p.L2FS_DS00iNa_ahV0)/20)))+((p.L2FS_DS00iNa_hnascale.*1.4./(1+exp(-(-65-p.L2FS_DS00iNa_bhV0)/10)))))))+p.L2FS_DS00iNa_IC_noise.*rand(1,p.L2FS_Npop);
L2FS_DS00iDR_n = zeros(nsamp,p.L2FS_Npop);
  L2FS_DS00iDR_n(1,:) = ((((-.018*(( ((abs(-65-p.L2FS_DS00iDR_anV0)<p.L2FS_DS00iDR_eps).*p.L2FS_DS00iDR_eps+(abs(-65-p.L2FS_DS00iDR_anV0)>=p.L2FS_DS00iDR_eps).*-65-p.L2FS_DS00iDR_anV0)))./(-1+exp(-(( ((abs(-65-p.L2FS_DS00iDR_anV0)<p.L2FS_DS00iDR_eps).*p.L2FS_DS00iDR_eps+(abs(-65-p.L2FS_DS00iDR_anV0)>=p.L2FS_DS00iDR_eps).*-65-p.L2FS_DS00iDR_anV0)))/25))))./(((-.018*(( ((abs(-65-p.L2FS_DS00iDR_anV0)<p.L2FS_DS00iDR_eps).*p.L2FS_DS00iDR_eps+(abs(-65-p.L2FS_DS00iDR_anV0)>=p.L2FS_DS00iDR_eps).*-65-p.L2FS_DS00iDR_anV0)))./(-1+exp(-(( ((abs(-65-p.L2FS_DS00iDR_anV0)<p.L2FS_DS00iDR_eps).*p.L2FS_DS00iDR_eps+(abs(-65-p.L2FS_DS00iDR_anV0)>=p.L2FS_DS00iDR_eps).*-65-p.L2FS_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(-65-p.L2FS_DS00iDR_bnV0)<p.L2FS_DS00iDR_eps).*p.L2FS_DS00iDR_eps+(abs(-65-p.L2FS_DS00iDR_bnV0)>=p.L2FS_DS00iDR_eps).*-65-p.L2FS_DS00iDR_bnV0)))./(-1+exp((( ((abs(-65-p.L2FS_DS00iDR_bnV0)<p.L2FS_DS00iDR_eps).*p.L2FS_DS00iDR_eps+(abs(-65-p.L2FS_DS00iDR_bnV0)>=p.L2FS_DS00iDR_eps).*-65-p.L2FS_DS00iDR_bnV0)))/12)))))))+p.L2FS_DS00iDR_IC_noise.*rand(1,p.L2FS_Npop);
L2FS_DS00KDyn_ko = zeros(nsamp,p.L2FS_Npop);
  L2FS_DS00KDyn_ko(1,:) =  p.L2FS_DS00KDyn_koinf+p.L2FS_DS00KDyn_IC_noise.*rand(1,p.L2FS_Npop);
L2FS_TW03iH_m = zeros(nsamp,p.L2FS_Npop);
  L2FS_TW03iH_m(1,:) =  p.L2FS_TW03iH_IC+p.L2FS_TW03iH_IC_noise.*rand(1,p.L2FS_Npop);
L1Ed_L1Es_iAMPA_s = zeros(nsamp,p.L1Es_Npop);
  L1Ed_L1Es_iAMPA_s(1,:) =  p.L1Ed_L1Es_iAMPA_IC+p.L1Ed_L1Es_iAMPA_IC_noise.*rand(1,p.L1Es_Npop);
L1Ed_L1Es_iNMDA_s = zeros(nsamp,p.L1Es_Npop);
  L1Ed_L1Es_iNMDA_s(1,:) =  p.L1Ed_L1Es_iNMDA_IC+p.L1Ed_L1Es_iNMDA_IC_noise*rand(1,p.L1Es_Npop);
L1FS_L1Es_iAMPA_s = zeros(nsamp,p.L1Es_Npop);
  L1FS_L1Es_iAMPA_s(1,:) =  p.L1FS_L1Es_iAMPA_IC+p.L1FS_L1Es_iAMPA_IC_noise.*rand(1,p.L1Es_Npop);
L1FS_L1Es_iNMDA_s = zeros(nsamp,p.L1Es_Npop);
  L1FS_L1Es_iNMDA_s(1,:) =  p.L1FS_L1Es_iNMDA_IC+p.L1FS_L1Es_iNMDA_IC_noise*rand(1,p.L1Es_Npop);
L1Es_L1FS_iGABA_s = zeros(nsamp,p.L1FS_Npop);
  L1Es_L1FS_iGABA_s(1,:) =  p.L1Es_L1FS_iGABA_IC+p.L1Es_L1FS_iGABA_IC_noise.*rand(1,p.L1FS_Npop);
L1RSNP_L1Es_iAMPA_s = zeros(nsamp,p.L1Es_Npop);
  L1RSNP_L1Es_iAMPA_s(1,:) =  p.L1RSNP_L1Es_iAMPA_IC+p.L1RSNP_L1Es_iAMPA_IC_noise.*rand(1,p.L1Es_Npop);
L1Ed_L1RSNP_iGABA_s = zeros(nsamp,p.L1RSNP_Npop);
  L1Ed_L1RSNP_iGABA_s(1,:) =  p.L1Ed_L1RSNP_iGABA_IC+p.L1Ed_L1RSNP_iGABA_IC_noise.*rand(1,p.L1RSNP_Npop);
L1FS_L1FS_iGABA_s = zeros(nsamp,p.L1FS_Npop);
  L1FS_L1FS_iGABA_s(1,:) =  p.L1FS_L1FS_iGABA_IC+p.L1FS_L1FS_iGABA_IC_noise.*rand(1,p.L1FS_Npop);
L1RSNP_L1RSNP_iGABA_s = zeros(nsamp,p.L1RSNP_Npop);
  L1RSNP_L1RSNP_iGABA_s(1,:) =  p.L1RSNP_L1RSNP_iGABA_IC+p.L1RSNP_L1RSNP_iGABA_IC_noise.*rand(1,p.L1RSNP_Npop);
L1RSNP_L1FS_iGABA_s = zeros(nsamp,p.L1FS_Npop);
  L1RSNP_L1FS_iGABA_s(1,:) =  p.L1RSNP_L1FS_iGABA_IC+p.L1RSNP_L1FS_iGABA_IC_noise.*rand(1,p.L1FS_Npop);
L1FS_L1RSNP_iGABA_s = zeros(nsamp,p.L1RSNP_Npop);
  L1FS_L1RSNP_iGABA_s(1,:) =  p.L1FS_L1RSNP_iGABA_IC+p.L1FS_L1RSNP_iGABA_IC_noise.*rand(1,p.L1RSNP_Npop);
L2Ed_L2Es_iAMPA_s = zeros(nsamp,p.L2Es_Npop);
  L2Ed_L2Es_iAMPA_s(1,:) =  p.L2Ed_L2Es_iAMPA_IC+p.L2Ed_L2Es_iAMPA_IC_noise.*rand(1,p.L2Es_Npop);
L2Ed_L2Es_iNMDA_s = zeros(nsamp,p.L2Es_Npop);
  L2Ed_L2Es_iNMDA_s(1,:) =  p.L2Ed_L2Es_iNMDA_IC+p.L2Ed_L2Es_iNMDA_IC_noise*rand(1,p.L2Es_Npop);
L2FS_L2Es_iAMPA_s = zeros(nsamp,p.L2Es_Npop);
  L2FS_L2Es_iAMPA_s(1,:) =  p.L2FS_L2Es_iAMPA_IC+p.L2FS_L2Es_iAMPA_IC_noise.*rand(1,p.L2Es_Npop);
L2FS_L2Es_iNMDA_s = zeros(nsamp,p.L2Es_Npop);
  L2FS_L2Es_iNMDA_s(1,:) =  p.L2FS_L2Es_iNMDA_IC+p.L2FS_L2Es_iNMDA_IC_noise*rand(1,p.L2Es_Npop);
L2Es_L2FS_iGABA_s = zeros(nsamp,p.L2FS_Npop);
  L2Es_L2FS_iGABA_s(1,:) =  p.L2Es_L2FS_iGABA_IC+p.L2Es_L2FS_iGABA_IC_noise.*rand(1,p.L2FS_Npop);
L2FS_L2FS_iGABA_s = zeros(nsamp,p.L2FS_Npop);
  L2FS_L2FS_iGABA_s(1,:) =  p.L2FS_L2FS_iGABA_IC+p.L2FS_L2FS_iGABA_IC_noise.*rand(1,p.L2FS_Npop);
L2Ed_L1Es_iAMPA_s = zeros(nsamp,p.L1Es_Npop);
  L2Ed_L1Es_iAMPA_s(1,:) =  p.L2Ed_L1Es_iAMPA_IC+p.L2Ed_L1Es_iAMPA_IC_noise.*rand(1,p.L1Es_Npop);
% MONITORS:
L1Ed_input = zeros(nsamp,p.L1Ed_Npop);
  L1Ed_input(1,:)=((-p.L1Ed_gAMPA.*L1Ed_sAMPA(k,:).*(L1Ed_V(1,:)-p.L1Ed_EAMPA)));
L1Ed_L1Es_iAMPA_IAMPA = zeros(nsamp,p.L1Ed_Npop);
  L1Ed_L1Es_iAMPA_IAMPA(1,:)=(p.L1Ed_L1Es_iAMPA_gAMPA.*(L1Ed_L1Es_iAMPA_s(1,:)*L1Ed_L1Es_iAMPA_netcon).*(L1Ed_V(1,:)-p.L1Ed_L1Es_iAMPA_EAMPA));
L1Ed_L1Es_iNMDA_BMg = zeros(nsamp,p.L1Ed_Npop);
  L1Ed_L1Es_iNMDA_BMg(1,:)=(1.50265./(1+0.33*exp(L1Ed_V(1,:)./(-16))));
L1Ed_L1Es_iNMDA_INMDA = zeros(nsamp,p.L1Ed_Npop);
  L1Ed_L1Es_iNMDA_INMDA(1,:)=p.L1Ed_L1Es_iNMDA_gNMDA.*(( (1.50265./(1+0.33*exp(L1Ed_V(1,:)./(-16)))))).*(L1Ed_L1Es_iNMDA_s(1,:)*L1Ed_L1Es_iNMDA_netcon).*(L1Ed_V(1,:)-p.L1Ed_L1Es_iNMDA_ENMDA);
L1Ed_L1Es_iNMDA_NT = zeros(nsamp,p.L1Ed_Npop);
  L1Ed_L1Es_iNMDA_NT(1,:)=p.L1Ed_L1Es_iNMDA_Tmax./(1+exp(-(L1Ed_V(1,:)-p.L1Ed_L1Es_iNMDA_Vpp)/p.L1Ed_L1Es_iNMDA_Kp));
L1Ed_L1RSNP_iGABA_IGABA = zeros(nsamp,p.L1Ed_Npop);
  L1Ed_L1RSNP_iGABA_IGABA(1,:)=(p.L1Ed_L1RSNP_iGABA_gGABA.*(L1Ed_L1RSNP_iGABA_s(1,:)*L1Ed_L1RSNP_iGABA_netcon).*(L1Ed_V(1,:)-p.L1Ed_L1RSNP_iGABA_EGABA));
L1Es_L1FS_iGABA_IGABA = zeros(nsamp,p.L1Es_Npop);
  L1Es_L1FS_iGABA_IGABA(1,:)=(p.L1Es_L1FS_iGABA_gGABA.*(L1Es_L1FS_iGABA_s(1,:)*L1Es_L1FS_iGABA_netcon).*(L1Es_V(1,:)-p.L1Es_L1FS_iGABA_EGABA));
L1FS_L1Es_iAMPA_IAMPA = zeros(nsamp,p.L1FS_Npop);
  L1FS_L1Es_iAMPA_IAMPA(1,:)=(p.L1FS_L1Es_iAMPA_gAMPA.*(L1FS_L1Es_iAMPA_s(1,:)*L1FS_L1Es_iAMPA_netcon).*(L1FS_V(1,:)-p.L1FS_L1Es_iAMPA_EAMPA));
L1FS_L1Es_iNMDA_BMg = zeros(nsamp,p.L1FS_Npop);
  L1FS_L1Es_iNMDA_BMg(1,:)=(1.50265./(1+0.33*exp(L1FS_V(1,:)./(-16))));
L1FS_L1Es_iNMDA_INMDA = zeros(nsamp,p.L1FS_Npop);
  L1FS_L1Es_iNMDA_INMDA(1,:)=p.L1FS_L1Es_iNMDA_gNMDA.*(( (1.50265./(1+0.33*exp(L1FS_V(1,:)./(-16)))))).*(L1FS_L1Es_iNMDA_s(1,:)*L1FS_L1Es_iNMDA_netcon).*(L1FS_V(1,:)-p.L1FS_L1Es_iNMDA_ENMDA);
L1FS_L1Es_iNMDA_NT = zeros(nsamp,p.L1FS_Npop);
  L1FS_L1Es_iNMDA_NT(1,:)=p.L1FS_L1Es_iNMDA_Tmax./(1+exp(-(L1FS_V(1,:)-p.L1FS_L1Es_iNMDA_Vpp)/p.L1FS_L1Es_iNMDA_Kp));
L1FS_L1FS_iGABA_IGABA = zeros(nsamp,p.L1FS_Npop);
  L1FS_L1FS_iGABA_IGABA(1,:)=(p.L1FS_L1FS_iGABA_gGABA.*(L1FS_L1FS_iGABA_s(1,:)*L1FS_L1FS_iGABA_netcon).*(L1FS_V(1,:)-p.L1FS_L1FS_iGABA_EGABA));
L1FS_L1RSNP_iGABA_IGABA = zeros(nsamp,p.L1FS_Npop);
  L1FS_L1RSNP_iGABA_IGABA(1,:)=(p.L1FS_L1RSNP_iGABA_gGABA.*(L1FS_L1RSNP_iGABA_s(1,:)*L1FS_L1RSNP_iGABA_netcon).*(L1FS_V(1,:)-p.L1FS_L1RSNP_iGABA_EGABA));
L1RSNP_L1Es_iAMPA_IAMPA = zeros(nsamp,p.L1RSNP_Npop);
  L1RSNP_L1Es_iAMPA_IAMPA(1,:)=(p.L1RSNP_L1Es_iAMPA_gAMPA.*(L1RSNP_L1Es_iAMPA_s(1,:)*L1RSNP_L1Es_iAMPA_netcon).*(L1RSNP_V(1,:)-p.L1RSNP_L1Es_iAMPA_EAMPA));
L1RSNP_L1FS_iGABA_IGABA = zeros(nsamp,p.L1RSNP_Npop);
  L1RSNP_L1FS_iGABA_IGABA(1,:)=(p.L1RSNP_L1FS_iGABA_gGABA.*(L1RSNP_L1FS_iGABA_s(1,:)*L1RSNP_L1FS_iGABA_netcon).*(L1RSNP_V(1,:)-p.L1RSNP_L1FS_iGABA_EGABA));
L1RSNP_L1RSNP_iGABA_IGABA = zeros(nsamp,p.L1RSNP_Npop);
  L1RSNP_L1RSNP_iGABA_IGABA(1,:)=(p.L1RSNP_L1RSNP_iGABA_gGABA.*(L1RSNP_L1RSNP_iGABA_s(1,:)*L1RSNP_L1RSNP_iGABA_netcon).*(L1RSNP_V(1,:)-p.L1RSNP_L1RSNP_iGABA_EGABA));
L2Ed_L1Es_iAMPA_IAMPA = zeros(nsamp,p.L2Ed_Npop);
  L2Ed_L1Es_iAMPA_IAMPA(1,:)=(p.L2Ed_L1Es_iAMPA_gAMPA.*(L2Ed_L1Es_iAMPA_s(1,:)*L2Ed_L1Es_iAMPA_netcon).*(L2Ed_V(1,:)-p.L2Ed_L1Es_iAMPA_EAMPA));
L2Ed_L2Es_iAMPA_IAMPA = zeros(nsamp,p.L2Ed_Npop);
  L2Ed_L2Es_iAMPA_IAMPA(1,:)=(p.L2Ed_L2Es_iAMPA_gAMPA.*(L2Ed_L2Es_iAMPA_s(1,:)*L2Ed_L2Es_iAMPA_netcon).*(L2Ed_V(1,:)-p.L2Ed_L2Es_iAMPA_EAMPA));
L2Ed_L2Es_iNMDA_BMg = zeros(nsamp,p.L2Ed_Npop);
  L2Ed_L2Es_iNMDA_BMg(1,:)=(1.50265./(1+0.33*exp(L2Ed_V(1,:)./(-16))));
L2Ed_L2Es_iNMDA_INMDA = zeros(nsamp,p.L2Ed_Npop);
  L2Ed_L2Es_iNMDA_INMDA(1,:)=p.L2Ed_L2Es_iNMDA_gNMDA.*(( (1.50265./(1+0.33*exp(L2Ed_V(1,:)./(-16)))))).*(L2Ed_L2Es_iNMDA_s(1,:)*L2Ed_L2Es_iNMDA_netcon).*(L2Ed_V(1,:)-p.L2Ed_L2Es_iNMDA_ENMDA);
L2Ed_L2Es_iNMDA_NT = zeros(nsamp,p.L2Ed_Npop);
  L2Ed_L2Es_iNMDA_NT(1,:)=p.L2Ed_L2Es_iNMDA_Tmax./(1+exp(-(L2Ed_V(1,:)-p.L2Ed_L2Es_iNMDA_Vpp)/p.L2Ed_L2Es_iNMDA_Kp));
L2Es_L2FS_iGABA_IGABA = zeros(nsamp,p.L2Es_Npop);
  L2Es_L2FS_iGABA_IGABA(1,:)=(p.L2Es_L2FS_iGABA_gGABA.*(L2Es_L2FS_iGABA_s(1,:)*L2Es_L2FS_iGABA_netcon).*(L2Es_V(1,:)-p.L2Es_L2FS_iGABA_EGABA));
L2FS_L2Es_iAMPA_IAMPA = zeros(nsamp,p.L2FS_Npop);
  L2FS_L2Es_iAMPA_IAMPA(1,:)=(p.L2FS_L2Es_iAMPA_gAMPA.*(L2FS_L2Es_iAMPA_s(1,:)*L2FS_L2Es_iAMPA_netcon).*(L2FS_V(1,:)-p.L2FS_L2Es_iAMPA_EAMPA));
L2FS_L2Es_iNMDA_BMg = zeros(nsamp,p.L2FS_Npop);
  L2FS_L2Es_iNMDA_BMg(1,:)=(1.50265./(1+0.33*exp(L2FS_V(1,:)./(-16))));
L2FS_L2Es_iNMDA_INMDA = zeros(nsamp,p.L2FS_Npop);
  L2FS_L2Es_iNMDA_INMDA(1,:)=p.L2FS_L2Es_iNMDA_gNMDA.*(( (1.50265./(1+0.33*exp(L2FS_V(1,:)./(-16)))))).*(L2FS_L2Es_iNMDA_s(1,:)*L2FS_L2Es_iNMDA_netcon).*(L2FS_V(1,:)-p.L2FS_L2Es_iNMDA_ENMDA);
L2FS_L2Es_iNMDA_NT = zeros(nsamp,p.L2FS_Npop);
  L2FS_L2Es_iNMDA_NT(1,:)=p.L2FS_L2Es_iNMDA_Tmax./(1+exp(-(L2FS_V(1,:)-p.L2FS_L2Es_iNMDA_Vpp)/p.L2FS_L2Es_iNMDA_Kp));
L2FS_L2FS_iGABA_IGABA = zeros(nsamp,p.L2FS_Npop);
  L2FS_L2FS_iGABA_IGABA(1,:)=(p.L2FS_L2FS_iGABA_gGABA.*(L2FS_L2FS_iGABA_s(1,:)*L2FS_L2FS_iGABA_netcon).*(L2FS_V(1,:)-p.L2FS_L2FS_iGABA_EGABA));
% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1Es_V_k1=(((-((p.L1Es_DS00iNa_gnaf.*L1Es_DS00iNa_m(n-1,:).^3.*L1Es_DS00iNa_h(n-1,:).*(L1Es_V(n-1,:)-p.L1Es_DS00iNa_ENa))))+((-((p.L1Es_DS00iNaP_gnap.*L1Es_DS00iNaP_m(n-1,:).*L1Es_DS00iNaP_h(n-1,:).*(L1Es_V(n-1,:)-p.L1Es_DS00iNaP_ENa))))+((-((p.L1Es_DS00iDR_gkdr.*L1Es_DS00iDR_n(n-1,:).^4.*(L1Es_V(n-1,:)-((25*log(L1Es_DS00KDyn_ko(n-1,:)/p.L1Es_DS00iDR_ki)))))))+((-(( p.L1Es_DS02iKS_gks.*L1Es_DS02iKS_a(n-1,:).*L1Es_DS02iKS_b(n-1,:).*(L1Es_V(n-1,:)-((25*log(L1Es_DS00KDyn_ko(n-1,:)/p.L1Es_DS02iKS_ki)))))))+((-((p.L1Es_DS02iHVA_ghva.*L1Es_DS02iHVA_u(n-1,:).^2.*L1Es_DS02iHVA_w(n-1,:).*(L1Es_V(n-1,:)-((min(500,12.5*log(p.L1Es_DS02iHVA_cao./L1Es_DS00CaDyn_cai(n-1,:)))))))))+((-((p.L1Es_DS00iKCa_gkc.*L1Es_DS00iKCa_c(n-1,:).^2.*(L1Es_V(n-1,:)-((25*log(L1Es_DS00KDyn_ko(n-1,:)/p.L1Es_DS00iKCa_ki)))))))+((-(( p.L1Es_TW03iH_gH.*L1Es_TW03iH_m(n-1,:).*(L1Es_V(n-1,:)-p.L1Es_TW03iH_E_AR))))+((-((p.L1Es_pas_gpas.*(L1Es_V(n-1,:)-p.L1Es_pas_epas))))+(((( p.L1Es_L1Ed_iCOM_gCOM.*(L1Ed_V(n-1,:)-L1Es_V(n-1,:)))))+((-(( (p.L1Es_L1FS_iGABA_gGABA.*(L1Es_L1FS_iGABA_s(n-1)*L1Es_L1FS_iGABA_netcon).*(L1Es_V(n-1,:)-p.L1Es_L1FS_iGABA_EGABA)))))))))))))))+p.L1Es_Iapp)./p.L1Es_Cm;
  L1Es_DS00iNa_m_k1=((((((-.2816*(( ((abs(L1Es_V(n-1,:)-p.L1Es_DS00iNa_amV0)<p.L1Es_DS00iNa_eps).*p.L1Es_DS00iNa_eps+(abs(L1Es_V(n-1,:)-p.L1Es_DS00iNa_amV0)>=p.L1Es_DS00iNa_eps).*L1Es_V(n-1,:)-p.L1Es_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L1Es_V(n-1,:)-p.L1Es_DS00iNa_amV0)<p.L1Es_DS00iNa_eps).*p.L1Es_DS00iNa_eps+(abs(L1Es_V(n-1,:)-p.L1Es_DS00iNa_amV0)>=p.L1Es_DS00iNa_eps).*L1Es_V(n-1,:)-p.L1Es_DS00iNa_amV0)))/9.3))))./((((-.2816*(( ((abs(L1Es_V(n-1,:)-p.L1Es_DS00iNa_amV0)<p.L1Es_DS00iNa_eps).*p.L1Es_DS00iNa_eps+(abs(L1Es_V(n-1,:)-p.L1Es_DS00iNa_amV0)>=p.L1Es_DS00iNa_eps).*L1Es_V(n-1,:)-p.L1Es_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L1Es_V(n-1,:)-p.L1Es_DS00iNa_amV0)<p.L1Es_DS00iNa_eps).*p.L1Es_DS00iNa_eps+(abs(L1Es_V(n-1,:)-p.L1Es_DS00iNa_amV0)>=p.L1Es_DS00iNa_eps).*L1Es_V(n-1,:)-p.L1Es_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(L1Es_V(n-1,:)-p.L1Es_DS00iNa_bmV0)<p.L1Es_DS00iNa_eps).*p.L1Es_DS00iNa_eps+(abs(L1Es_V(n-1,:)-p.L1Es_DS00iNa_bmV0)>=p.L1Es_DS00iNa_eps).*L1Es_V(n-1,:)-p.L1Es_DS00iNa_bmV0))))./(-1+exp((( ((abs(L1Es_V(n-1,:)-p.L1Es_DS00iNa_bmV0)<p.L1Es_DS00iNa_eps).*p.L1Es_DS00iNa_eps+(abs(L1Es_V(n-1,:)-p.L1Es_DS00iNa_bmV0)>=p.L1Es_DS00iNa_eps).*L1Es_V(n-1,:)-p.L1Es_DS00iNa_bmV0)))/6)))))))-L1Es_DS00iNa_m(n-1,:))./((1./((((-.2816*(( ((abs(L1Es_V(n-1,:)-p.L1Es_DS00iNa_amV0)<p.L1Es_DS00iNa_eps).*p.L1Es_DS00iNa_eps+(abs(L1Es_V(n-1,:)-p.L1Es_DS00iNa_amV0)>=p.L1Es_DS00iNa_eps).*L1Es_V(n-1,:)-p.L1Es_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L1Es_V(n-1,:)-p.L1Es_DS00iNa_amV0)<p.L1Es_DS00iNa_eps).*p.L1Es_DS00iNa_eps+(abs(L1Es_V(n-1,:)-p.L1Es_DS00iNa_amV0)>=p.L1Es_DS00iNa_eps).*L1Es_V(n-1,:)-p.L1Es_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(L1Es_V(n-1,:)-p.L1Es_DS00iNa_bmV0)<p.L1Es_DS00iNa_eps).*p.L1Es_DS00iNa_eps+(abs(L1Es_V(n-1,:)-p.L1Es_DS00iNa_bmV0)>=p.L1Es_DS00iNa_eps).*L1Es_V(n-1,:)-p.L1Es_DS00iNa_bmV0))))./(-1+exp((( ((abs(L1Es_V(n-1,:)-p.L1Es_DS00iNa_bmV0)<p.L1Es_DS00iNa_eps).*p.L1Es_DS00iNa_eps+(abs(L1Es_V(n-1,:)-p.L1Es_DS00iNa_bmV0)>=p.L1Es_DS00iNa_eps).*L1Es_V(n-1,:)-p.L1Es_DS00iNa_bmV0)))/6)))))));
  L1Es_DS00iNa_h_k1=(((((p.L1Es_DS00iNa_hnascale.*.098./exp((L1Es_V(n-1,:)-p.L1Es_DS00iNa_ahV0)/20)))./(((p.L1Es_DS00iNa_hnascale.*.098./exp((L1Es_V(n-1,:)-p.L1Es_DS00iNa_ahV0)/20)))+((p.L1Es_DS00iNa_hnascale.*1.4./(1+exp(-(L1Es_V(n-1,:)-p.L1Es_DS00iNa_bhV0)/10)))))))-L1Es_DS00iNa_h(n-1,:))./((1./(((p.L1Es_DS00iNa_hnascale.*.098./exp((L1Es_V(n-1,:)-p.L1Es_DS00iNa_ahV0)/20)))+((p.L1Es_DS00iNa_hnascale.*1.4./(1+exp(-(L1Es_V(n-1,:)-p.L1Es_DS00iNa_bhV0)/10)))))));
  L1Es_DS00iNaP_m_k1=((((((-.2816*(( ((abs(L1Es_V(n-1,:)+12)<p.L1Es_DS00iNaP_eps).*p.L1Es_DS00iNaP_eps+(abs(L1Es_V(n-1,:)+12)>=p.L1Es_DS00iNaP_eps).*L1Es_V(n-1,:)+12))))./(-1+exp(-(( ((abs(L1Es_V(n-1,:)+12)<p.L1Es_DS00iNaP_eps).*p.L1Es_DS00iNaP_eps+(abs(L1Es_V(n-1,:)+12)>=p.L1Es_DS00iNaP_eps).*L1Es_V(n-1,:)+12)))/9.3))))./((((-.2816*(( ((abs(L1Es_V(n-1,:)+12)<p.L1Es_DS00iNaP_eps).*p.L1Es_DS00iNaP_eps+(abs(L1Es_V(n-1,:)+12)>=p.L1Es_DS00iNaP_eps).*L1Es_V(n-1,:)+12))))./(-1+exp(-(( ((abs(L1Es_V(n-1,:)+12)<p.L1Es_DS00iNaP_eps).*p.L1Es_DS00iNaP_eps+(abs(L1Es_V(n-1,:)+12)>=p.L1Es_DS00iNaP_eps).*L1Es_V(n-1,:)+12)))/9.3))))+(((.2464*(( ((abs(L1Es_V(n-1,:)-15)<p.L1Es_DS00iNaP_eps).*p.L1Es_DS00iNaP_eps+(abs(L1Es_V(n-1,:)-15)>=p.L1Es_DS00iNaP_eps).*L1Es_V(n-1,:)-15))))./(-1+exp((( ((abs(L1Es_V(n-1,:)-15)<p.L1Es_DS00iNaP_eps).*p.L1Es_DS00iNaP_eps+(abs(L1Es_V(n-1,:)-15)>=p.L1Es_DS00iNaP_eps).*L1Es_V(n-1,:)-15)))/6)))))))-L1Es_DS00iNaP_m(n-1,:))./((1./((((-.2816*(( ((abs(L1Es_V(n-1,:)+12)<p.L1Es_DS00iNaP_eps).*p.L1Es_DS00iNaP_eps+(abs(L1Es_V(n-1,:)+12)>=p.L1Es_DS00iNaP_eps).*L1Es_V(n-1,:)+12))))./(-1+exp(-(( ((abs(L1Es_V(n-1,:)+12)<p.L1Es_DS00iNaP_eps).*p.L1Es_DS00iNaP_eps+(abs(L1Es_V(n-1,:)+12)>=p.L1Es_DS00iNaP_eps).*L1Es_V(n-1,:)+12)))/9.3))))+(((.2464*(( ((abs(L1Es_V(n-1,:)-15)<p.L1Es_DS00iNaP_eps).*p.L1Es_DS00iNaP_eps+(abs(L1Es_V(n-1,:)-15)>=p.L1Es_DS00iNaP_eps).*L1Es_V(n-1,:)-15))))./(-1+exp((( ((abs(L1Es_V(n-1,:)-15)<p.L1Es_DS00iNaP_eps).*p.L1Es_DS00iNaP_eps+(abs(L1Es_V(n-1,:)-15)>=p.L1Es_DS00iNaP_eps).*L1Es_V(n-1,:)-15)))/6)))))));
  L1Es_DS00iNaP_h_k1=(((((2.8e-5./exp((L1Es_V(n-1,:)+42.8477)/4.0248)))./(((2.8e-5./exp((L1Es_V(n-1,:)+42.8477)/4.0248)))+((.02./(1+exp(-(L1Es_V(n-1,:)-413.9284)/148.2589)))))))-L1Es_DS00iNaP_h(n-1,:))./((p.L1Es_DS00iNaP_htaunap*1./(((2.8e-5./exp((L1Es_V(n-1,:)+42.8477)/4.0248)))+((.02./(1+exp(-(L1Es_V(n-1,:)-413.9284)/148.2589)))))));
  L1Es_DS00iDR_n_k1=(((((-.018*(( ((abs(L1Es_V(n-1,:)-p.L1Es_DS00iDR_anV0)<p.L1Es_DS00iDR_eps).*p.L1Es_DS00iDR_eps+(abs(L1Es_V(n-1,:)-p.L1Es_DS00iDR_anV0)>=p.L1Es_DS00iDR_eps).*L1Es_V(n-1,:)-p.L1Es_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L1Es_V(n-1,:)-p.L1Es_DS00iDR_anV0)<p.L1Es_DS00iDR_eps).*p.L1Es_DS00iDR_eps+(abs(L1Es_V(n-1,:)-p.L1Es_DS00iDR_anV0)>=p.L1Es_DS00iDR_eps).*L1Es_V(n-1,:)-p.L1Es_DS00iDR_anV0)))/25))))./(((-.018*(( ((abs(L1Es_V(n-1,:)-p.L1Es_DS00iDR_anV0)<p.L1Es_DS00iDR_eps).*p.L1Es_DS00iDR_eps+(abs(L1Es_V(n-1,:)-p.L1Es_DS00iDR_anV0)>=p.L1Es_DS00iDR_eps).*L1Es_V(n-1,:)-p.L1Es_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L1Es_V(n-1,:)-p.L1Es_DS00iDR_anV0)<p.L1Es_DS00iDR_eps).*p.L1Es_DS00iDR_eps+(abs(L1Es_V(n-1,:)-p.L1Es_DS00iDR_anV0)>=p.L1Es_DS00iDR_eps).*L1Es_V(n-1,:)-p.L1Es_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(L1Es_V(n-1,:)-p.L1Es_DS00iDR_bnV0)<p.L1Es_DS00iDR_eps).*p.L1Es_DS00iDR_eps+(abs(L1Es_V(n-1,:)-p.L1Es_DS00iDR_bnV0)>=p.L1Es_DS00iDR_eps).*L1Es_V(n-1,:)-p.L1Es_DS00iDR_bnV0)))./(-1+exp((( ((abs(L1Es_V(n-1,:)-p.L1Es_DS00iDR_bnV0)<p.L1Es_DS00iDR_eps).*p.L1Es_DS00iDR_eps+(abs(L1Es_V(n-1,:)-p.L1Es_DS00iDR_bnV0)>=p.L1Es_DS00iDR_eps).*L1Es_V(n-1,:)-p.L1Es_DS00iDR_bnV0)))/12)))))))-L1Es_DS00iDR_n(n-1,:))./((1./(((-.018*(( ((abs(L1Es_V(n-1,:)-p.L1Es_DS00iDR_anV0)<p.L1Es_DS00iDR_eps).*p.L1Es_DS00iDR_eps+(abs(L1Es_V(n-1,:)-p.L1Es_DS00iDR_anV0)>=p.L1Es_DS00iDR_eps).*L1Es_V(n-1,:)-p.L1Es_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L1Es_V(n-1,:)-p.L1Es_DS00iDR_anV0)<p.L1Es_DS00iDR_eps).*p.L1Es_DS00iDR_eps+(abs(L1Es_V(n-1,:)-p.L1Es_DS00iDR_anV0)>=p.L1Es_DS00iDR_eps).*L1Es_V(n-1,:)-p.L1Es_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(L1Es_V(n-1,:)-p.L1Es_DS00iDR_bnV0)<p.L1Es_DS00iDR_eps).*p.L1Es_DS00iDR_eps+(abs(L1Es_V(n-1,:)-p.L1Es_DS00iDR_bnV0)>=p.L1Es_DS00iDR_eps).*L1Es_V(n-1,:)-p.L1Es_DS00iDR_bnV0)))./(-1+exp((( ((abs(L1Es_V(n-1,:)-p.L1Es_DS00iDR_bnV0)<p.L1Es_DS00iDR_eps).*p.L1Es_DS00iDR_eps+(abs(L1Es_V(n-1,:)-p.L1Es_DS00iDR_bnV0)>=p.L1Es_DS00iDR_eps).*L1Es_V(n-1,:)-p.L1Es_DS00iDR_bnV0)))/12)))))));
  L1Es_DS02iKS_a_k1=(((1./(1+exp(-(L1Es_V(n-1,:)+34)/6.5))))-L1Es_DS02iKS_a(n-1,:))./((6));
  L1Es_DS02iKS_b_k1=(((1./(1+exp((L1Es_V(n-1,:)+65)/6.6))))-L1Es_DS02iKS_b(n-1,:))./((200+220./(1+exp(-(L1Es_V(n-1,:)+71.6)/6.85))));
  L1Es_DS02iHVA_u_k1=(((1./(1+exp(-(L1Es_V(n-1,:)+24.6)/11.3))))-L1Es_DS02iHVA_u(n-1,:))./((1.25*sech(-.031*(L1Es_V(n-1,:)+37.1))));
  L1Es_DS02iHVA_w_k1=(((1./(1+exp((L1Es_V(n-1,:)+12.6)/18.9))))-L1Es_DS02iHVA_w(n-1,:))./((L1Es_DS02iHVA_wtauHVA));
  L1Es_DS00iKCa_c_k1=((((((-0.00642*(( ((abs(((L1Es_V(n-1,:)+40*log10(L1Es_DS00CaDyn_cai(n-1,:))))+18)<p.L1Es_DS00iKCa_eps).*p.L1Es_DS00iKCa_eps+(abs(((L1Es_V(n-1,:)+40*log10(L1Es_DS00CaDyn_cai(n-1,:))))+18)>=p.L1Es_DS00iKCa_eps).*((L1Es_V(n-1,:)+40*log10(L1Es_DS00CaDyn_cai(n-1,:))))+18))))./(-1+exp((( ((abs(((L1Es_V(n-1,:)+40*log10(L1Es_DS00CaDyn_cai(n-1,:))))+18)<p.L1Es_DS00iKCa_eps).*p.L1Es_DS00iKCa_eps+(abs(((L1Es_V(n-1,:)+40*log10(L1Es_DS00CaDyn_cai(n-1,:))))+18)>=p.L1Es_DS00iKCa_eps).*((L1Es_V(n-1,:)+40*log10(L1Es_DS00CaDyn_cai(n-1,:))))+18)))./(-12)))))./((((-0.00642*(( ((abs(((L1Es_V(n-1,:)+40*log10(L1Es_DS00CaDyn_cai(n-1,:))))+18)<p.L1Es_DS00iKCa_eps).*p.L1Es_DS00iKCa_eps+(abs(((L1Es_V(n-1,:)+40*log10(L1Es_DS00CaDyn_cai(n-1,:))))+18)>=p.L1Es_DS00iKCa_eps).*((L1Es_V(n-1,:)+40*log10(L1Es_DS00CaDyn_cai(n-1,:))))+18))))./(-1+exp((( ((abs(((L1Es_V(n-1,:)+40*log10(L1Es_DS00CaDyn_cai(n-1,:))))+18)<p.L1Es_DS00iKCa_eps).*p.L1Es_DS00iKCa_eps+(abs(((L1Es_V(n-1,:)+40*log10(L1Es_DS00CaDyn_cai(n-1,:))))+18)>=p.L1Es_DS00iKCa_eps).*((L1Es_V(n-1,:)+40*log10(L1Es_DS00CaDyn_cai(n-1,:))))+18)))./(-12)))))+((1.7*exp((((L1Es_V(n-1,:)+40*log10(L1Es_DS00CaDyn_cai(n-1,:))))+152)./(-30.0)))))))-L1Es_DS00iKCa_c(n-1,:))./((1./((((-0.00642*(( ((abs(((L1Es_V(n-1,:)+40*log10(L1Es_DS00CaDyn_cai(n-1,:))))+18)<p.L1Es_DS00iKCa_eps).*p.L1Es_DS00iKCa_eps+(abs(((L1Es_V(n-1,:)+40*log10(L1Es_DS00CaDyn_cai(n-1,:))))+18)>=p.L1Es_DS00iKCa_eps).*((L1Es_V(n-1,:)+40*log10(L1Es_DS00CaDyn_cai(n-1,:))))+18))))./(-1+exp((( ((abs(((L1Es_V(n-1,:)+40*log10(L1Es_DS00CaDyn_cai(n-1,:))))+18)<p.L1Es_DS00iKCa_eps).*p.L1Es_DS00iKCa_eps+(abs(((L1Es_V(n-1,:)+40*log10(L1Es_DS00CaDyn_cai(n-1,:))))+18)>=p.L1Es_DS00iKCa_eps).*((L1Es_V(n-1,:)+40*log10(L1Es_DS00CaDyn_cai(n-1,:))))+18)))./(-12)))))+((1.7*exp((((L1Es_V(n-1,:)+40*log10(L1Es_DS00CaDyn_cai(n-1,:))))+152)./(-30.0)))))));
  L1Es_DS00CaDyn_cai_k1= -p.L1Es_DS00CaDyn_CAF.*((((p.L1Es_DS02iHVA_ghva.*L1Es_DS02iHVA_u(n-1,:).^2.*L1Es_DS02iHVA_w(n-1,:).*(L1Es_V(n-1,:)-((min(500,12.5*log(p.L1Es_DS02iHVA_cao./L1Es_DS00CaDyn_cai(n-1,:))))))))))./(p.L1Es_DS00CaDyn_faraday*p.L1Es_DS00CaDyn_VshellCa)+(p.L1Es_DS00CaDyn_cainf-L1Es_DS00CaDyn_cai(n-1,:))./p.L1Es_DS00CaDyn_tauCa;
  L1Es_DS00KDyn_ko_k1= p.L1Es_DS00KDyn_KAF.*((((p.L1Es_DS00iDR_gkdr.*L1Es_DS00iDR_n(n-1,:).^4.*(L1Es_V(n-1,:)-((25*log(L1Es_DS00KDyn_ko(n-1,:)/p.L1Es_DS00iDR_ki)))))))+(((( p.L1Es_DS02iKS_gks.*L1Es_DS02iKS_a(n-1,:).*L1Es_DS02iKS_b(n-1,:).*(L1Es_V(n-1,:)-((25*log(L1Es_DS00KDyn_ko(n-1,:)/p.L1Es_DS02iKS_ki)))))))+((((p.L1Es_DS00iKCa_gkc.*L1Es_DS00iKCa_c(n-1,:).^2.*(L1Es_V(n-1,:)-((25*log(L1Es_DS00KDyn_ko(n-1,:)/p.L1Es_DS00iKCa_ki))))))))))./(p.L1Es_DS00KDyn_faraday*p.L1Es_DS00KDyn_VshellK)+(p.L1Es_DS00KDyn_koinf-L1Es_DS00KDyn_ko(n-1,:))./p.L1Es_DS00KDyn_tauK;
  L1Es_TW03iH_m_k1= (( p.L1Es_TW03iH_c_ARaM.*((( 1 ./ (1+exp((p.L1Es_TW03iH_AR_V12-L1Es_V(n-1,:))/p.L1Es_TW03iH_AR_k)))) ./ (( 1./(p.L1Es_TW03iH_AR_L.*exp(-14.6-.086*L1Es_V(n-1,:))+p.L1Es_TW03iH_AR_R.*exp(-1.87+.07*L1Es_V(n-1,:)))))))).*(1-L1Es_TW03iH_m(n-1,:))-(( p.L1Es_TW03iH_c_ARbM.*((1-(( 1 ./ (1+exp((p.L1Es_TW03iH_AR_V12-L1Es_V(n-1,:))/p.L1Es_TW03iH_AR_k)))))./(( 1./(p.L1Es_TW03iH_AR_L.*exp(-14.6-.086*L1Es_V(n-1,:))+p.L1Es_TW03iH_AR_R.*exp(-1.87+.07*L1Es_V(n-1,:)))))))).*L1Es_TW03iH_m(n-1,:);
  L1Ed_V_k1=(((-((p.L1Ed_DS00iNa_gnaf.*L1Ed_DS00iNa_m(n-1,:).^3.*L1Ed_DS00iNa_h(n-1,:).*(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_ENa))))+((-((p.L1Ed_DS00iNaP_gnap.*L1Ed_DS00iNaP_m(n-1,:).*L1Ed_DS00iNaP_h(n-1,:).*(L1Ed_V(n-1,:)-p.L1Ed_DS00iNaP_ENa))))+((-((p.L1Ed_DS00iDR_gkdr.*L1Ed_DS00iDR_n(n-1,:).^4.*(L1Ed_V(n-1,:)-((25*log(L1Ed_DS00KDyn_ko(n-1,:)/p.L1Ed_DS00iDR_ki)))))))+((-(( p.L1Ed_DS02iKS_gks.*L1Ed_DS02iKS_a(n-1,:).*L1Ed_DS02iKS_b(n-1,:).*(L1Ed_V(n-1,:)-((25*log(L1Ed_DS00KDyn_ko(n-1,:)/p.L1Ed_DS02iKS_ki)))))))+((-((p.L1Ed_DS02iHVA_ghva.*L1Ed_DS02iHVA_u(n-1,:).^2.*L1Ed_DS02iHVA_w(n-1,:).*(L1Ed_V(n-1,:)-((min(500,12.5*log(p.L1Ed_DS02iHVA_cao./L1Ed_DS00CaDyn_cai(n-1,:)))))))))+((-((p.L1Ed_DS00iKCa_gkc.*L1Ed_DS00iKCa_c(n-1,:).^2.*(L1Ed_V(n-1,:)-((25*log(L1Ed_DS00KDyn_ko(n-1,:)/p.L1Ed_DS00iKCa_ki)))))))+((-(( p.L1Ed_TW03iH_gH.*L1Ed_TW03iH_m(n-1,:).*(L1Ed_V(n-1,:)-p.L1Ed_TW03iH_E_AR))))+((-((p.L1Ed_pas_gpas.*(L1Ed_V(n-1,:)-p.L1Ed_pas_epas))))+((-(( (p.L1Ed_L1Es_iAMPA_gAMPA.*(L1Ed_L1Es_iAMPA_s(n-1,:)*L1Ed_L1Es_iAMPA_netcon).*(L1Ed_V(n-1,:)-p.L1Ed_L1Es_iAMPA_EAMPA)))))+((-(( p.L1Ed_L1Es_iNMDA_gNMDA.*(( (1.50265./(1+0.33*exp(L1Ed_V(n-1,:)./(-16)))))).*(L1Ed_L1Es_iNMDA_s(n-1,:)*L1Ed_L1Es_iNMDA_netcon).*(L1Ed_V(n-1,:)-p.L1Ed_L1Es_iNMDA_ENMDA))))+(((( p.L1Ed_L1Es_iCOM_gCOM.*(L1Es_V(n-1,:)-L1Ed_V(n-1,:)))))+((-(( (p.L1Ed_L1RSNP_iGABA_gGABA.*(L1Ed_L1RSNP_iGABA_s(n-1)*L1Ed_L1RSNP_iGABA_netcon).*(L1Ed_V(n-1,:)-p.L1Ed_L1RSNP_iGABA_EGABA)))))))))))))))))+((((-p.L1Ed_gAMPA.*L1Ed_sAMPA(k,:).*(L1Ed_V(n-1,:)-p.L1Ed_EAMPA)))))+p.L1Ed_Iapp*(t>p.L1Ed_onset&t<p.L1Ed_offset))./p.L1Ed_Cm;
  L1Ed_DS00iNa_m_k1=((((((-.2816*(( ((abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_amV0)<p.L1Ed_DS00iNa_eps).*p.L1Ed_DS00iNa_eps+(abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_amV0)>=p.L1Ed_DS00iNa_eps).*L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_amV0)<p.L1Ed_DS00iNa_eps).*p.L1Ed_DS00iNa_eps+(abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_amV0)>=p.L1Ed_DS00iNa_eps).*L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_amV0)))/9.3))))./((((-.2816*(( ((abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_amV0)<p.L1Ed_DS00iNa_eps).*p.L1Ed_DS00iNa_eps+(abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_amV0)>=p.L1Ed_DS00iNa_eps).*L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_amV0)<p.L1Ed_DS00iNa_eps).*p.L1Ed_DS00iNa_eps+(abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_amV0)>=p.L1Ed_DS00iNa_eps).*L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_bmV0)<p.L1Ed_DS00iNa_eps).*p.L1Ed_DS00iNa_eps+(abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_bmV0)>=p.L1Ed_DS00iNa_eps).*L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_bmV0))))./(-1+exp((( ((abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_bmV0)<p.L1Ed_DS00iNa_eps).*p.L1Ed_DS00iNa_eps+(abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_bmV0)>=p.L1Ed_DS00iNa_eps).*L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_bmV0)))/6)))))))-L1Ed_DS00iNa_m(n-1,:))./((1./((((-.2816*(( ((abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_amV0)<p.L1Ed_DS00iNa_eps).*p.L1Ed_DS00iNa_eps+(abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_amV0)>=p.L1Ed_DS00iNa_eps).*L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_amV0)<p.L1Ed_DS00iNa_eps).*p.L1Ed_DS00iNa_eps+(abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_amV0)>=p.L1Ed_DS00iNa_eps).*L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_bmV0)<p.L1Ed_DS00iNa_eps).*p.L1Ed_DS00iNa_eps+(abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_bmV0)>=p.L1Ed_DS00iNa_eps).*L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_bmV0))))./(-1+exp((( ((abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_bmV0)<p.L1Ed_DS00iNa_eps).*p.L1Ed_DS00iNa_eps+(abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_bmV0)>=p.L1Ed_DS00iNa_eps).*L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_bmV0)))/6)))))));
  L1Ed_DS00iNa_h_k1=(((((p.L1Ed_DS00iNa_hnascale.*.098./exp((L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_ahV0)/20)))./(((p.L1Ed_DS00iNa_hnascale.*.098./exp((L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_ahV0)/20)))+((p.L1Ed_DS00iNa_hnascale.*1.4./(1+exp(-(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_bhV0)/10)))))))-L1Ed_DS00iNa_h(n-1,:))./((1./(((p.L1Ed_DS00iNa_hnascale.*.098./exp((L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_ahV0)/20)))+((p.L1Ed_DS00iNa_hnascale.*1.4./(1+exp(-(L1Ed_V(n-1,:)-p.L1Ed_DS00iNa_bhV0)/10)))))));
  L1Ed_DS00iNaP_m_k1=((((((-.2816*(( ((abs(L1Ed_V(n-1,:)+12)<p.L1Ed_DS00iNaP_eps).*p.L1Ed_DS00iNaP_eps+(abs(L1Ed_V(n-1,:)+12)>=p.L1Ed_DS00iNaP_eps).*L1Ed_V(n-1,:)+12))))./(-1+exp(-(( ((abs(L1Ed_V(n-1,:)+12)<p.L1Ed_DS00iNaP_eps).*p.L1Ed_DS00iNaP_eps+(abs(L1Ed_V(n-1,:)+12)>=p.L1Ed_DS00iNaP_eps).*L1Ed_V(n-1,:)+12)))/9.3))))./((((-.2816*(( ((abs(L1Ed_V(n-1,:)+12)<p.L1Ed_DS00iNaP_eps).*p.L1Ed_DS00iNaP_eps+(abs(L1Ed_V(n-1,:)+12)>=p.L1Ed_DS00iNaP_eps).*L1Ed_V(n-1,:)+12))))./(-1+exp(-(( ((abs(L1Ed_V(n-1,:)+12)<p.L1Ed_DS00iNaP_eps).*p.L1Ed_DS00iNaP_eps+(abs(L1Ed_V(n-1,:)+12)>=p.L1Ed_DS00iNaP_eps).*L1Ed_V(n-1,:)+12)))/9.3))))+(((.2464*(( ((abs(L1Ed_V(n-1,:)-15)<p.L1Ed_DS00iNaP_eps).*p.L1Ed_DS00iNaP_eps+(abs(L1Ed_V(n-1,:)-15)>=p.L1Ed_DS00iNaP_eps).*L1Ed_V(n-1,:)-15))))./(-1+exp((( ((abs(L1Ed_V(n-1,:)-15)<p.L1Ed_DS00iNaP_eps).*p.L1Ed_DS00iNaP_eps+(abs(L1Ed_V(n-1,:)-15)>=p.L1Ed_DS00iNaP_eps).*L1Ed_V(n-1,:)-15)))/6)))))))-L1Ed_DS00iNaP_m(n-1,:))./((1./((((-.2816*(( ((abs(L1Ed_V(n-1,:)+12)<p.L1Ed_DS00iNaP_eps).*p.L1Ed_DS00iNaP_eps+(abs(L1Ed_V(n-1,:)+12)>=p.L1Ed_DS00iNaP_eps).*L1Ed_V(n-1,:)+12))))./(-1+exp(-(( ((abs(L1Ed_V(n-1,:)+12)<p.L1Ed_DS00iNaP_eps).*p.L1Ed_DS00iNaP_eps+(abs(L1Ed_V(n-1,:)+12)>=p.L1Ed_DS00iNaP_eps).*L1Ed_V(n-1,:)+12)))/9.3))))+(((.2464*(( ((abs(L1Ed_V(n-1,:)-15)<p.L1Ed_DS00iNaP_eps).*p.L1Ed_DS00iNaP_eps+(abs(L1Ed_V(n-1,:)-15)>=p.L1Ed_DS00iNaP_eps).*L1Ed_V(n-1,:)-15))))./(-1+exp((( ((abs(L1Ed_V(n-1,:)-15)<p.L1Ed_DS00iNaP_eps).*p.L1Ed_DS00iNaP_eps+(abs(L1Ed_V(n-1,:)-15)>=p.L1Ed_DS00iNaP_eps).*L1Ed_V(n-1,:)-15)))/6)))))));
  L1Ed_DS00iNaP_h_k1=(((((2.8e-5./exp((L1Ed_V(n-1,:)+42.8477)/4.0248)))./(((2.8e-5./exp((L1Ed_V(n-1,:)+42.8477)/4.0248)))+((.02./(1+exp(-(L1Ed_V(n-1,:)-413.9284)/148.2589)))))))-L1Ed_DS00iNaP_h(n-1,:))./((p.L1Ed_DS00iNaP_htaunap*1./(((2.8e-5./exp((L1Ed_V(n-1,:)+42.8477)/4.0248)))+((.02./(1+exp(-(L1Ed_V(n-1,:)-413.9284)/148.2589)))))));
  L1Ed_DS00iDR_n_k1=(((((-.018*(( ((abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_anV0)<p.L1Ed_DS00iDR_eps).*p.L1Ed_DS00iDR_eps+(abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_anV0)>=p.L1Ed_DS00iDR_eps).*L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_anV0)<p.L1Ed_DS00iDR_eps).*p.L1Ed_DS00iDR_eps+(abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_anV0)>=p.L1Ed_DS00iDR_eps).*L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_anV0)))/25))))./(((-.018*(( ((abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_anV0)<p.L1Ed_DS00iDR_eps).*p.L1Ed_DS00iDR_eps+(abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_anV0)>=p.L1Ed_DS00iDR_eps).*L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_anV0)<p.L1Ed_DS00iDR_eps).*p.L1Ed_DS00iDR_eps+(abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_anV0)>=p.L1Ed_DS00iDR_eps).*L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_bnV0)<p.L1Ed_DS00iDR_eps).*p.L1Ed_DS00iDR_eps+(abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_bnV0)>=p.L1Ed_DS00iDR_eps).*L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_bnV0)))./(-1+exp((( ((abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_bnV0)<p.L1Ed_DS00iDR_eps).*p.L1Ed_DS00iDR_eps+(abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_bnV0)>=p.L1Ed_DS00iDR_eps).*L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_bnV0)))/12)))))))-L1Ed_DS00iDR_n(n-1,:))./((1./(((-.018*(( ((abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_anV0)<p.L1Ed_DS00iDR_eps).*p.L1Ed_DS00iDR_eps+(abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_anV0)>=p.L1Ed_DS00iDR_eps).*L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_anV0)<p.L1Ed_DS00iDR_eps).*p.L1Ed_DS00iDR_eps+(abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_anV0)>=p.L1Ed_DS00iDR_eps).*L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_bnV0)<p.L1Ed_DS00iDR_eps).*p.L1Ed_DS00iDR_eps+(abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_bnV0)>=p.L1Ed_DS00iDR_eps).*L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_bnV0)))./(-1+exp((( ((abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_bnV0)<p.L1Ed_DS00iDR_eps).*p.L1Ed_DS00iDR_eps+(abs(L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_bnV0)>=p.L1Ed_DS00iDR_eps).*L1Ed_V(n-1,:)-p.L1Ed_DS00iDR_bnV0)))/12)))))));
  L1Ed_DS02iKS_a_k1=(((1./(1+exp(-(L1Ed_V(n-1,:)+34)/6.5))))-L1Ed_DS02iKS_a(n-1,:))./((6));
  L1Ed_DS02iKS_b_k1=(((1./(1+exp((L1Ed_V(n-1,:)+65)/6.6))))-L1Ed_DS02iKS_b(n-1,:))./((200+220./(1+exp(-(L1Ed_V(n-1,:)+71.6)/6.85))));
  L1Ed_DS02iHVA_u_k1=(((1./(1+exp(-(L1Ed_V(n-1,:)+24.6)/11.3))))-L1Ed_DS02iHVA_u(n-1,:))./((1.25*sech(-.031*(L1Ed_V(n-1,:)+37.1))));
  L1Ed_DS02iHVA_w_k1=(((1./(1+exp((L1Ed_V(n-1,:)+12.6)/18.9))))-L1Ed_DS02iHVA_w(n-1,:))./((L1Ed_DS02iHVA_wtauHVA));
  L1Ed_DS00iKCa_c_k1=((((((-0.00642*(( ((abs(((L1Ed_V(n-1,:)+40*log10(L1Ed_DS00CaDyn_cai(n-1,:))))+18)<p.L1Ed_DS00iKCa_eps).*p.L1Ed_DS00iKCa_eps+(abs(((L1Ed_V(n-1,:)+40*log10(L1Ed_DS00CaDyn_cai(n-1,:))))+18)>=p.L1Ed_DS00iKCa_eps).*((L1Ed_V(n-1,:)+40*log10(L1Ed_DS00CaDyn_cai(n-1,:))))+18))))./(-1+exp((( ((abs(((L1Ed_V(n-1,:)+40*log10(L1Ed_DS00CaDyn_cai(n-1,:))))+18)<p.L1Ed_DS00iKCa_eps).*p.L1Ed_DS00iKCa_eps+(abs(((L1Ed_V(n-1,:)+40*log10(L1Ed_DS00CaDyn_cai(n-1,:))))+18)>=p.L1Ed_DS00iKCa_eps).*((L1Ed_V(n-1,:)+40*log10(L1Ed_DS00CaDyn_cai(n-1,:))))+18)))./(-12)))))./((((-0.00642*(( ((abs(((L1Ed_V(n-1,:)+40*log10(L1Ed_DS00CaDyn_cai(n-1,:))))+18)<p.L1Ed_DS00iKCa_eps).*p.L1Ed_DS00iKCa_eps+(abs(((L1Ed_V(n-1,:)+40*log10(L1Ed_DS00CaDyn_cai(n-1,:))))+18)>=p.L1Ed_DS00iKCa_eps).*((L1Ed_V(n-1,:)+40*log10(L1Ed_DS00CaDyn_cai(n-1,:))))+18))))./(-1+exp((( ((abs(((L1Ed_V(n-1,:)+40*log10(L1Ed_DS00CaDyn_cai(n-1,:))))+18)<p.L1Ed_DS00iKCa_eps).*p.L1Ed_DS00iKCa_eps+(abs(((L1Ed_V(n-1,:)+40*log10(L1Ed_DS00CaDyn_cai(n-1,:))))+18)>=p.L1Ed_DS00iKCa_eps).*((L1Ed_V(n-1,:)+40*log10(L1Ed_DS00CaDyn_cai(n-1,:))))+18)))./(-12)))))+((1.7*exp((((L1Ed_V(n-1,:)+40*log10(L1Ed_DS00CaDyn_cai(n-1,:))))+152)./(-30.0)))))))-L1Ed_DS00iKCa_c(n-1,:))./((1./((((-0.00642*(( ((abs(((L1Ed_V(n-1,:)+40*log10(L1Ed_DS00CaDyn_cai(n-1,:))))+18)<p.L1Ed_DS00iKCa_eps).*p.L1Ed_DS00iKCa_eps+(abs(((L1Ed_V(n-1,:)+40*log10(L1Ed_DS00CaDyn_cai(n-1,:))))+18)>=p.L1Ed_DS00iKCa_eps).*((L1Ed_V(n-1,:)+40*log10(L1Ed_DS00CaDyn_cai(n-1,:))))+18))))./(-1+exp((( ((abs(((L1Ed_V(n-1,:)+40*log10(L1Ed_DS00CaDyn_cai(n-1,:))))+18)<p.L1Ed_DS00iKCa_eps).*p.L1Ed_DS00iKCa_eps+(abs(((L1Ed_V(n-1,:)+40*log10(L1Ed_DS00CaDyn_cai(n-1,:))))+18)>=p.L1Ed_DS00iKCa_eps).*((L1Ed_V(n-1,:)+40*log10(L1Ed_DS00CaDyn_cai(n-1,:))))+18)))./(-12)))))+((1.7*exp((((L1Ed_V(n-1,:)+40*log10(L1Ed_DS00CaDyn_cai(n-1,:))))+152)./(-30.0)))))));
  L1Ed_DS00CaDyn_cai_k1= -p.L1Ed_DS00CaDyn_CAF.*((((p.L1Ed_DS02iHVA_ghva.*L1Ed_DS02iHVA_u(n-1,:).^2.*L1Ed_DS02iHVA_w(n-1,:).*(L1Ed_V(n-1,:)-((min(500,12.5*log(p.L1Ed_DS02iHVA_cao./L1Ed_DS00CaDyn_cai(n-1,:))))))))))./(p.L1Ed_DS00CaDyn_faraday*p.L1Ed_DS00CaDyn_VshellCa)+(p.L1Ed_DS00CaDyn_cainf-L1Ed_DS00CaDyn_cai(n-1,:))./p.L1Ed_DS00CaDyn_tauCa;
  L1Ed_DS00KDyn_ko_k1= p.L1Ed_DS00KDyn_KAF.*((((p.L1Ed_DS00iDR_gkdr.*L1Ed_DS00iDR_n(n-1,:).^4.*(L1Ed_V(n-1,:)-((25*log(L1Ed_DS00KDyn_ko(n-1,:)/p.L1Ed_DS00iDR_ki)))))))+(((( p.L1Ed_DS02iKS_gks.*L1Ed_DS02iKS_a(n-1,:).*L1Ed_DS02iKS_b(n-1,:).*(L1Ed_V(n-1,:)-((25*log(L1Ed_DS00KDyn_ko(n-1,:)/p.L1Ed_DS02iKS_ki)))))))+((((p.L1Ed_DS00iKCa_gkc.*L1Ed_DS00iKCa_c(n-1,:).^2.*(L1Ed_V(n-1,:)-((25*log(L1Ed_DS00KDyn_ko(n-1,:)/p.L1Ed_DS00iKCa_ki))))))))))./(p.L1Ed_DS00KDyn_faraday*p.L1Ed_DS00KDyn_VshellK)+(p.L1Ed_DS00KDyn_koinf-L1Ed_DS00KDyn_ko(n-1,:))./p.L1Ed_DS00KDyn_tauK;
  L1Ed_TW03iH_m_k1= (( p.L1Ed_TW03iH_c_ARaM.*((( 1 ./ (1+exp((p.L1Ed_TW03iH_AR_V12-L1Ed_V(n-1,:))/p.L1Ed_TW03iH_AR_k)))) ./ (( 1./(p.L1Ed_TW03iH_AR_L.*exp(-14.6-.086*L1Ed_V(n-1,:))+p.L1Ed_TW03iH_AR_R.*exp(-1.87+.07*L1Ed_V(n-1,:)))))))).*(1-L1Ed_TW03iH_m(n-1,:))-(( p.L1Ed_TW03iH_c_ARbM.*((1-(( 1 ./ (1+exp((p.L1Ed_TW03iH_AR_V12-L1Ed_V(n-1,:))/p.L1Ed_TW03iH_AR_k)))))./(( 1./(p.L1Ed_TW03iH_AR_L.*exp(-14.6-.086*L1Ed_V(n-1,:))+p.L1Ed_TW03iH_AR_R.*exp(-1.87+.07*L1Ed_V(n-1,:)))))))).*L1Ed_TW03iH_m(n-1,:);
  L1FS_V_k1=(((-((p.L1FS_DS00iNa_gnaf.*L1FS_DS00iNa_m(n-1).^3.*L1FS_DS00iNa_h(n-1).*(L1FS_V(n-1)-p.L1FS_DS00iNa_ENa))))+((-((p.L1FS_DS00iDR_gkdr.*L1FS_DS00iDR_n(n-1).^4.*(L1FS_V(n-1)-((25*log(L1FS_DS00KDyn_ko(n-1)/p.L1FS_DS00iDR_ki)))))))+((-(( p.L1FS_TW03iH_gH.*L1FS_TW03iH_m(n-1).*(L1FS_V(n-1)-p.L1FS_TW03iH_E_AR))))+((-((p.L1FS_pas_gpas.*(L1FS_V(n-1)-p.L1FS_pas_epas))))+((-(( (p.L1FS_L1Es_iAMPA_gAMPA.*(L1FS_L1Es_iAMPA_s(n-1,:)*L1FS_L1Es_iAMPA_netcon).*(L1FS_V(n-1)-p.L1FS_L1Es_iAMPA_EAMPA)))))+((-(( p.L1FS_L1Es_iNMDA_gNMDA.*(( (1.50265./(1+0.33*exp(L1FS_V(n-1)./(-16)))))).*(L1FS_L1Es_iNMDA_s(n-1,:)*L1FS_L1Es_iNMDA_netcon).*(L1FS_V(n-1)-p.L1FS_L1Es_iNMDA_ENMDA))))+((-(( (p.L1FS_L1FS_iGABA_gGABA.*(L1FS_L1FS_iGABA_s(n-1)*L1FS_L1FS_iGABA_netcon).*(L1FS_V(n-1)-p.L1FS_L1FS_iGABA_EGABA)))))+((-(( (p.L1FS_L1RSNP_iGABA_gGABA.*(L1FS_L1RSNP_iGABA_s(n-1)*L1FS_L1RSNP_iGABA_netcon).*(L1FS_V(n-1)-p.L1FS_L1RSNP_iGABA_EGABA)))))))))))))+p.L1FS_Iapp)./p.L1FS_Cm;
  L1FS_DS00iNa_m_k1=((((((-.2816*(( ((abs(L1FS_V(n-1)-p.L1FS_DS00iNa_amV0)<p.L1FS_DS00iNa_eps).*p.L1FS_DS00iNa_eps+(abs(L1FS_V(n-1)-p.L1FS_DS00iNa_amV0)>=p.L1FS_DS00iNa_eps).*L1FS_V(n-1)-p.L1FS_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L1FS_V(n-1)-p.L1FS_DS00iNa_amV0)<p.L1FS_DS00iNa_eps).*p.L1FS_DS00iNa_eps+(abs(L1FS_V(n-1)-p.L1FS_DS00iNa_amV0)>=p.L1FS_DS00iNa_eps).*L1FS_V(n-1)-p.L1FS_DS00iNa_amV0)))/9.3))))./((((-.2816*(( ((abs(L1FS_V(n-1)-p.L1FS_DS00iNa_amV0)<p.L1FS_DS00iNa_eps).*p.L1FS_DS00iNa_eps+(abs(L1FS_V(n-1)-p.L1FS_DS00iNa_amV0)>=p.L1FS_DS00iNa_eps).*L1FS_V(n-1)-p.L1FS_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L1FS_V(n-1)-p.L1FS_DS00iNa_amV0)<p.L1FS_DS00iNa_eps).*p.L1FS_DS00iNa_eps+(abs(L1FS_V(n-1)-p.L1FS_DS00iNa_amV0)>=p.L1FS_DS00iNa_eps).*L1FS_V(n-1)-p.L1FS_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(L1FS_V(n-1)-p.L1FS_DS00iNa_bmV0)<p.L1FS_DS00iNa_eps).*p.L1FS_DS00iNa_eps+(abs(L1FS_V(n-1)-p.L1FS_DS00iNa_bmV0)>=p.L1FS_DS00iNa_eps).*L1FS_V(n-1)-p.L1FS_DS00iNa_bmV0))))./(-1+exp((( ((abs(L1FS_V(n-1)-p.L1FS_DS00iNa_bmV0)<p.L1FS_DS00iNa_eps).*p.L1FS_DS00iNa_eps+(abs(L1FS_V(n-1)-p.L1FS_DS00iNa_bmV0)>=p.L1FS_DS00iNa_eps).*L1FS_V(n-1)-p.L1FS_DS00iNa_bmV0)))/6)))))))-L1FS_DS00iNa_m(n-1))./((1./((((-.2816*(( ((abs(L1FS_V(n-1)-p.L1FS_DS00iNa_amV0)<p.L1FS_DS00iNa_eps).*p.L1FS_DS00iNa_eps+(abs(L1FS_V(n-1)-p.L1FS_DS00iNa_amV0)>=p.L1FS_DS00iNa_eps).*L1FS_V(n-1)-p.L1FS_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L1FS_V(n-1)-p.L1FS_DS00iNa_amV0)<p.L1FS_DS00iNa_eps).*p.L1FS_DS00iNa_eps+(abs(L1FS_V(n-1)-p.L1FS_DS00iNa_amV0)>=p.L1FS_DS00iNa_eps).*L1FS_V(n-1)-p.L1FS_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(L1FS_V(n-1)-p.L1FS_DS00iNa_bmV0)<p.L1FS_DS00iNa_eps).*p.L1FS_DS00iNa_eps+(abs(L1FS_V(n-1)-p.L1FS_DS00iNa_bmV0)>=p.L1FS_DS00iNa_eps).*L1FS_V(n-1)-p.L1FS_DS00iNa_bmV0))))./(-1+exp((( ((abs(L1FS_V(n-1)-p.L1FS_DS00iNa_bmV0)<p.L1FS_DS00iNa_eps).*p.L1FS_DS00iNa_eps+(abs(L1FS_V(n-1)-p.L1FS_DS00iNa_bmV0)>=p.L1FS_DS00iNa_eps).*L1FS_V(n-1)-p.L1FS_DS00iNa_bmV0)))/6)))))));
  L1FS_DS00iNa_h_k1=(((((p.L1FS_DS00iNa_hnascale.*.098./exp((L1FS_V(n-1)-p.L1FS_DS00iNa_ahV0)/20)))./(((p.L1FS_DS00iNa_hnascale.*.098./exp((L1FS_V(n-1)-p.L1FS_DS00iNa_ahV0)/20)))+((p.L1FS_DS00iNa_hnascale.*1.4./(1+exp(-(L1FS_V(n-1)-p.L1FS_DS00iNa_bhV0)/10)))))))-L1FS_DS00iNa_h(n-1))./((1./(((p.L1FS_DS00iNa_hnascale.*.098./exp((L1FS_V(n-1)-p.L1FS_DS00iNa_ahV0)/20)))+((p.L1FS_DS00iNa_hnascale.*1.4./(1+exp(-(L1FS_V(n-1)-p.L1FS_DS00iNa_bhV0)/10)))))));
  L1FS_DS00iDR_n_k1=(((((-.018*(( ((abs(L1FS_V(n-1)-p.L1FS_DS00iDR_anV0)<p.L1FS_DS00iDR_eps).*p.L1FS_DS00iDR_eps+(abs(L1FS_V(n-1)-p.L1FS_DS00iDR_anV0)>=p.L1FS_DS00iDR_eps).*L1FS_V(n-1)-p.L1FS_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L1FS_V(n-1)-p.L1FS_DS00iDR_anV0)<p.L1FS_DS00iDR_eps).*p.L1FS_DS00iDR_eps+(abs(L1FS_V(n-1)-p.L1FS_DS00iDR_anV0)>=p.L1FS_DS00iDR_eps).*L1FS_V(n-1)-p.L1FS_DS00iDR_anV0)))/25))))./(((-.018*(( ((abs(L1FS_V(n-1)-p.L1FS_DS00iDR_anV0)<p.L1FS_DS00iDR_eps).*p.L1FS_DS00iDR_eps+(abs(L1FS_V(n-1)-p.L1FS_DS00iDR_anV0)>=p.L1FS_DS00iDR_eps).*L1FS_V(n-1)-p.L1FS_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L1FS_V(n-1)-p.L1FS_DS00iDR_anV0)<p.L1FS_DS00iDR_eps).*p.L1FS_DS00iDR_eps+(abs(L1FS_V(n-1)-p.L1FS_DS00iDR_anV0)>=p.L1FS_DS00iDR_eps).*L1FS_V(n-1)-p.L1FS_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(L1FS_V(n-1)-p.L1FS_DS00iDR_bnV0)<p.L1FS_DS00iDR_eps).*p.L1FS_DS00iDR_eps+(abs(L1FS_V(n-1)-p.L1FS_DS00iDR_bnV0)>=p.L1FS_DS00iDR_eps).*L1FS_V(n-1)-p.L1FS_DS00iDR_bnV0)))./(-1+exp((( ((abs(L1FS_V(n-1)-p.L1FS_DS00iDR_bnV0)<p.L1FS_DS00iDR_eps).*p.L1FS_DS00iDR_eps+(abs(L1FS_V(n-1)-p.L1FS_DS00iDR_bnV0)>=p.L1FS_DS00iDR_eps).*L1FS_V(n-1)-p.L1FS_DS00iDR_bnV0)))/12)))))))-L1FS_DS00iDR_n(n-1))./((1./(((-.018*(( ((abs(L1FS_V(n-1)-p.L1FS_DS00iDR_anV0)<p.L1FS_DS00iDR_eps).*p.L1FS_DS00iDR_eps+(abs(L1FS_V(n-1)-p.L1FS_DS00iDR_anV0)>=p.L1FS_DS00iDR_eps).*L1FS_V(n-1)-p.L1FS_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L1FS_V(n-1)-p.L1FS_DS00iDR_anV0)<p.L1FS_DS00iDR_eps).*p.L1FS_DS00iDR_eps+(abs(L1FS_V(n-1)-p.L1FS_DS00iDR_anV0)>=p.L1FS_DS00iDR_eps).*L1FS_V(n-1)-p.L1FS_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(L1FS_V(n-1)-p.L1FS_DS00iDR_bnV0)<p.L1FS_DS00iDR_eps).*p.L1FS_DS00iDR_eps+(abs(L1FS_V(n-1)-p.L1FS_DS00iDR_bnV0)>=p.L1FS_DS00iDR_eps).*L1FS_V(n-1)-p.L1FS_DS00iDR_bnV0)))./(-1+exp((( ((abs(L1FS_V(n-1)-p.L1FS_DS00iDR_bnV0)<p.L1FS_DS00iDR_eps).*p.L1FS_DS00iDR_eps+(abs(L1FS_V(n-1)-p.L1FS_DS00iDR_bnV0)>=p.L1FS_DS00iDR_eps).*L1FS_V(n-1)-p.L1FS_DS00iDR_bnV0)))/12)))))));
  L1FS_DS00KDyn_ko_k1= p.L1FS_DS00KDyn_KAF.*((((p.L1FS_DS00iDR_gkdr.*L1FS_DS00iDR_n(n-1).^4.*(L1FS_V(n-1)-((25*log(L1FS_DS00KDyn_ko(n-1)/p.L1FS_DS00iDR_ki))))))))./(p.L1FS_DS00KDyn_faraday*p.L1FS_DS00KDyn_VshellK)+(p.L1FS_DS00KDyn_koinf-L1FS_DS00KDyn_ko(n-1))./p.L1FS_DS00KDyn_tauK;
  L1FS_TW03iH_m_k1= (( p.L1FS_TW03iH_c_ARaM.*((( 1 ./ (1+exp((p.L1FS_TW03iH_AR_V12-L1FS_V(n-1))/p.L1FS_TW03iH_AR_k)))) ./ (( 1./(p.L1FS_TW03iH_AR_L.*exp(-14.6-.086*L1FS_V(n-1))+p.L1FS_TW03iH_AR_R.*exp(-1.87+.07*L1FS_V(n-1)))))))).*(1-L1FS_TW03iH_m(n-1))-(( p.L1FS_TW03iH_c_ARbM.*((1-(( 1 ./ (1+exp((p.L1FS_TW03iH_AR_V12-L1FS_V(n-1))/p.L1FS_TW03iH_AR_k)))))./(( 1./(p.L1FS_TW03iH_AR_L.*exp(-14.6-.086*L1FS_V(n-1))+p.L1FS_TW03iH_AR_R.*exp(-1.87+.07*L1FS_V(n-1)))))))).*L1FS_TW03iH_m(n-1);
  L1RSNP_V_k1=(((-((p.L1RSNP_DS00iNa_gnaf.*L1RSNP_DS00iNa_m(n-1).^3.*L1RSNP_DS00iNa_h(n-1).*(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_ENa))))+((-((p.L1RSNP_DS00iDR_gkdr.*L1RSNP_DS00iDR_n(n-1).^4.*(L1RSNP_V(n-1)-((25*log(L1RSNP_DS00KDyn_ko(n-1)/p.L1RSNP_DS00iDR_ki)))))))+((-(( p.L1RSNP_TW03iH_gH.*L1RSNP_TW03iH_m(n-1).*(L1RSNP_V(n-1)-p.L1RSNP_TW03iH_E_AR))))+((-((p.L1RSNP_pas_gpas.*(L1RSNP_V(n-1)-p.L1RSNP_pas_epas))))+((-(( (p.L1RSNP_L1Es_iAMPA_gAMPA.*(L1RSNP_L1Es_iAMPA_s(n-1,:)*L1RSNP_L1Es_iAMPA_netcon).*(L1RSNP_V(n-1)-p.L1RSNP_L1Es_iAMPA_EAMPA)))))+((-(( (p.L1RSNP_L1RSNP_iGABA_gGABA.*(L1RSNP_L1RSNP_iGABA_s(n-1)*L1RSNP_L1RSNP_iGABA_netcon).*(L1RSNP_V(n-1)-p.L1RSNP_L1RSNP_iGABA_EGABA)))))+((-(( (p.L1RSNP_L1FS_iGABA_gGABA.*(L1RSNP_L1FS_iGABA_s(n-1)*L1RSNP_L1FS_iGABA_netcon).*(L1RSNP_V(n-1)-p.L1RSNP_L1FS_iGABA_EGABA))))))))))))+p.L1RSNP_Iapp)./p.L1RSNP_Cm;
  L1RSNP_DS00iNa_m_k1=((((((-.2816*(( ((abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_amV0)<p.L1RSNP_DS00iNa_eps).*p.L1RSNP_DS00iNa_eps+(abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_amV0)>=p.L1RSNP_DS00iNa_eps).*L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_amV0)<p.L1RSNP_DS00iNa_eps).*p.L1RSNP_DS00iNa_eps+(abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_amV0)>=p.L1RSNP_DS00iNa_eps).*L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_amV0)))/9.3))))./((((-.2816*(( ((abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_amV0)<p.L1RSNP_DS00iNa_eps).*p.L1RSNP_DS00iNa_eps+(abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_amV0)>=p.L1RSNP_DS00iNa_eps).*L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_amV0)<p.L1RSNP_DS00iNa_eps).*p.L1RSNP_DS00iNa_eps+(abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_amV0)>=p.L1RSNP_DS00iNa_eps).*L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_bmV0)<p.L1RSNP_DS00iNa_eps).*p.L1RSNP_DS00iNa_eps+(abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_bmV0)>=p.L1RSNP_DS00iNa_eps).*L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_bmV0))))./(-1+exp((( ((abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_bmV0)<p.L1RSNP_DS00iNa_eps).*p.L1RSNP_DS00iNa_eps+(abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_bmV0)>=p.L1RSNP_DS00iNa_eps).*L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_bmV0)))/6)))))))-L1RSNP_DS00iNa_m(n-1))./((1./((((-.2816*(( ((abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_amV0)<p.L1RSNP_DS00iNa_eps).*p.L1RSNP_DS00iNa_eps+(abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_amV0)>=p.L1RSNP_DS00iNa_eps).*L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_amV0)<p.L1RSNP_DS00iNa_eps).*p.L1RSNP_DS00iNa_eps+(abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_amV0)>=p.L1RSNP_DS00iNa_eps).*L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_bmV0)<p.L1RSNP_DS00iNa_eps).*p.L1RSNP_DS00iNa_eps+(abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_bmV0)>=p.L1RSNP_DS00iNa_eps).*L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_bmV0))))./(-1+exp((( ((abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_bmV0)<p.L1RSNP_DS00iNa_eps).*p.L1RSNP_DS00iNa_eps+(abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_bmV0)>=p.L1RSNP_DS00iNa_eps).*L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_bmV0)))/6)))))));
  L1RSNP_DS00iNa_h_k1=(((((p.L1RSNP_DS00iNa_hnascale.*.098./exp((L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_ahV0)/20)))./(((p.L1RSNP_DS00iNa_hnascale.*.098./exp((L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_ahV0)/20)))+((p.L1RSNP_DS00iNa_hnascale.*1.4./(1+exp(-(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_bhV0)/10)))))))-L1RSNP_DS00iNa_h(n-1))./((1./(((p.L1RSNP_DS00iNa_hnascale.*.098./exp((L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_ahV0)/20)))+((p.L1RSNP_DS00iNa_hnascale.*1.4./(1+exp(-(L1RSNP_V(n-1)-p.L1RSNP_DS00iNa_bhV0)/10)))))));
  L1RSNP_DS00iDR_n_k1=(((((-.018*(( ((abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_anV0)<p.L1RSNP_DS00iDR_eps).*p.L1RSNP_DS00iDR_eps+(abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_anV0)>=p.L1RSNP_DS00iDR_eps).*L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_anV0)<p.L1RSNP_DS00iDR_eps).*p.L1RSNP_DS00iDR_eps+(abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_anV0)>=p.L1RSNP_DS00iDR_eps).*L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_anV0)))/25))))./(((-.018*(( ((abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_anV0)<p.L1RSNP_DS00iDR_eps).*p.L1RSNP_DS00iDR_eps+(abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_anV0)>=p.L1RSNP_DS00iDR_eps).*L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_anV0)<p.L1RSNP_DS00iDR_eps).*p.L1RSNP_DS00iDR_eps+(abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_anV0)>=p.L1RSNP_DS00iDR_eps).*L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_bnV0)<p.L1RSNP_DS00iDR_eps).*p.L1RSNP_DS00iDR_eps+(abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_bnV0)>=p.L1RSNP_DS00iDR_eps).*L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_bnV0)))./(-1+exp((( ((abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_bnV0)<p.L1RSNP_DS00iDR_eps).*p.L1RSNP_DS00iDR_eps+(abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_bnV0)>=p.L1RSNP_DS00iDR_eps).*L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_bnV0)))/12)))))))-L1RSNP_DS00iDR_n(n-1))./((1./(((-.018*(( ((abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_anV0)<p.L1RSNP_DS00iDR_eps).*p.L1RSNP_DS00iDR_eps+(abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_anV0)>=p.L1RSNP_DS00iDR_eps).*L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_anV0)<p.L1RSNP_DS00iDR_eps).*p.L1RSNP_DS00iDR_eps+(abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_anV0)>=p.L1RSNP_DS00iDR_eps).*L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_bnV0)<p.L1RSNP_DS00iDR_eps).*p.L1RSNP_DS00iDR_eps+(abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_bnV0)>=p.L1RSNP_DS00iDR_eps).*L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_bnV0)))./(-1+exp((( ((abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_bnV0)<p.L1RSNP_DS00iDR_eps).*p.L1RSNP_DS00iDR_eps+(abs(L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_bnV0)>=p.L1RSNP_DS00iDR_eps).*L1RSNP_V(n-1)-p.L1RSNP_DS00iDR_bnV0)))/12)))))));
  L1RSNP_DS00KDyn_ko_k1= p.L1RSNP_DS00KDyn_KAF.*((((p.L1RSNP_DS00iDR_gkdr.*L1RSNP_DS00iDR_n(n-1).^4.*(L1RSNP_V(n-1)-((25*log(L1RSNP_DS00KDyn_ko(n-1)/p.L1RSNP_DS00iDR_ki))))))))./(p.L1RSNP_DS00KDyn_faraday*p.L1RSNP_DS00KDyn_VshellK)+(p.L1RSNP_DS00KDyn_koinf-L1RSNP_DS00KDyn_ko(n-1))./p.L1RSNP_DS00KDyn_tauK;
  L1RSNP_TW03iH_m_k1= (( p.L1RSNP_TW03iH_c_ARaM.*((( 1 ./ (1+exp((p.L1RSNP_TW03iH_AR_V12-L1RSNP_V(n-1))/p.L1RSNP_TW03iH_AR_k)))) ./ (( 1./(p.L1RSNP_TW03iH_AR_L.*exp(-14.6-.086*L1RSNP_V(n-1))+p.L1RSNP_TW03iH_AR_R.*exp(-1.87+.07*L1RSNP_V(n-1)))))))).*(1-L1RSNP_TW03iH_m(n-1))-(( p.L1RSNP_TW03iH_c_ARbM.*((1-(( 1 ./ (1+exp((p.L1RSNP_TW03iH_AR_V12-L1RSNP_V(n-1))/p.L1RSNP_TW03iH_AR_k)))))./(( 1./(p.L1RSNP_TW03iH_AR_L.*exp(-14.6-.086*L1RSNP_V(n-1))+p.L1RSNP_TW03iH_AR_R.*exp(-1.87+.07*L1RSNP_V(n-1)))))))).*L1RSNP_TW03iH_m(n-1);
  L2Es_V_k1=(((-((p.L2Es_DS00iNa_gnaf.*L2Es_DS00iNa_m(n-1,:).^3.*L2Es_DS00iNa_h(n-1,:).*(L2Es_V(n-1,:)-p.L2Es_DS00iNa_ENa))))+((-((p.L2Es_DS00iNaP_gnap.*L2Es_DS00iNaP_m(n-1,:).*L2Es_DS00iNaP_h(n-1,:).*(L2Es_V(n-1,:)-p.L2Es_DS00iNaP_ENa))))+((-((p.L2Es_DS00iDR_gkdr.*L2Es_DS00iDR_n(n-1,:).^4.*(L2Es_V(n-1,:)-((25*log(L2Es_DS00KDyn_ko(n-1,:)/p.L2Es_DS00iDR_ki)))))))+((-(( p.L2Es_DS02iKS_gks.*L2Es_DS02iKS_a(n-1,:).*L2Es_DS02iKS_b(n-1,:).*(L2Es_V(n-1,:)-((25*log(L2Es_DS00KDyn_ko(n-1,:)/p.L2Es_DS02iKS_ki)))))))+((-((p.L2Es_DS02iHVA_ghva.*L2Es_DS02iHVA_u(n-1,:).^2.*L2Es_DS02iHVA_w(n-1,:).*(L2Es_V(n-1,:)-((min(500,12.5*log(p.L2Es_DS02iHVA_cao./L2Es_DS00CaDyn_cai(n-1,:)))))))))+((-((p.L2Es_DS00iKCa_gkc.*L2Es_DS00iKCa_c(n-1,:).^2.*(L2Es_V(n-1,:)-((25*log(L2Es_DS00KDyn_ko(n-1,:)/p.L2Es_DS00iKCa_ki)))))))+((-(( p.L2Es_TW03iH_gH.*L2Es_TW03iH_m(n-1,:).*(L2Es_V(n-1,:)-p.L2Es_TW03iH_E_AR))))+((-((p.L2Es_pas_gpas.*(L2Es_V(n-1,:)-p.L2Es_pas_epas))))+(((( p.L2Es_L2Ed_iCOM_gCOM.*(L2Ed_V(n-1,:)-L2Es_V(n-1,:)))))+((-(( (p.L2Es_L2FS_iGABA_gGABA.*(L2Es_L2FS_iGABA_s(n-1,:)*L2Es_L2FS_iGABA_netcon).*(L2Es_V(n-1,:)-p.L2Es_L2FS_iGABA_EGABA)))))))))))))))+p.L2Es_Iapp)./p.L2Es_Cm;
  L2Es_DS00iNa_m_k1=((((((-.2816*(( ((abs(L2Es_V(n-1,:)-p.L2Es_DS00iNa_amV0)<p.L2Es_DS00iNa_eps).*p.L2Es_DS00iNa_eps+(abs(L2Es_V(n-1,:)-p.L2Es_DS00iNa_amV0)>=p.L2Es_DS00iNa_eps).*L2Es_V(n-1,:)-p.L2Es_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L2Es_V(n-1,:)-p.L2Es_DS00iNa_amV0)<p.L2Es_DS00iNa_eps).*p.L2Es_DS00iNa_eps+(abs(L2Es_V(n-1,:)-p.L2Es_DS00iNa_amV0)>=p.L2Es_DS00iNa_eps).*L2Es_V(n-1,:)-p.L2Es_DS00iNa_amV0)))/9.3))))./((((-.2816*(( ((abs(L2Es_V(n-1,:)-p.L2Es_DS00iNa_amV0)<p.L2Es_DS00iNa_eps).*p.L2Es_DS00iNa_eps+(abs(L2Es_V(n-1,:)-p.L2Es_DS00iNa_amV0)>=p.L2Es_DS00iNa_eps).*L2Es_V(n-1,:)-p.L2Es_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L2Es_V(n-1,:)-p.L2Es_DS00iNa_amV0)<p.L2Es_DS00iNa_eps).*p.L2Es_DS00iNa_eps+(abs(L2Es_V(n-1,:)-p.L2Es_DS00iNa_amV0)>=p.L2Es_DS00iNa_eps).*L2Es_V(n-1,:)-p.L2Es_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(L2Es_V(n-1,:)-p.L2Es_DS00iNa_bmV0)<p.L2Es_DS00iNa_eps).*p.L2Es_DS00iNa_eps+(abs(L2Es_V(n-1,:)-p.L2Es_DS00iNa_bmV0)>=p.L2Es_DS00iNa_eps).*L2Es_V(n-1,:)-p.L2Es_DS00iNa_bmV0))))./(-1+exp((( ((abs(L2Es_V(n-1,:)-p.L2Es_DS00iNa_bmV0)<p.L2Es_DS00iNa_eps).*p.L2Es_DS00iNa_eps+(abs(L2Es_V(n-1,:)-p.L2Es_DS00iNa_bmV0)>=p.L2Es_DS00iNa_eps).*L2Es_V(n-1,:)-p.L2Es_DS00iNa_bmV0)))/6)))))))-L2Es_DS00iNa_m(n-1,:))./((1./((((-.2816*(( ((abs(L2Es_V(n-1,:)-p.L2Es_DS00iNa_amV0)<p.L2Es_DS00iNa_eps).*p.L2Es_DS00iNa_eps+(abs(L2Es_V(n-1,:)-p.L2Es_DS00iNa_amV0)>=p.L2Es_DS00iNa_eps).*L2Es_V(n-1,:)-p.L2Es_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L2Es_V(n-1,:)-p.L2Es_DS00iNa_amV0)<p.L2Es_DS00iNa_eps).*p.L2Es_DS00iNa_eps+(abs(L2Es_V(n-1,:)-p.L2Es_DS00iNa_amV0)>=p.L2Es_DS00iNa_eps).*L2Es_V(n-1,:)-p.L2Es_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(L2Es_V(n-1,:)-p.L2Es_DS00iNa_bmV0)<p.L2Es_DS00iNa_eps).*p.L2Es_DS00iNa_eps+(abs(L2Es_V(n-1,:)-p.L2Es_DS00iNa_bmV0)>=p.L2Es_DS00iNa_eps).*L2Es_V(n-1,:)-p.L2Es_DS00iNa_bmV0))))./(-1+exp((( ((abs(L2Es_V(n-1,:)-p.L2Es_DS00iNa_bmV0)<p.L2Es_DS00iNa_eps).*p.L2Es_DS00iNa_eps+(abs(L2Es_V(n-1,:)-p.L2Es_DS00iNa_bmV0)>=p.L2Es_DS00iNa_eps).*L2Es_V(n-1,:)-p.L2Es_DS00iNa_bmV0)))/6)))))));
  L2Es_DS00iNa_h_k1=(((((p.L2Es_DS00iNa_hnascale.*.098./exp((L2Es_V(n-1,:)-p.L2Es_DS00iNa_ahV0)/20)))./(((p.L2Es_DS00iNa_hnascale.*.098./exp((L2Es_V(n-1,:)-p.L2Es_DS00iNa_ahV0)/20)))+((p.L2Es_DS00iNa_hnascale.*1.4./(1+exp(-(L2Es_V(n-1,:)-p.L2Es_DS00iNa_bhV0)/10)))))))-L2Es_DS00iNa_h(n-1,:))./((1./(((p.L2Es_DS00iNa_hnascale.*.098./exp((L2Es_V(n-1,:)-p.L2Es_DS00iNa_ahV0)/20)))+((p.L2Es_DS00iNa_hnascale.*1.4./(1+exp(-(L2Es_V(n-1,:)-p.L2Es_DS00iNa_bhV0)/10)))))));
  L2Es_DS00iNaP_m_k1=((((((-.2816*(( ((abs(L2Es_V(n-1,:)+12)<p.L2Es_DS00iNaP_eps).*p.L2Es_DS00iNaP_eps+(abs(L2Es_V(n-1,:)+12)>=p.L2Es_DS00iNaP_eps).*L2Es_V(n-1,:)+12))))./(-1+exp(-(( ((abs(L2Es_V(n-1,:)+12)<p.L2Es_DS00iNaP_eps).*p.L2Es_DS00iNaP_eps+(abs(L2Es_V(n-1,:)+12)>=p.L2Es_DS00iNaP_eps).*L2Es_V(n-1,:)+12)))/9.3))))./((((-.2816*(( ((abs(L2Es_V(n-1,:)+12)<p.L2Es_DS00iNaP_eps).*p.L2Es_DS00iNaP_eps+(abs(L2Es_V(n-1,:)+12)>=p.L2Es_DS00iNaP_eps).*L2Es_V(n-1,:)+12))))./(-1+exp(-(( ((abs(L2Es_V(n-1,:)+12)<p.L2Es_DS00iNaP_eps).*p.L2Es_DS00iNaP_eps+(abs(L2Es_V(n-1,:)+12)>=p.L2Es_DS00iNaP_eps).*L2Es_V(n-1,:)+12)))/9.3))))+(((.2464*(( ((abs(L2Es_V(n-1,:)-15)<p.L2Es_DS00iNaP_eps).*p.L2Es_DS00iNaP_eps+(abs(L2Es_V(n-1,:)-15)>=p.L2Es_DS00iNaP_eps).*L2Es_V(n-1,:)-15))))./(-1+exp((( ((abs(L2Es_V(n-1,:)-15)<p.L2Es_DS00iNaP_eps).*p.L2Es_DS00iNaP_eps+(abs(L2Es_V(n-1,:)-15)>=p.L2Es_DS00iNaP_eps).*L2Es_V(n-1,:)-15)))/6)))))))-L2Es_DS00iNaP_m(n-1,:))./((1./((((-.2816*(( ((abs(L2Es_V(n-1,:)+12)<p.L2Es_DS00iNaP_eps).*p.L2Es_DS00iNaP_eps+(abs(L2Es_V(n-1,:)+12)>=p.L2Es_DS00iNaP_eps).*L2Es_V(n-1,:)+12))))./(-1+exp(-(( ((abs(L2Es_V(n-1,:)+12)<p.L2Es_DS00iNaP_eps).*p.L2Es_DS00iNaP_eps+(abs(L2Es_V(n-1,:)+12)>=p.L2Es_DS00iNaP_eps).*L2Es_V(n-1,:)+12)))/9.3))))+(((.2464*(( ((abs(L2Es_V(n-1,:)-15)<p.L2Es_DS00iNaP_eps).*p.L2Es_DS00iNaP_eps+(abs(L2Es_V(n-1,:)-15)>=p.L2Es_DS00iNaP_eps).*L2Es_V(n-1,:)-15))))./(-1+exp((( ((abs(L2Es_V(n-1,:)-15)<p.L2Es_DS00iNaP_eps).*p.L2Es_DS00iNaP_eps+(abs(L2Es_V(n-1,:)-15)>=p.L2Es_DS00iNaP_eps).*L2Es_V(n-1,:)-15)))/6)))))));
  L2Es_DS00iNaP_h_k1=(((((2.8e-5./exp((L2Es_V(n-1,:)+42.8477)/4.0248)))./(((2.8e-5./exp((L2Es_V(n-1,:)+42.8477)/4.0248)))+((.02./(1+exp(-(L2Es_V(n-1,:)-413.9284)/148.2589)))))))-L2Es_DS00iNaP_h(n-1,:))./((p.L2Es_DS00iNaP_htaunap*1./(((2.8e-5./exp((L2Es_V(n-1,:)+42.8477)/4.0248)))+((.02./(1+exp(-(L2Es_V(n-1,:)-413.9284)/148.2589)))))));
  L2Es_DS00iDR_n_k1=(((((-.018*(( ((abs(L2Es_V(n-1,:)-p.L2Es_DS00iDR_anV0)<p.L2Es_DS00iDR_eps).*p.L2Es_DS00iDR_eps+(abs(L2Es_V(n-1,:)-p.L2Es_DS00iDR_anV0)>=p.L2Es_DS00iDR_eps).*L2Es_V(n-1,:)-p.L2Es_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L2Es_V(n-1,:)-p.L2Es_DS00iDR_anV0)<p.L2Es_DS00iDR_eps).*p.L2Es_DS00iDR_eps+(abs(L2Es_V(n-1,:)-p.L2Es_DS00iDR_anV0)>=p.L2Es_DS00iDR_eps).*L2Es_V(n-1,:)-p.L2Es_DS00iDR_anV0)))/25))))./(((-.018*(( ((abs(L2Es_V(n-1,:)-p.L2Es_DS00iDR_anV0)<p.L2Es_DS00iDR_eps).*p.L2Es_DS00iDR_eps+(abs(L2Es_V(n-1,:)-p.L2Es_DS00iDR_anV0)>=p.L2Es_DS00iDR_eps).*L2Es_V(n-1,:)-p.L2Es_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L2Es_V(n-1,:)-p.L2Es_DS00iDR_anV0)<p.L2Es_DS00iDR_eps).*p.L2Es_DS00iDR_eps+(abs(L2Es_V(n-1,:)-p.L2Es_DS00iDR_anV0)>=p.L2Es_DS00iDR_eps).*L2Es_V(n-1,:)-p.L2Es_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(L2Es_V(n-1,:)-p.L2Es_DS00iDR_bnV0)<p.L2Es_DS00iDR_eps).*p.L2Es_DS00iDR_eps+(abs(L2Es_V(n-1,:)-p.L2Es_DS00iDR_bnV0)>=p.L2Es_DS00iDR_eps).*L2Es_V(n-1,:)-p.L2Es_DS00iDR_bnV0)))./(-1+exp((( ((abs(L2Es_V(n-1,:)-p.L2Es_DS00iDR_bnV0)<p.L2Es_DS00iDR_eps).*p.L2Es_DS00iDR_eps+(abs(L2Es_V(n-1,:)-p.L2Es_DS00iDR_bnV0)>=p.L2Es_DS00iDR_eps).*L2Es_V(n-1,:)-p.L2Es_DS00iDR_bnV0)))/12)))))))-L2Es_DS00iDR_n(n-1,:))./((1./(((-.018*(( ((abs(L2Es_V(n-1,:)-p.L2Es_DS00iDR_anV0)<p.L2Es_DS00iDR_eps).*p.L2Es_DS00iDR_eps+(abs(L2Es_V(n-1,:)-p.L2Es_DS00iDR_anV0)>=p.L2Es_DS00iDR_eps).*L2Es_V(n-1,:)-p.L2Es_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L2Es_V(n-1,:)-p.L2Es_DS00iDR_anV0)<p.L2Es_DS00iDR_eps).*p.L2Es_DS00iDR_eps+(abs(L2Es_V(n-1,:)-p.L2Es_DS00iDR_anV0)>=p.L2Es_DS00iDR_eps).*L2Es_V(n-1,:)-p.L2Es_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(L2Es_V(n-1,:)-p.L2Es_DS00iDR_bnV0)<p.L2Es_DS00iDR_eps).*p.L2Es_DS00iDR_eps+(abs(L2Es_V(n-1,:)-p.L2Es_DS00iDR_bnV0)>=p.L2Es_DS00iDR_eps).*L2Es_V(n-1,:)-p.L2Es_DS00iDR_bnV0)))./(-1+exp((( ((abs(L2Es_V(n-1,:)-p.L2Es_DS00iDR_bnV0)<p.L2Es_DS00iDR_eps).*p.L2Es_DS00iDR_eps+(abs(L2Es_V(n-1,:)-p.L2Es_DS00iDR_bnV0)>=p.L2Es_DS00iDR_eps).*L2Es_V(n-1,:)-p.L2Es_DS00iDR_bnV0)))/12)))))));
  L2Es_DS02iKS_a_k1=(((1./(1+exp(-(L2Es_V(n-1,:)+34)/6.5))))-L2Es_DS02iKS_a(n-1,:))./((6));
  L2Es_DS02iKS_b_k1=(((1./(1+exp((L2Es_V(n-1,:)+65)/6.6))))-L2Es_DS02iKS_b(n-1,:))./((200+220./(1+exp(-(L2Es_V(n-1,:)+71.6)/6.85))));
  L2Es_DS02iHVA_u_k1=(((1./(1+exp(-(L2Es_V(n-1,:)+24.6)/11.3))))-L2Es_DS02iHVA_u(n-1,:))./((1.25*sech(-.031*(L2Es_V(n-1,:)+37.1))));
  L2Es_DS02iHVA_w_k1=(((1./(1+exp((L2Es_V(n-1,:)+12.6)/18.9))))-L2Es_DS02iHVA_w(n-1,:))./((L2Es_DS02iHVA_wtauHVA));
  L2Es_DS00iKCa_c_k1=((((((-0.00642*(( ((abs(((L2Es_V(n-1,:)+40*log10(L2Es_DS00CaDyn_cai(n-1,:))))+18)<p.L2Es_DS00iKCa_eps).*p.L2Es_DS00iKCa_eps+(abs(((L2Es_V(n-1,:)+40*log10(L2Es_DS00CaDyn_cai(n-1,:))))+18)>=p.L2Es_DS00iKCa_eps).*((L2Es_V(n-1,:)+40*log10(L2Es_DS00CaDyn_cai(n-1,:))))+18))))./(-1+exp((( ((abs(((L2Es_V(n-1,:)+40*log10(L2Es_DS00CaDyn_cai(n-1,:))))+18)<p.L2Es_DS00iKCa_eps).*p.L2Es_DS00iKCa_eps+(abs(((L2Es_V(n-1,:)+40*log10(L2Es_DS00CaDyn_cai(n-1,:))))+18)>=p.L2Es_DS00iKCa_eps).*((L2Es_V(n-1,:)+40*log10(L2Es_DS00CaDyn_cai(n-1,:))))+18)))./(-12)))))./((((-0.00642*(( ((abs(((L2Es_V(n-1,:)+40*log10(L2Es_DS00CaDyn_cai(n-1,:))))+18)<p.L2Es_DS00iKCa_eps).*p.L2Es_DS00iKCa_eps+(abs(((L2Es_V(n-1,:)+40*log10(L2Es_DS00CaDyn_cai(n-1,:))))+18)>=p.L2Es_DS00iKCa_eps).*((L2Es_V(n-1,:)+40*log10(L2Es_DS00CaDyn_cai(n-1,:))))+18))))./(-1+exp((( ((abs(((L2Es_V(n-1,:)+40*log10(L2Es_DS00CaDyn_cai(n-1,:))))+18)<p.L2Es_DS00iKCa_eps).*p.L2Es_DS00iKCa_eps+(abs(((L2Es_V(n-1,:)+40*log10(L2Es_DS00CaDyn_cai(n-1,:))))+18)>=p.L2Es_DS00iKCa_eps).*((L2Es_V(n-1,:)+40*log10(L2Es_DS00CaDyn_cai(n-1,:))))+18)))./(-12)))))+((1.7*exp((((L2Es_V(n-1,:)+40*log10(L2Es_DS00CaDyn_cai(n-1,:))))+152)./(-30.0)))))))-L2Es_DS00iKCa_c(n-1,:))./((1./((((-0.00642*(( ((abs(((L2Es_V(n-1,:)+40*log10(L2Es_DS00CaDyn_cai(n-1,:))))+18)<p.L2Es_DS00iKCa_eps).*p.L2Es_DS00iKCa_eps+(abs(((L2Es_V(n-1,:)+40*log10(L2Es_DS00CaDyn_cai(n-1,:))))+18)>=p.L2Es_DS00iKCa_eps).*((L2Es_V(n-1,:)+40*log10(L2Es_DS00CaDyn_cai(n-1,:))))+18))))./(-1+exp((( ((abs(((L2Es_V(n-1,:)+40*log10(L2Es_DS00CaDyn_cai(n-1,:))))+18)<p.L2Es_DS00iKCa_eps).*p.L2Es_DS00iKCa_eps+(abs(((L2Es_V(n-1,:)+40*log10(L2Es_DS00CaDyn_cai(n-1,:))))+18)>=p.L2Es_DS00iKCa_eps).*((L2Es_V(n-1,:)+40*log10(L2Es_DS00CaDyn_cai(n-1,:))))+18)))./(-12)))))+((1.7*exp((((L2Es_V(n-1,:)+40*log10(L2Es_DS00CaDyn_cai(n-1,:))))+152)./(-30.0)))))));
  L2Es_DS00CaDyn_cai_k1= -p.L2Es_DS00CaDyn_CAF.*((((p.L2Es_DS02iHVA_ghva.*L2Es_DS02iHVA_u(n-1,:).^2.*L2Es_DS02iHVA_w(n-1,:).*(L2Es_V(n-1,:)-((min(500,12.5*log(p.L2Es_DS02iHVA_cao./L2Es_DS00CaDyn_cai(n-1,:))))))))))./(p.L2Es_DS00CaDyn_faraday*p.L2Es_DS00CaDyn_VshellCa)+(p.L2Es_DS00CaDyn_cainf-L2Es_DS00CaDyn_cai(n-1,:))./p.L2Es_DS00CaDyn_tauCa;
  L2Es_DS00KDyn_ko_k1= p.L2Es_DS00KDyn_KAF.*((((p.L2Es_DS00iDR_gkdr.*L2Es_DS00iDR_n(n-1,:).^4.*(L2Es_V(n-1,:)-((25*log(L2Es_DS00KDyn_ko(n-1,:)/p.L2Es_DS00iDR_ki)))))))+(((( p.L2Es_DS02iKS_gks.*L2Es_DS02iKS_a(n-1,:).*L2Es_DS02iKS_b(n-1,:).*(L2Es_V(n-1,:)-((25*log(L2Es_DS00KDyn_ko(n-1,:)/p.L2Es_DS02iKS_ki)))))))+((((p.L2Es_DS00iKCa_gkc.*L2Es_DS00iKCa_c(n-1,:).^2.*(L2Es_V(n-1,:)-((25*log(L2Es_DS00KDyn_ko(n-1,:)/p.L2Es_DS00iKCa_ki))))))))))./(p.L2Es_DS00KDyn_faraday*p.L2Es_DS00KDyn_VshellK)+(p.L2Es_DS00KDyn_koinf-L2Es_DS00KDyn_ko(n-1,:))./p.L2Es_DS00KDyn_tauK;
  L2Es_TW03iH_m_k1= (( p.L2Es_TW03iH_c_ARaM.*((( 1 ./ (1+exp((p.L2Es_TW03iH_AR_V12-L2Es_V(n-1,:))/p.L2Es_TW03iH_AR_k)))) ./ (( 1./(p.L2Es_TW03iH_AR_L.*exp(-14.6-.086*L2Es_V(n-1,:))+p.L2Es_TW03iH_AR_R.*exp(-1.87+.07*L2Es_V(n-1,:)))))))).*(1-L2Es_TW03iH_m(n-1,:))-(( p.L2Es_TW03iH_c_ARbM.*((1-(( 1 ./ (1+exp((p.L2Es_TW03iH_AR_V12-L2Es_V(n-1,:))/p.L2Es_TW03iH_AR_k)))))./(( 1./(p.L2Es_TW03iH_AR_L.*exp(-14.6-.086*L2Es_V(n-1,:))+p.L2Es_TW03iH_AR_R.*exp(-1.87+.07*L2Es_V(n-1,:)))))))).*L2Es_TW03iH_m(n-1,:);
  L2Ed_V_k1=(((-((p.L2Ed_DS00iNa_gnaf.*L2Ed_DS00iNa_m(n-1,:).^3.*L2Ed_DS00iNa_h(n-1,:).*(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_ENa))))+((-((p.L2Ed_DS00iNaP_gnap.*L2Ed_DS00iNaP_m(n-1,:).*L2Ed_DS00iNaP_h(n-1,:).*(L2Ed_V(n-1,:)-p.L2Ed_DS00iNaP_ENa))))+((-((p.L2Ed_DS00iDR_gkdr.*L2Ed_DS00iDR_n(n-1,:).^4.*(L2Ed_V(n-1,:)-((25*log(L2Ed_DS00KDyn_ko(n-1,:)/p.L2Ed_DS00iDR_ki)))))))+((-(( p.L2Ed_DS02iKS_gks.*L2Ed_DS02iKS_a(n-1,:).*L2Ed_DS02iKS_b(n-1,:).*(L2Ed_V(n-1,:)-((25*log(L2Ed_DS00KDyn_ko(n-1,:)/p.L2Ed_DS02iKS_ki)))))))+((-((p.L2Ed_DS02iHVA_ghva.*L2Ed_DS02iHVA_u(n-1,:).^2.*L2Ed_DS02iHVA_w(n-1,:).*(L2Ed_V(n-1,:)-((min(500,12.5*log(p.L2Ed_DS02iHVA_cao./L2Ed_DS00CaDyn_cai(n-1,:)))))))))+((-((p.L2Ed_DS00iKCa_gkc.*L2Ed_DS00iKCa_c(n-1,:).^2.*(L2Ed_V(n-1,:)-((25*log(L2Ed_DS00KDyn_ko(n-1,:)/p.L2Ed_DS00iKCa_ki)))))))+((-(( p.L2Ed_TW03iH_gH.*L2Ed_TW03iH_m(n-1,:).*(L2Ed_V(n-1,:)-p.L2Ed_TW03iH_E_AR))))+((-((p.L2Ed_pas_gpas.*(L2Ed_V(n-1,:)-p.L2Ed_pas_epas))))+((-(( (p.L2Ed_L2Es_iAMPA_gAMPA.*(L2Ed_L2Es_iAMPA_s(n-1,:)*L2Ed_L2Es_iAMPA_netcon).*(L2Ed_V(n-1,:)-p.L2Ed_L2Es_iAMPA_EAMPA)))))+((-(( p.L2Ed_L2Es_iNMDA_gNMDA.*(( (1.50265./(1+0.33*exp(L2Ed_V(n-1,:)./(-16)))))).*(L2Ed_L2Es_iNMDA_s(n-1,:)*L2Ed_L2Es_iNMDA_netcon).*(L2Ed_V(n-1,:)-p.L2Ed_L2Es_iNMDA_ENMDA))))+(((( p.L2Ed_L2Es_iCOM_gCOM.*(L2Es_V(n-1,:)-L2Ed_V(n-1,:)))))+((-(( (p.L2Ed_L1Es_iAMPA_gAMPA.*(L2Ed_L1Es_iAMPA_s(n-1,:)*L2Ed_L1Es_iAMPA_netcon).*(L2Ed_V(n-1,:)-p.L2Ed_L1Es_iAMPA_EAMPA)))))))))))))))))+p.L2Ed_Iapp)./p.L2Ed_Cm;
  L2Ed_DS00iNa_m_k1=((((((-.2816*(( ((abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_amV0)<p.L2Ed_DS00iNa_eps).*p.L2Ed_DS00iNa_eps+(abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_amV0)>=p.L2Ed_DS00iNa_eps).*L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_amV0)<p.L2Ed_DS00iNa_eps).*p.L2Ed_DS00iNa_eps+(abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_amV0)>=p.L2Ed_DS00iNa_eps).*L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_amV0)))/9.3))))./((((-.2816*(( ((abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_amV0)<p.L2Ed_DS00iNa_eps).*p.L2Ed_DS00iNa_eps+(abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_amV0)>=p.L2Ed_DS00iNa_eps).*L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_amV0)<p.L2Ed_DS00iNa_eps).*p.L2Ed_DS00iNa_eps+(abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_amV0)>=p.L2Ed_DS00iNa_eps).*L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_bmV0)<p.L2Ed_DS00iNa_eps).*p.L2Ed_DS00iNa_eps+(abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_bmV0)>=p.L2Ed_DS00iNa_eps).*L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_bmV0))))./(-1+exp((( ((abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_bmV0)<p.L2Ed_DS00iNa_eps).*p.L2Ed_DS00iNa_eps+(abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_bmV0)>=p.L2Ed_DS00iNa_eps).*L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_bmV0)))/6)))))))-L2Ed_DS00iNa_m(n-1,:))./((1./((((-.2816*(( ((abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_amV0)<p.L2Ed_DS00iNa_eps).*p.L2Ed_DS00iNa_eps+(abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_amV0)>=p.L2Ed_DS00iNa_eps).*L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_amV0)<p.L2Ed_DS00iNa_eps).*p.L2Ed_DS00iNa_eps+(abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_amV0)>=p.L2Ed_DS00iNa_eps).*L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_bmV0)<p.L2Ed_DS00iNa_eps).*p.L2Ed_DS00iNa_eps+(abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_bmV0)>=p.L2Ed_DS00iNa_eps).*L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_bmV0))))./(-1+exp((( ((abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_bmV0)<p.L2Ed_DS00iNa_eps).*p.L2Ed_DS00iNa_eps+(abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_bmV0)>=p.L2Ed_DS00iNa_eps).*L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_bmV0)))/6)))))));
  L2Ed_DS00iNa_h_k1=(((((p.L2Ed_DS00iNa_hnascale.*.098./exp((L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_ahV0)/20)))./(((p.L2Ed_DS00iNa_hnascale.*.098./exp((L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_ahV0)/20)))+((p.L2Ed_DS00iNa_hnascale.*1.4./(1+exp(-(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_bhV0)/10)))))))-L2Ed_DS00iNa_h(n-1,:))./((1./(((p.L2Ed_DS00iNa_hnascale.*.098./exp((L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_ahV0)/20)))+((p.L2Ed_DS00iNa_hnascale.*1.4./(1+exp(-(L2Ed_V(n-1,:)-p.L2Ed_DS00iNa_bhV0)/10)))))));
  L2Ed_DS00iNaP_m_k1=((((((-.2816*(( ((abs(L2Ed_V(n-1,:)+12)<p.L2Ed_DS00iNaP_eps).*p.L2Ed_DS00iNaP_eps+(abs(L2Ed_V(n-1,:)+12)>=p.L2Ed_DS00iNaP_eps).*L2Ed_V(n-1,:)+12))))./(-1+exp(-(( ((abs(L2Ed_V(n-1,:)+12)<p.L2Ed_DS00iNaP_eps).*p.L2Ed_DS00iNaP_eps+(abs(L2Ed_V(n-1,:)+12)>=p.L2Ed_DS00iNaP_eps).*L2Ed_V(n-1,:)+12)))/9.3))))./((((-.2816*(( ((abs(L2Ed_V(n-1,:)+12)<p.L2Ed_DS00iNaP_eps).*p.L2Ed_DS00iNaP_eps+(abs(L2Ed_V(n-1,:)+12)>=p.L2Ed_DS00iNaP_eps).*L2Ed_V(n-1,:)+12))))./(-1+exp(-(( ((abs(L2Ed_V(n-1,:)+12)<p.L2Ed_DS00iNaP_eps).*p.L2Ed_DS00iNaP_eps+(abs(L2Ed_V(n-1,:)+12)>=p.L2Ed_DS00iNaP_eps).*L2Ed_V(n-1,:)+12)))/9.3))))+(((.2464*(( ((abs(L2Ed_V(n-1,:)-15)<p.L2Ed_DS00iNaP_eps).*p.L2Ed_DS00iNaP_eps+(abs(L2Ed_V(n-1,:)-15)>=p.L2Ed_DS00iNaP_eps).*L2Ed_V(n-1,:)-15))))./(-1+exp((( ((abs(L2Ed_V(n-1,:)-15)<p.L2Ed_DS00iNaP_eps).*p.L2Ed_DS00iNaP_eps+(abs(L2Ed_V(n-1,:)-15)>=p.L2Ed_DS00iNaP_eps).*L2Ed_V(n-1,:)-15)))/6)))))))-L2Ed_DS00iNaP_m(n-1,:))./((1./((((-.2816*(( ((abs(L2Ed_V(n-1,:)+12)<p.L2Ed_DS00iNaP_eps).*p.L2Ed_DS00iNaP_eps+(abs(L2Ed_V(n-1,:)+12)>=p.L2Ed_DS00iNaP_eps).*L2Ed_V(n-1,:)+12))))./(-1+exp(-(( ((abs(L2Ed_V(n-1,:)+12)<p.L2Ed_DS00iNaP_eps).*p.L2Ed_DS00iNaP_eps+(abs(L2Ed_V(n-1,:)+12)>=p.L2Ed_DS00iNaP_eps).*L2Ed_V(n-1,:)+12)))/9.3))))+(((.2464*(( ((abs(L2Ed_V(n-1,:)-15)<p.L2Ed_DS00iNaP_eps).*p.L2Ed_DS00iNaP_eps+(abs(L2Ed_V(n-1,:)-15)>=p.L2Ed_DS00iNaP_eps).*L2Ed_V(n-1,:)-15))))./(-1+exp((( ((abs(L2Ed_V(n-1,:)-15)<p.L2Ed_DS00iNaP_eps).*p.L2Ed_DS00iNaP_eps+(abs(L2Ed_V(n-1,:)-15)>=p.L2Ed_DS00iNaP_eps).*L2Ed_V(n-1,:)-15)))/6)))))));
  L2Ed_DS00iNaP_h_k1=(((((2.8e-5./exp((L2Ed_V(n-1,:)+42.8477)/4.0248)))./(((2.8e-5./exp((L2Ed_V(n-1,:)+42.8477)/4.0248)))+((.02./(1+exp(-(L2Ed_V(n-1,:)-413.9284)/148.2589)))))))-L2Ed_DS00iNaP_h(n-1,:))./((p.L2Ed_DS00iNaP_htaunap*1./(((2.8e-5./exp((L2Ed_V(n-1,:)+42.8477)/4.0248)))+((.02./(1+exp(-(L2Ed_V(n-1,:)-413.9284)/148.2589)))))));
  L2Ed_DS00iDR_n_k1=(((((-.018*(( ((abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_anV0)<p.L2Ed_DS00iDR_eps).*p.L2Ed_DS00iDR_eps+(abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_anV0)>=p.L2Ed_DS00iDR_eps).*L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_anV0)<p.L2Ed_DS00iDR_eps).*p.L2Ed_DS00iDR_eps+(abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_anV0)>=p.L2Ed_DS00iDR_eps).*L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_anV0)))/25))))./(((-.018*(( ((abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_anV0)<p.L2Ed_DS00iDR_eps).*p.L2Ed_DS00iDR_eps+(abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_anV0)>=p.L2Ed_DS00iDR_eps).*L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_anV0)<p.L2Ed_DS00iDR_eps).*p.L2Ed_DS00iDR_eps+(abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_anV0)>=p.L2Ed_DS00iDR_eps).*L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_bnV0)<p.L2Ed_DS00iDR_eps).*p.L2Ed_DS00iDR_eps+(abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_bnV0)>=p.L2Ed_DS00iDR_eps).*L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_bnV0)))./(-1+exp((( ((abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_bnV0)<p.L2Ed_DS00iDR_eps).*p.L2Ed_DS00iDR_eps+(abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_bnV0)>=p.L2Ed_DS00iDR_eps).*L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_bnV0)))/12)))))))-L2Ed_DS00iDR_n(n-1,:))./((1./(((-.018*(( ((abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_anV0)<p.L2Ed_DS00iDR_eps).*p.L2Ed_DS00iDR_eps+(abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_anV0)>=p.L2Ed_DS00iDR_eps).*L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_anV0)<p.L2Ed_DS00iDR_eps).*p.L2Ed_DS00iDR_eps+(abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_anV0)>=p.L2Ed_DS00iDR_eps).*L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_bnV0)<p.L2Ed_DS00iDR_eps).*p.L2Ed_DS00iDR_eps+(abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_bnV0)>=p.L2Ed_DS00iDR_eps).*L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_bnV0)))./(-1+exp((( ((abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_bnV0)<p.L2Ed_DS00iDR_eps).*p.L2Ed_DS00iDR_eps+(abs(L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_bnV0)>=p.L2Ed_DS00iDR_eps).*L2Ed_V(n-1,:)-p.L2Ed_DS00iDR_bnV0)))/12)))))));
  L2Ed_DS02iKS_a_k1=(((1./(1+exp(-(L2Ed_V(n-1,:)+34)/6.5))))-L2Ed_DS02iKS_a(n-1,:))./((6));
  L2Ed_DS02iKS_b_k1=(((1./(1+exp((L2Ed_V(n-1,:)+65)/6.6))))-L2Ed_DS02iKS_b(n-1,:))./((200+220./(1+exp(-(L2Ed_V(n-1,:)+71.6)/6.85))));
  L2Ed_DS02iHVA_u_k1=(((1./(1+exp(-(L2Ed_V(n-1,:)+24.6)/11.3))))-L2Ed_DS02iHVA_u(n-1,:))./((1.25*sech(-.031*(L2Ed_V(n-1,:)+37.1))));
  L2Ed_DS02iHVA_w_k1=(((1./(1+exp((L2Ed_V(n-1,:)+12.6)/18.9))))-L2Ed_DS02iHVA_w(n-1,:))./((L2Ed_DS02iHVA_wtauHVA));
  L2Ed_DS00iKCa_c_k1=((((((-0.00642*(( ((abs(((L2Ed_V(n-1,:)+40*log10(L2Ed_DS00CaDyn_cai(n-1,:))))+18)<p.L2Ed_DS00iKCa_eps).*p.L2Ed_DS00iKCa_eps+(abs(((L2Ed_V(n-1,:)+40*log10(L2Ed_DS00CaDyn_cai(n-1,:))))+18)>=p.L2Ed_DS00iKCa_eps).*((L2Ed_V(n-1,:)+40*log10(L2Ed_DS00CaDyn_cai(n-1,:))))+18))))./(-1+exp((( ((abs(((L2Ed_V(n-1,:)+40*log10(L2Ed_DS00CaDyn_cai(n-1,:))))+18)<p.L2Ed_DS00iKCa_eps).*p.L2Ed_DS00iKCa_eps+(abs(((L2Ed_V(n-1,:)+40*log10(L2Ed_DS00CaDyn_cai(n-1,:))))+18)>=p.L2Ed_DS00iKCa_eps).*((L2Ed_V(n-1,:)+40*log10(L2Ed_DS00CaDyn_cai(n-1,:))))+18)))./(-12)))))./((((-0.00642*(( ((abs(((L2Ed_V(n-1,:)+40*log10(L2Ed_DS00CaDyn_cai(n-1,:))))+18)<p.L2Ed_DS00iKCa_eps).*p.L2Ed_DS00iKCa_eps+(abs(((L2Ed_V(n-1,:)+40*log10(L2Ed_DS00CaDyn_cai(n-1,:))))+18)>=p.L2Ed_DS00iKCa_eps).*((L2Ed_V(n-1,:)+40*log10(L2Ed_DS00CaDyn_cai(n-1,:))))+18))))./(-1+exp((( ((abs(((L2Ed_V(n-1,:)+40*log10(L2Ed_DS00CaDyn_cai(n-1,:))))+18)<p.L2Ed_DS00iKCa_eps).*p.L2Ed_DS00iKCa_eps+(abs(((L2Ed_V(n-1,:)+40*log10(L2Ed_DS00CaDyn_cai(n-1,:))))+18)>=p.L2Ed_DS00iKCa_eps).*((L2Ed_V(n-1,:)+40*log10(L2Ed_DS00CaDyn_cai(n-1,:))))+18)))./(-12)))))+((1.7*exp((((L2Ed_V(n-1,:)+40*log10(L2Ed_DS00CaDyn_cai(n-1,:))))+152)./(-30.0)))))))-L2Ed_DS00iKCa_c(n-1,:))./((1./((((-0.00642*(( ((abs(((L2Ed_V(n-1,:)+40*log10(L2Ed_DS00CaDyn_cai(n-1,:))))+18)<p.L2Ed_DS00iKCa_eps).*p.L2Ed_DS00iKCa_eps+(abs(((L2Ed_V(n-1,:)+40*log10(L2Ed_DS00CaDyn_cai(n-1,:))))+18)>=p.L2Ed_DS00iKCa_eps).*((L2Ed_V(n-1,:)+40*log10(L2Ed_DS00CaDyn_cai(n-1,:))))+18))))./(-1+exp((( ((abs(((L2Ed_V(n-1,:)+40*log10(L2Ed_DS00CaDyn_cai(n-1,:))))+18)<p.L2Ed_DS00iKCa_eps).*p.L2Ed_DS00iKCa_eps+(abs(((L2Ed_V(n-1,:)+40*log10(L2Ed_DS00CaDyn_cai(n-1,:))))+18)>=p.L2Ed_DS00iKCa_eps).*((L2Ed_V(n-1,:)+40*log10(L2Ed_DS00CaDyn_cai(n-1,:))))+18)))./(-12)))))+((1.7*exp((((L2Ed_V(n-1,:)+40*log10(L2Ed_DS00CaDyn_cai(n-1,:))))+152)./(-30.0)))))));
  L2Ed_DS00CaDyn_cai_k1= -p.L2Ed_DS00CaDyn_CAF.*((((p.L2Ed_DS02iHVA_ghva.*L2Ed_DS02iHVA_u(n-1,:).^2.*L2Ed_DS02iHVA_w(n-1,:).*(L2Ed_V(n-1,:)-((min(500,12.5*log(p.L2Ed_DS02iHVA_cao./L2Ed_DS00CaDyn_cai(n-1,:))))))))))./(p.L2Ed_DS00CaDyn_faraday*p.L2Ed_DS00CaDyn_VshellCa)+(p.L2Ed_DS00CaDyn_cainf-L2Ed_DS00CaDyn_cai(n-1,:))./p.L2Ed_DS00CaDyn_tauCa;
  L2Ed_DS00KDyn_ko_k1= p.L2Ed_DS00KDyn_KAF.*((((p.L2Ed_DS00iDR_gkdr.*L2Ed_DS00iDR_n(n-1,:).^4.*(L2Ed_V(n-1,:)-((25*log(L2Ed_DS00KDyn_ko(n-1,:)/p.L2Ed_DS00iDR_ki)))))))+(((( p.L2Ed_DS02iKS_gks.*L2Ed_DS02iKS_a(n-1,:).*L2Ed_DS02iKS_b(n-1,:).*(L2Ed_V(n-1,:)-((25*log(L2Ed_DS00KDyn_ko(n-1,:)/p.L2Ed_DS02iKS_ki)))))))+((((p.L2Ed_DS00iKCa_gkc.*L2Ed_DS00iKCa_c(n-1,:).^2.*(L2Ed_V(n-1,:)-((25*log(L2Ed_DS00KDyn_ko(n-1,:)/p.L2Ed_DS00iKCa_ki))))))))))./(p.L2Ed_DS00KDyn_faraday*p.L2Ed_DS00KDyn_VshellK)+(p.L2Ed_DS00KDyn_koinf-L2Ed_DS00KDyn_ko(n-1,:))./p.L2Ed_DS00KDyn_tauK;
  L2Ed_TW03iH_m_k1= (( p.L2Ed_TW03iH_c_ARaM.*((( 1 ./ (1+exp((p.L2Ed_TW03iH_AR_V12-L2Ed_V(n-1,:))/p.L2Ed_TW03iH_AR_k)))) ./ (( 1./(p.L2Ed_TW03iH_AR_L.*exp(-14.6-.086*L2Ed_V(n-1,:))+p.L2Ed_TW03iH_AR_R.*exp(-1.87+.07*L2Ed_V(n-1,:)))))))).*(1-L2Ed_TW03iH_m(n-1,:))-(( p.L2Ed_TW03iH_c_ARbM.*((1-(( 1 ./ (1+exp((p.L2Ed_TW03iH_AR_V12-L2Ed_V(n-1,:))/p.L2Ed_TW03iH_AR_k)))))./(( 1./(p.L2Ed_TW03iH_AR_L.*exp(-14.6-.086*L2Ed_V(n-1,:))+p.L2Ed_TW03iH_AR_R.*exp(-1.87+.07*L2Ed_V(n-1,:)))))))).*L2Ed_TW03iH_m(n-1,:);
  L2FS_V_k1=(((-((p.L2FS_DS00iNa_gnaf.*L2FS_DS00iNa_m(n-1,:).^3.*L2FS_DS00iNa_h(n-1,:).*(L2FS_V(n-1,:)-p.L2FS_DS00iNa_ENa))))+((-((p.L2FS_DS00iDR_gkdr.*L2FS_DS00iDR_n(n-1,:).^4.*(L2FS_V(n-1,:)-((25*log(L2FS_DS00KDyn_ko(n-1,:)/p.L2FS_DS00iDR_ki)))))))+((-(( p.L2FS_TW03iH_gH.*L2FS_TW03iH_m(n-1,:).*(L2FS_V(n-1,:)-p.L2FS_TW03iH_E_AR))))+((-((p.L2FS_pas_gpas.*(L2FS_V(n-1,:)-p.L2FS_pas_epas))))+((-(( (p.L2FS_L2Es_iAMPA_gAMPA.*(L2FS_L2Es_iAMPA_s(n-1,:)*L2FS_L2Es_iAMPA_netcon).*(L2FS_V(n-1,:)-p.L2FS_L2Es_iAMPA_EAMPA)))))+((-(( p.L2FS_L2Es_iNMDA_gNMDA.*(( (1.50265./(1+0.33*exp(L2FS_V(n-1,:)./(-16)))))).*(L2FS_L2Es_iNMDA_s(n-1,:)*L2FS_L2Es_iNMDA_netcon).*(L2FS_V(n-1,:)-p.L2FS_L2Es_iNMDA_ENMDA))))+((-(( (p.L2FS_L2FS_iGABA_gGABA.*(L2FS_L2FS_iGABA_s(n-1,:)*L2FS_L2FS_iGABA_netcon).*(L2FS_V(n-1,:)-p.L2FS_L2FS_iGABA_EGABA))))))))))))+p.L2FS_Iapp)./p.L2FS_Cm;
  L2FS_DS00iNa_m_k1=((((((-.2816*(( ((abs(L2FS_V(n-1,:)-p.L2FS_DS00iNa_amV0)<p.L2FS_DS00iNa_eps).*p.L2FS_DS00iNa_eps+(abs(L2FS_V(n-1,:)-p.L2FS_DS00iNa_amV0)>=p.L2FS_DS00iNa_eps).*L2FS_V(n-1,:)-p.L2FS_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L2FS_V(n-1,:)-p.L2FS_DS00iNa_amV0)<p.L2FS_DS00iNa_eps).*p.L2FS_DS00iNa_eps+(abs(L2FS_V(n-1,:)-p.L2FS_DS00iNa_amV0)>=p.L2FS_DS00iNa_eps).*L2FS_V(n-1,:)-p.L2FS_DS00iNa_amV0)))/9.3))))./((((-.2816*(( ((abs(L2FS_V(n-1,:)-p.L2FS_DS00iNa_amV0)<p.L2FS_DS00iNa_eps).*p.L2FS_DS00iNa_eps+(abs(L2FS_V(n-1,:)-p.L2FS_DS00iNa_amV0)>=p.L2FS_DS00iNa_eps).*L2FS_V(n-1,:)-p.L2FS_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L2FS_V(n-1,:)-p.L2FS_DS00iNa_amV0)<p.L2FS_DS00iNa_eps).*p.L2FS_DS00iNa_eps+(abs(L2FS_V(n-1,:)-p.L2FS_DS00iNa_amV0)>=p.L2FS_DS00iNa_eps).*L2FS_V(n-1,:)-p.L2FS_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(L2FS_V(n-1,:)-p.L2FS_DS00iNa_bmV0)<p.L2FS_DS00iNa_eps).*p.L2FS_DS00iNa_eps+(abs(L2FS_V(n-1,:)-p.L2FS_DS00iNa_bmV0)>=p.L2FS_DS00iNa_eps).*L2FS_V(n-1,:)-p.L2FS_DS00iNa_bmV0))))./(-1+exp((( ((abs(L2FS_V(n-1,:)-p.L2FS_DS00iNa_bmV0)<p.L2FS_DS00iNa_eps).*p.L2FS_DS00iNa_eps+(abs(L2FS_V(n-1,:)-p.L2FS_DS00iNa_bmV0)>=p.L2FS_DS00iNa_eps).*L2FS_V(n-1,:)-p.L2FS_DS00iNa_bmV0)))/6)))))))-L2FS_DS00iNa_m(n-1,:))./((1./((((-.2816*(( ((abs(L2FS_V(n-1,:)-p.L2FS_DS00iNa_amV0)<p.L2FS_DS00iNa_eps).*p.L2FS_DS00iNa_eps+(abs(L2FS_V(n-1,:)-p.L2FS_DS00iNa_amV0)>=p.L2FS_DS00iNa_eps).*L2FS_V(n-1,:)-p.L2FS_DS00iNa_amV0))))./(-1+exp(-(( ((abs(L2FS_V(n-1,:)-p.L2FS_DS00iNa_amV0)<p.L2FS_DS00iNa_eps).*p.L2FS_DS00iNa_eps+(abs(L2FS_V(n-1,:)-p.L2FS_DS00iNa_amV0)>=p.L2FS_DS00iNa_eps).*L2FS_V(n-1,:)-p.L2FS_DS00iNa_amV0)))/9.3))))+(((.2464*(( ((abs(L2FS_V(n-1,:)-p.L2FS_DS00iNa_bmV0)<p.L2FS_DS00iNa_eps).*p.L2FS_DS00iNa_eps+(abs(L2FS_V(n-1,:)-p.L2FS_DS00iNa_bmV0)>=p.L2FS_DS00iNa_eps).*L2FS_V(n-1,:)-p.L2FS_DS00iNa_bmV0))))./(-1+exp((( ((abs(L2FS_V(n-1,:)-p.L2FS_DS00iNa_bmV0)<p.L2FS_DS00iNa_eps).*p.L2FS_DS00iNa_eps+(abs(L2FS_V(n-1,:)-p.L2FS_DS00iNa_bmV0)>=p.L2FS_DS00iNa_eps).*L2FS_V(n-1,:)-p.L2FS_DS00iNa_bmV0)))/6)))))));
  L2FS_DS00iNa_h_k1=(((((p.L2FS_DS00iNa_hnascale.*.098./exp((L2FS_V(n-1,:)-p.L2FS_DS00iNa_ahV0)/20)))./(((p.L2FS_DS00iNa_hnascale.*.098./exp((L2FS_V(n-1,:)-p.L2FS_DS00iNa_ahV0)/20)))+((p.L2FS_DS00iNa_hnascale.*1.4./(1+exp(-(L2FS_V(n-1,:)-p.L2FS_DS00iNa_bhV0)/10)))))))-L2FS_DS00iNa_h(n-1,:))./((1./(((p.L2FS_DS00iNa_hnascale.*.098./exp((L2FS_V(n-1,:)-p.L2FS_DS00iNa_ahV0)/20)))+((p.L2FS_DS00iNa_hnascale.*1.4./(1+exp(-(L2FS_V(n-1,:)-p.L2FS_DS00iNa_bhV0)/10)))))));
  L2FS_DS00iDR_n_k1=(((((-.018*(( ((abs(L2FS_V(n-1,:)-p.L2FS_DS00iDR_anV0)<p.L2FS_DS00iDR_eps).*p.L2FS_DS00iDR_eps+(abs(L2FS_V(n-1,:)-p.L2FS_DS00iDR_anV0)>=p.L2FS_DS00iDR_eps).*L2FS_V(n-1,:)-p.L2FS_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L2FS_V(n-1,:)-p.L2FS_DS00iDR_anV0)<p.L2FS_DS00iDR_eps).*p.L2FS_DS00iDR_eps+(abs(L2FS_V(n-1,:)-p.L2FS_DS00iDR_anV0)>=p.L2FS_DS00iDR_eps).*L2FS_V(n-1,:)-p.L2FS_DS00iDR_anV0)))/25))))./(((-.018*(( ((abs(L2FS_V(n-1,:)-p.L2FS_DS00iDR_anV0)<p.L2FS_DS00iDR_eps).*p.L2FS_DS00iDR_eps+(abs(L2FS_V(n-1,:)-p.L2FS_DS00iDR_anV0)>=p.L2FS_DS00iDR_eps).*L2FS_V(n-1,:)-p.L2FS_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L2FS_V(n-1,:)-p.L2FS_DS00iDR_anV0)<p.L2FS_DS00iDR_eps).*p.L2FS_DS00iDR_eps+(abs(L2FS_V(n-1,:)-p.L2FS_DS00iDR_anV0)>=p.L2FS_DS00iDR_eps).*L2FS_V(n-1,:)-p.L2FS_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(L2FS_V(n-1,:)-p.L2FS_DS00iDR_bnV0)<p.L2FS_DS00iDR_eps).*p.L2FS_DS00iDR_eps+(abs(L2FS_V(n-1,:)-p.L2FS_DS00iDR_bnV0)>=p.L2FS_DS00iDR_eps).*L2FS_V(n-1,:)-p.L2FS_DS00iDR_bnV0)))./(-1+exp((( ((abs(L2FS_V(n-1,:)-p.L2FS_DS00iDR_bnV0)<p.L2FS_DS00iDR_eps).*p.L2FS_DS00iDR_eps+(abs(L2FS_V(n-1,:)-p.L2FS_DS00iDR_bnV0)>=p.L2FS_DS00iDR_eps).*L2FS_V(n-1,:)-p.L2FS_DS00iDR_bnV0)))/12)))))))-L2FS_DS00iDR_n(n-1,:))./((1./(((-.018*(( ((abs(L2FS_V(n-1,:)-p.L2FS_DS00iDR_anV0)<p.L2FS_DS00iDR_eps).*p.L2FS_DS00iDR_eps+(abs(L2FS_V(n-1,:)-p.L2FS_DS00iDR_anV0)>=p.L2FS_DS00iDR_eps).*L2FS_V(n-1,:)-p.L2FS_DS00iDR_anV0)))./(-1+exp(-(( ((abs(L2FS_V(n-1,:)-p.L2FS_DS00iDR_anV0)<p.L2FS_DS00iDR_eps).*p.L2FS_DS00iDR_eps+(abs(L2FS_V(n-1,:)-p.L2FS_DS00iDR_anV0)>=p.L2FS_DS00iDR_eps).*L2FS_V(n-1,:)-p.L2FS_DS00iDR_anV0)))/25))))+((.0054*(( ((abs(L2FS_V(n-1,:)-p.L2FS_DS00iDR_bnV0)<p.L2FS_DS00iDR_eps).*p.L2FS_DS00iDR_eps+(abs(L2FS_V(n-1,:)-p.L2FS_DS00iDR_bnV0)>=p.L2FS_DS00iDR_eps).*L2FS_V(n-1,:)-p.L2FS_DS00iDR_bnV0)))./(-1+exp((( ((abs(L2FS_V(n-1,:)-p.L2FS_DS00iDR_bnV0)<p.L2FS_DS00iDR_eps).*p.L2FS_DS00iDR_eps+(abs(L2FS_V(n-1,:)-p.L2FS_DS00iDR_bnV0)>=p.L2FS_DS00iDR_eps).*L2FS_V(n-1,:)-p.L2FS_DS00iDR_bnV0)))/12)))))));
  L2FS_DS00KDyn_ko_k1= p.L2FS_DS00KDyn_KAF.*((((p.L2FS_DS00iDR_gkdr.*L2FS_DS00iDR_n(n-1,:).^4.*(L2FS_V(n-1,:)-((25*log(L2FS_DS00KDyn_ko(n-1,:)/p.L2FS_DS00iDR_ki))))))))./(p.L2FS_DS00KDyn_faraday*p.L2FS_DS00KDyn_VshellK)+(p.L2FS_DS00KDyn_koinf-L2FS_DS00KDyn_ko(n-1,:))./p.L2FS_DS00KDyn_tauK;
  L2FS_TW03iH_m_k1= (( p.L2FS_TW03iH_c_ARaM.*((( 1 ./ (1+exp((p.L2FS_TW03iH_AR_V12-L2FS_V(n-1,:))/p.L2FS_TW03iH_AR_k)))) ./ (( 1./(p.L2FS_TW03iH_AR_L.*exp(-14.6-.086*L2FS_V(n-1,:))+p.L2FS_TW03iH_AR_R.*exp(-1.87+.07*L2FS_V(n-1,:)))))))).*(1-L2FS_TW03iH_m(n-1,:))-(( p.L2FS_TW03iH_c_ARbM.*((1-(( 1 ./ (1+exp((p.L2FS_TW03iH_AR_V12-L2FS_V(n-1,:))/p.L2FS_TW03iH_AR_k)))))./(( 1./(p.L2FS_TW03iH_AR_L.*exp(-14.6-.086*L2FS_V(n-1,:))+p.L2FS_TW03iH_AR_R.*exp(-1.87+.07*L2FS_V(n-1,:)))))))).*L2FS_TW03iH_m(n-1,:);
  L1Ed_L1Es_iAMPA_s_k1= -L1Ed_L1Es_iAMPA_s(n-1,:)./p.L1Ed_L1Es_iAMPA_tauAMPA + ((1-L1Ed_L1Es_iAMPA_s(n-1,:))/p.L1Ed_L1Es_iAMPA_tauAMPAr).*(1+tanh(L1Es_V(n-1,:)/10));
  L1Ed_L1Es_iNMDA_s_k1= (( p.L1Ed_L1Es_iNMDA_Tmax./(1+exp(-(L1Es_V(n-1,:)-p.L1Ed_L1Es_iNMDA_Vpp)/p.L1Ed_L1Es_iNMDA_Kp)))).*(1-L1Ed_L1Es_iNMDA_s(n-1,:))/p.L1Ed_L1Es_iNMDA_tauNMDAr-L1Ed_L1Es_iNMDA_s(n-1,:)/p.L1Ed_L1Es_iNMDA_tauNMDA;
  L1FS_L1Es_iAMPA_s_k1= -L1FS_L1Es_iAMPA_s(n-1,:)./p.L1FS_L1Es_iAMPA_tauAMPA + ((1-L1FS_L1Es_iAMPA_s(n-1,:))/p.L1FS_L1Es_iAMPA_tauAMPAr).*(1+tanh(L1Es_V(n-1,:)/10));
  L1FS_L1Es_iNMDA_s_k1= (( p.L1FS_L1Es_iNMDA_Tmax./(1+exp(-(L1Es_V(n-1,:)-p.L1FS_L1Es_iNMDA_Vpp)/p.L1FS_L1Es_iNMDA_Kp)))).*(1-L1FS_L1Es_iNMDA_s(n-1,:))/p.L1FS_L1Es_iNMDA_tauNMDAr-L1FS_L1Es_iNMDA_s(n-1,:)/p.L1FS_L1Es_iNMDA_tauNMDA;
  L1Es_L1FS_iGABA_s_k1= -L1Es_L1FS_iGABA_s(n-1)./p.L1Es_L1FS_iGABA_tauGABA + ((1-L1Es_L1FS_iGABA_s(n-1))/p.L1Es_L1FS_iGABA_tauGABAr).*(1+tanh(L1FS_V(n-1)/10));
  L1RSNP_L1Es_iAMPA_s_k1= -L1RSNP_L1Es_iAMPA_s(n-1,:)./p.L1RSNP_L1Es_iAMPA_tauAMPA + ((1-L1RSNP_L1Es_iAMPA_s(n-1,:))/p.L1RSNP_L1Es_iAMPA_tauAMPAr).*(1+tanh(L1Es_V(n-1,:)/10));
  L1Ed_L1RSNP_iGABA_s_k1= -L1Ed_L1RSNP_iGABA_s(n-1)./p.L1Ed_L1RSNP_iGABA_tauGABA + ((1-L1Ed_L1RSNP_iGABA_s(n-1))/p.L1Ed_L1RSNP_iGABA_tauGABAr).*(1+tanh(L1RSNP_V(n-1)/10));
  L1FS_L1FS_iGABA_s_k1= -L1FS_L1FS_iGABA_s(n-1)./p.L1FS_L1FS_iGABA_tauGABA + ((1-L1FS_L1FS_iGABA_s(n-1))/p.L1FS_L1FS_iGABA_tauGABAr).*(1+tanh(L1FS_V(n-1)/10));
  L1RSNP_L1RSNP_iGABA_s_k1= -L1RSNP_L1RSNP_iGABA_s(n-1)./p.L1RSNP_L1RSNP_iGABA_tauGABA + ((1-L1RSNP_L1RSNP_iGABA_s(n-1))/p.L1RSNP_L1RSNP_iGABA_tauGABAr).*(1+tanh(L1RSNP_V(n-1)/10));
  L1RSNP_L1FS_iGABA_s_k1= -L1RSNP_L1FS_iGABA_s(n-1)./p.L1RSNP_L1FS_iGABA_tauGABA + ((1-L1RSNP_L1FS_iGABA_s(n-1))/p.L1RSNP_L1FS_iGABA_tauGABAr).*(1+tanh(L1FS_V(n-1)/10));
  L1FS_L1RSNP_iGABA_s_k1= -L1FS_L1RSNP_iGABA_s(n-1)./p.L1FS_L1RSNP_iGABA_tauGABA + ((1-L1FS_L1RSNP_iGABA_s(n-1))/p.L1FS_L1RSNP_iGABA_tauGABAr).*(1+tanh(L1RSNP_V(n-1)/10));
  L2Ed_L2Es_iAMPA_s_k1= -L2Ed_L2Es_iAMPA_s(n-1,:)./p.L2Ed_L2Es_iAMPA_tauAMPA + ((1-L2Ed_L2Es_iAMPA_s(n-1,:))/p.L2Ed_L2Es_iAMPA_tauAMPAr).*(1+tanh(L2Es_V(n-1,:)/10));
  L2Ed_L2Es_iNMDA_s_k1= (( p.L2Ed_L2Es_iNMDA_Tmax./(1+exp(-(L2Es_V(n-1,:)-p.L2Ed_L2Es_iNMDA_Vpp)/p.L2Ed_L2Es_iNMDA_Kp)))).*(1-L2Ed_L2Es_iNMDA_s(n-1,:))/p.L2Ed_L2Es_iNMDA_tauNMDAr-L2Ed_L2Es_iNMDA_s(n-1,:)/p.L2Ed_L2Es_iNMDA_tauNMDA;
  L2FS_L2Es_iAMPA_s_k1= -L2FS_L2Es_iAMPA_s(n-1,:)./p.L2FS_L2Es_iAMPA_tauAMPA + ((1-L2FS_L2Es_iAMPA_s(n-1,:))/p.L2FS_L2Es_iAMPA_tauAMPAr).*(1+tanh(L2Es_V(n-1,:)/10));
  L2FS_L2Es_iNMDA_s_k1= (( p.L2FS_L2Es_iNMDA_Tmax./(1+exp(-(L2Es_V(n-1,:)-p.L2FS_L2Es_iNMDA_Vpp)/p.L2FS_L2Es_iNMDA_Kp)))).*(1-L2FS_L2Es_iNMDA_s(n-1,:))/p.L2FS_L2Es_iNMDA_tauNMDAr-L2FS_L2Es_iNMDA_s(n-1,:)/p.L2FS_L2Es_iNMDA_tauNMDA;
  L2Es_L2FS_iGABA_s_k1= -L2Es_L2FS_iGABA_s(n-1,:)./p.L2Es_L2FS_iGABA_tauGABA + ((1-L2Es_L2FS_iGABA_s(n-1,:))/p.L2Es_L2FS_iGABA_tauGABAr).*(1+tanh(L2FS_V(n-1,:)/10));
  L2FS_L2FS_iGABA_s_k1= -L2FS_L2FS_iGABA_s(n-1,:)./p.L2FS_L2FS_iGABA_tauGABA + ((1-L2FS_L2FS_iGABA_s(n-1,:))/p.L2FS_L2FS_iGABA_tauGABAr).*(1+tanh(L2FS_V(n-1,:)/10));
  L2Ed_L1Es_iAMPA_s_k1= -L2Ed_L1Es_iAMPA_s(n-1,:)./p.L2Ed_L1Es_iAMPA_tauAMPA + ((1-L2Ed_L1Es_iAMPA_s(n-1,:))/p.L2Ed_L1Es_iAMPA_tauAMPAr).*(1+tanh(L1Es_V(n-1,:)/10));
  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1Es_V(n,:)=L1Es_V(n-1,:)+dt*L1Es_V_k1;
  L1Es_DS00iNa_m(n,:)=L1Es_DS00iNa_m(n-1,:)+dt*L1Es_DS00iNa_m_k1;
  L1Es_DS00iNa_h(n,:)=L1Es_DS00iNa_h(n-1,:)+dt*L1Es_DS00iNa_h_k1;
  L1Es_DS00iNaP_m(n,:)=L1Es_DS00iNaP_m(n-1,:)+dt*L1Es_DS00iNaP_m_k1;
  L1Es_DS00iNaP_h(n,:)=L1Es_DS00iNaP_h(n-1,:)+dt*L1Es_DS00iNaP_h_k1;
  L1Es_DS00iDR_n(n,:)=L1Es_DS00iDR_n(n-1,:)+dt*L1Es_DS00iDR_n_k1;
  L1Es_DS02iKS_a(n,:)=L1Es_DS02iKS_a(n-1,:)+dt*L1Es_DS02iKS_a_k1;
  L1Es_DS02iKS_b(n,:)=L1Es_DS02iKS_b(n-1,:)+dt*L1Es_DS02iKS_b_k1;
  L1Es_DS02iHVA_u(n,:)=L1Es_DS02iHVA_u(n-1,:)+dt*L1Es_DS02iHVA_u_k1;
  L1Es_DS02iHVA_w(n,:)=L1Es_DS02iHVA_w(n-1,:)+dt*L1Es_DS02iHVA_w_k1;
  L1Es_DS00iKCa_c(n,:)=L1Es_DS00iKCa_c(n-1,:)+dt*L1Es_DS00iKCa_c_k1;
  L1Es_DS00CaDyn_cai(n,:)=L1Es_DS00CaDyn_cai(n-1,:)+dt*L1Es_DS00CaDyn_cai_k1;
  L1Es_DS00KDyn_ko(n,:)=L1Es_DS00KDyn_ko(n-1,:)+dt*L1Es_DS00KDyn_ko_k1;
  L1Es_TW03iH_m(n,:)=L1Es_TW03iH_m(n-1,:)+dt*L1Es_TW03iH_m_k1;
  L1Ed_V(n,:)=L1Ed_V(n-1,:)+dt*L1Ed_V_k1;
  L1Ed_DS00iNa_m(n,:)=L1Ed_DS00iNa_m(n-1,:)+dt*L1Ed_DS00iNa_m_k1;
  L1Ed_DS00iNa_h(n,:)=L1Ed_DS00iNa_h(n-1,:)+dt*L1Ed_DS00iNa_h_k1;
  L1Ed_DS00iNaP_m(n,:)=L1Ed_DS00iNaP_m(n-1,:)+dt*L1Ed_DS00iNaP_m_k1;
  L1Ed_DS00iNaP_h(n,:)=L1Ed_DS00iNaP_h(n-1,:)+dt*L1Ed_DS00iNaP_h_k1;
  L1Ed_DS00iDR_n(n,:)=L1Ed_DS00iDR_n(n-1,:)+dt*L1Ed_DS00iDR_n_k1;
  L1Ed_DS02iKS_a(n,:)=L1Ed_DS02iKS_a(n-1,:)+dt*L1Ed_DS02iKS_a_k1;
  L1Ed_DS02iKS_b(n,:)=L1Ed_DS02iKS_b(n-1,:)+dt*L1Ed_DS02iKS_b_k1;
  L1Ed_DS02iHVA_u(n,:)=L1Ed_DS02iHVA_u(n-1,:)+dt*L1Ed_DS02iHVA_u_k1;
  L1Ed_DS02iHVA_w(n,:)=L1Ed_DS02iHVA_w(n-1,:)+dt*L1Ed_DS02iHVA_w_k1;
  L1Ed_DS00iKCa_c(n,:)=L1Ed_DS00iKCa_c(n-1,:)+dt*L1Ed_DS00iKCa_c_k1;
  L1Ed_DS00CaDyn_cai(n,:)=L1Ed_DS00CaDyn_cai(n-1,:)+dt*L1Ed_DS00CaDyn_cai_k1;
  L1Ed_DS00KDyn_ko(n,:)=L1Ed_DS00KDyn_ko(n-1,:)+dt*L1Ed_DS00KDyn_ko_k1;
  L1Ed_TW03iH_m(n,:)=L1Ed_TW03iH_m(n-1,:)+dt*L1Ed_TW03iH_m_k1;
  L1FS_V(n)=L1FS_V(n-1)+dt*L1FS_V_k1;
  L1FS_DS00iNa_m(n)=L1FS_DS00iNa_m(n-1)+dt*L1FS_DS00iNa_m_k1;
  L1FS_DS00iNa_h(n)=L1FS_DS00iNa_h(n-1)+dt*L1FS_DS00iNa_h_k1;
  L1FS_DS00iDR_n(n)=L1FS_DS00iDR_n(n-1)+dt*L1FS_DS00iDR_n_k1;
  L1FS_DS00KDyn_ko(n)=L1FS_DS00KDyn_ko(n-1)+dt*L1FS_DS00KDyn_ko_k1;
  L1FS_TW03iH_m(n)=L1FS_TW03iH_m(n-1)+dt*L1FS_TW03iH_m_k1;
  L1RSNP_V(n)=L1RSNP_V(n-1)+dt*L1RSNP_V_k1;
  L1RSNP_DS00iNa_m(n)=L1RSNP_DS00iNa_m(n-1)+dt*L1RSNP_DS00iNa_m_k1;
  L1RSNP_DS00iNa_h(n)=L1RSNP_DS00iNa_h(n-1)+dt*L1RSNP_DS00iNa_h_k1;
  L1RSNP_DS00iDR_n(n)=L1RSNP_DS00iDR_n(n-1)+dt*L1RSNP_DS00iDR_n_k1;
  L1RSNP_DS00KDyn_ko(n)=L1RSNP_DS00KDyn_ko(n-1)+dt*L1RSNP_DS00KDyn_ko_k1;
  L1RSNP_TW03iH_m(n)=L1RSNP_TW03iH_m(n-1)+dt*L1RSNP_TW03iH_m_k1;
  L2Es_V(n,:)=L2Es_V(n-1,:)+dt*L2Es_V_k1;
  L2Es_DS00iNa_m(n,:)=L2Es_DS00iNa_m(n-1,:)+dt*L2Es_DS00iNa_m_k1;
  L2Es_DS00iNa_h(n,:)=L2Es_DS00iNa_h(n-1,:)+dt*L2Es_DS00iNa_h_k1;
  L2Es_DS00iNaP_m(n,:)=L2Es_DS00iNaP_m(n-1,:)+dt*L2Es_DS00iNaP_m_k1;
  L2Es_DS00iNaP_h(n,:)=L2Es_DS00iNaP_h(n-1,:)+dt*L2Es_DS00iNaP_h_k1;
  L2Es_DS00iDR_n(n,:)=L2Es_DS00iDR_n(n-1,:)+dt*L2Es_DS00iDR_n_k1;
  L2Es_DS02iKS_a(n,:)=L2Es_DS02iKS_a(n-1,:)+dt*L2Es_DS02iKS_a_k1;
  L2Es_DS02iKS_b(n,:)=L2Es_DS02iKS_b(n-1,:)+dt*L2Es_DS02iKS_b_k1;
  L2Es_DS02iHVA_u(n,:)=L2Es_DS02iHVA_u(n-1,:)+dt*L2Es_DS02iHVA_u_k1;
  L2Es_DS02iHVA_w(n,:)=L2Es_DS02iHVA_w(n-1,:)+dt*L2Es_DS02iHVA_w_k1;
  L2Es_DS00iKCa_c(n,:)=L2Es_DS00iKCa_c(n-1,:)+dt*L2Es_DS00iKCa_c_k1;
  L2Es_DS00CaDyn_cai(n,:)=L2Es_DS00CaDyn_cai(n-1,:)+dt*L2Es_DS00CaDyn_cai_k1;
  L2Es_DS00KDyn_ko(n,:)=L2Es_DS00KDyn_ko(n-1,:)+dt*L2Es_DS00KDyn_ko_k1;
  L2Es_TW03iH_m(n,:)=L2Es_TW03iH_m(n-1,:)+dt*L2Es_TW03iH_m_k1;
  L2Ed_V(n,:)=L2Ed_V(n-1,:)+dt*L2Ed_V_k1;
  L2Ed_DS00iNa_m(n,:)=L2Ed_DS00iNa_m(n-1,:)+dt*L2Ed_DS00iNa_m_k1;
  L2Ed_DS00iNa_h(n,:)=L2Ed_DS00iNa_h(n-1,:)+dt*L2Ed_DS00iNa_h_k1;
  L2Ed_DS00iNaP_m(n,:)=L2Ed_DS00iNaP_m(n-1,:)+dt*L2Ed_DS00iNaP_m_k1;
  L2Ed_DS00iNaP_h(n,:)=L2Ed_DS00iNaP_h(n-1,:)+dt*L2Ed_DS00iNaP_h_k1;
  L2Ed_DS00iDR_n(n,:)=L2Ed_DS00iDR_n(n-1,:)+dt*L2Ed_DS00iDR_n_k1;
  L2Ed_DS02iKS_a(n,:)=L2Ed_DS02iKS_a(n-1,:)+dt*L2Ed_DS02iKS_a_k1;
  L2Ed_DS02iKS_b(n,:)=L2Ed_DS02iKS_b(n-1,:)+dt*L2Ed_DS02iKS_b_k1;
  L2Ed_DS02iHVA_u(n,:)=L2Ed_DS02iHVA_u(n-1,:)+dt*L2Ed_DS02iHVA_u_k1;
  L2Ed_DS02iHVA_w(n,:)=L2Ed_DS02iHVA_w(n-1,:)+dt*L2Ed_DS02iHVA_w_k1;
  L2Ed_DS00iKCa_c(n,:)=L2Ed_DS00iKCa_c(n-1,:)+dt*L2Ed_DS00iKCa_c_k1;
  L2Ed_DS00CaDyn_cai(n,:)=L2Ed_DS00CaDyn_cai(n-1,:)+dt*L2Ed_DS00CaDyn_cai_k1;
  L2Ed_DS00KDyn_ko(n,:)=L2Ed_DS00KDyn_ko(n-1,:)+dt*L2Ed_DS00KDyn_ko_k1;
  L2Ed_TW03iH_m(n,:)=L2Ed_TW03iH_m(n-1,:)+dt*L2Ed_TW03iH_m_k1;
  L2FS_V(n,:)=L2FS_V(n-1,:)+dt*L2FS_V_k1;
  L2FS_DS00iNa_m(n,:)=L2FS_DS00iNa_m(n-1,:)+dt*L2FS_DS00iNa_m_k1;
  L2FS_DS00iNa_h(n,:)=L2FS_DS00iNa_h(n-1,:)+dt*L2FS_DS00iNa_h_k1;
  L2FS_DS00iDR_n(n,:)=L2FS_DS00iDR_n(n-1,:)+dt*L2FS_DS00iDR_n_k1;
  L2FS_DS00KDyn_ko(n,:)=L2FS_DS00KDyn_ko(n-1,:)+dt*L2FS_DS00KDyn_ko_k1;
  L2FS_TW03iH_m(n,:)=L2FS_TW03iH_m(n-1,:)+dt*L2FS_TW03iH_m_k1;
  L1Ed_L1Es_iAMPA_s(n,:)=L1Ed_L1Es_iAMPA_s(n-1,:)+dt*L1Ed_L1Es_iAMPA_s_k1;
  L1Ed_L1Es_iNMDA_s(n,:)=L1Ed_L1Es_iNMDA_s(n-1,:)+dt*L1Ed_L1Es_iNMDA_s_k1;
  L1FS_L1Es_iAMPA_s(n,:)=L1FS_L1Es_iAMPA_s(n-1,:)+dt*L1FS_L1Es_iAMPA_s_k1;
  L1FS_L1Es_iNMDA_s(n,:)=L1FS_L1Es_iNMDA_s(n-1,:)+dt*L1FS_L1Es_iNMDA_s_k1;
  L1Es_L1FS_iGABA_s(n)=L1Es_L1FS_iGABA_s(n-1)+dt*L1Es_L1FS_iGABA_s_k1;
  L1RSNP_L1Es_iAMPA_s(n,:)=L1RSNP_L1Es_iAMPA_s(n-1,:)+dt*L1RSNP_L1Es_iAMPA_s_k1;
  L1Ed_L1RSNP_iGABA_s(n)=L1Ed_L1RSNP_iGABA_s(n-1)+dt*L1Ed_L1RSNP_iGABA_s_k1;
  L1FS_L1FS_iGABA_s(n)=L1FS_L1FS_iGABA_s(n-1)+dt*L1FS_L1FS_iGABA_s_k1;
  L1RSNP_L1RSNP_iGABA_s(n)=L1RSNP_L1RSNP_iGABA_s(n-1)+dt*L1RSNP_L1RSNP_iGABA_s_k1;
  L1RSNP_L1FS_iGABA_s(n)=L1RSNP_L1FS_iGABA_s(n-1)+dt*L1RSNP_L1FS_iGABA_s_k1;
  L1FS_L1RSNP_iGABA_s(n)=L1FS_L1RSNP_iGABA_s(n-1)+dt*L1FS_L1RSNP_iGABA_s_k1;
  L2Ed_L2Es_iAMPA_s(n,:)=L2Ed_L2Es_iAMPA_s(n-1,:)+dt*L2Ed_L2Es_iAMPA_s_k1;
  L2Ed_L2Es_iNMDA_s(n,:)=L2Ed_L2Es_iNMDA_s(n-1,:)+dt*L2Ed_L2Es_iNMDA_s_k1;
  L2FS_L2Es_iAMPA_s(n,:)=L2FS_L2Es_iAMPA_s(n-1,:)+dt*L2FS_L2Es_iAMPA_s_k1;
  L2FS_L2Es_iNMDA_s(n,:)=L2FS_L2Es_iNMDA_s(n-1,:)+dt*L2FS_L2Es_iNMDA_s_k1;
  L2Es_L2FS_iGABA_s(n,:)=L2Es_L2FS_iGABA_s(n-1,:)+dt*L2Es_L2FS_iGABA_s_k1;
  L2FS_L2FS_iGABA_s(n,:)=L2FS_L2FS_iGABA_s(n-1,:)+dt*L2FS_L2FS_iGABA_s_k1;
  L2Ed_L1Es_iAMPA_s(n,:)=L2Ed_L1Es_iAMPA_s(n-1,:)+dt*L2Ed_L1Es_iAMPA_s_k1;
  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1Ed_input(n,:)=((-p.L1Ed_gAMPA.*L1Ed_sAMPA(k,:).*(L1Ed_V(n,:)-p.L1Ed_EAMPA)));
  L1Ed_L1Es_iAMPA_IAMPA(n,:)=(p.L1Ed_L1Es_iAMPA_gAMPA.*(L1Ed_L1Es_iAMPA_s(n,:)*L1Ed_L1Es_iAMPA_netcon).*(L1Ed_V(n,:)-p.L1Ed_L1Es_iAMPA_EAMPA));
  L1Ed_L1Es_iNMDA_BMg(n,:)=(1.50265./(1+0.33*exp(L1Ed_V(n,:)./(-16))));
  L1Ed_L1Es_iNMDA_INMDA(n,:)=p.L1Ed_L1Es_iNMDA_gNMDA.*(( (1.50265./(1+0.33*exp(L1Ed_V(n,:)./(-16)))))).*(L1Ed_L1Es_iNMDA_s(n,:)*L1Ed_L1Es_iNMDA_netcon).*(L1Ed_V(n,:)-p.L1Ed_L1Es_iNMDA_ENMDA);
  L1Ed_L1Es_iNMDA_NT(n,:)=p.L1Ed_L1Es_iNMDA_Tmax./(1+exp(-(L1Ed_V(n,:)-p.L1Ed_L1Es_iNMDA_Vpp)/p.L1Ed_L1Es_iNMDA_Kp));
  L1Ed_L1RSNP_iGABA_IGABA(n,:)=(p.L1Ed_L1RSNP_iGABA_gGABA.*(L1Ed_L1RSNP_iGABA_s(n,:)*L1Ed_L1RSNP_iGABA_netcon).*(L1Ed_V(n,:)-p.L1Ed_L1RSNP_iGABA_EGABA));
  L1Es_L1FS_iGABA_IGABA(n,:)=(p.L1Es_L1FS_iGABA_gGABA.*(L1Es_L1FS_iGABA_s(n,:)*L1Es_L1FS_iGABA_netcon).*(L1Es_V(n,:)-p.L1Es_L1FS_iGABA_EGABA));
  L1FS_L1Es_iAMPA_IAMPA(n,:)=(p.L1FS_L1Es_iAMPA_gAMPA.*(L1FS_L1Es_iAMPA_s(n,:)*L1FS_L1Es_iAMPA_netcon).*(L1FS_V(n,:)-p.L1FS_L1Es_iAMPA_EAMPA));
  L1FS_L1Es_iNMDA_BMg(n,:)=(1.50265./(1+0.33*exp(L1FS_V(n,:)./(-16))));
  L1FS_L1Es_iNMDA_INMDA(n,:)=p.L1FS_L1Es_iNMDA_gNMDA.*(( (1.50265./(1+0.33*exp(L1FS_V(n,:)./(-16)))))).*(L1FS_L1Es_iNMDA_s(n,:)*L1FS_L1Es_iNMDA_netcon).*(L1FS_V(n,:)-p.L1FS_L1Es_iNMDA_ENMDA);
  L1FS_L1Es_iNMDA_NT(n,:)=p.L1FS_L1Es_iNMDA_Tmax./(1+exp(-(L1FS_V(n,:)-p.L1FS_L1Es_iNMDA_Vpp)/p.L1FS_L1Es_iNMDA_Kp));
  L1FS_L1FS_iGABA_IGABA(n,:)=(p.L1FS_L1FS_iGABA_gGABA.*(L1FS_L1FS_iGABA_s(n,:)*L1FS_L1FS_iGABA_netcon).*(L1FS_V(n,:)-p.L1FS_L1FS_iGABA_EGABA));
  L1FS_L1RSNP_iGABA_IGABA(n,:)=(p.L1FS_L1RSNP_iGABA_gGABA.*(L1FS_L1RSNP_iGABA_s(n,:)*L1FS_L1RSNP_iGABA_netcon).*(L1FS_V(n,:)-p.L1FS_L1RSNP_iGABA_EGABA));
  L1RSNP_L1Es_iAMPA_IAMPA(n,:)=(p.L1RSNP_L1Es_iAMPA_gAMPA.*(L1RSNP_L1Es_iAMPA_s(n,:)*L1RSNP_L1Es_iAMPA_netcon).*(L1RSNP_V(n,:)-p.L1RSNP_L1Es_iAMPA_EAMPA));
  L1RSNP_L1FS_iGABA_IGABA(n,:)=(p.L1RSNP_L1FS_iGABA_gGABA.*(L1RSNP_L1FS_iGABA_s(n,:)*L1RSNP_L1FS_iGABA_netcon).*(L1RSNP_V(n,:)-p.L1RSNP_L1FS_iGABA_EGABA));
  L1RSNP_L1RSNP_iGABA_IGABA(n,:)=(p.L1RSNP_L1RSNP_iGABA_gGABA.*(L1RSNP_L1RSNP_iGABA_s(n,:)*L1RSNP_L1RSNP_iGABA_netcon).*(L1RSNP_V(n,:)-p.L1RSNP_L1RSNP_iGABA_EGABA));
  L2Ed_L1Es_iAMPA_IAMPA(n,:)=(p.L2Ed_L1Es_iAMPA_gAMPA.*(L2Ed_L1Es_iAMPA_s(n,:)*L2Ed_L1Es_iAMPA_netcon).*(L2Ed_V(n,:)-p.L2Ed_L1Es_iAMPA_EAMPA));
  L2Ed_L2Es_iAMPA_IAMPA(n,:)=(p.L2Ed_L2Es_iAMPA_gAMPA.*(L2Ed_L2Es_iAMPA_s(n,:)*L2Ed_L2Es_iAMPA_netcon).*(L2Ed_V(n,:)-p.L2Ed_L2Es_iAMPA_EAMPA));
  L2Ed_L2Es_iNMDA_BMg(n,:)=(1.50265./(1+0.33*exp(L2Ed_V(n,:)./(-16))));
  L2Ed_L2Es_iNMDA_INMDA(n,:)=p.L2Ed_L2Es_iNMDA_gNMDA.*(( (1.50265./(1+0.33*exp(L2Ed_V(n,:)./(-16)))))).*(L2Ed_L2Es_iNMDA_s(n,:)*L2Ed_L2Es_iNMDA_netcon).*(L2Ed_V(n,:)-p.L2Ed_L2Es_iNMDA_ENMDA);
  L2Ed_L2Es_iNMDA_NT(n,:)=p.L2Ed_L2Es_iNMDA_Tmax./(1+exp(-(L2Ed_V(n,:)-p.L2Ed_L2Es_iNMDA_Vpp)/p.L2Ed_L2Es_iNMDA_Kp));
  L2Es_L2FS_iGABA_IGABA(n,:)=(p.L2Es_L2FS_iGABA_gGABA.*(L2Es_L2FS_iGABA_s(n,:)*L2Es_L2FS_iGABA_netcon).*(L2Es_V(n,:)-p.L2Es_L2FS_iGABA_EGABA));
  L2FS_L2Es_iAMPA_IAMPA(n,:)=(p.L2FS_L2Es_iAMPA_gAMPA.*(L2FS_L2Es_iAMPA_s(n,:)*L2FS_L2Es_iAMPA_netcon).*(L2FS_V(n,:)-p.L2FS_L2Es_iAMPA_EAMPA));
  L2FS_L2Es_iNMDA_BMg(n,:)=(1.50265./(1+0.33*exp(L2FS_V(n,:)./(-16))));
  L2FS_L2Es_iNMDA_INMDA(n,:)=p.L2FS_L2Es_iNMDA_gNMDA.*(( (1.50265./(1+0.33*exp(L2FS_V(n,:)./(-16)))))).*(L2FS_L2Es_iNMDA_s(n,:)*L2FS_L2Es_iNMDA_netcon).*(L2FS_V(n,:)-p.L2FS_L2Es_iNMDA_ENMDA);
  L2FS_L2Es_iNMDA_NT(n,:)=p.L2FS_L2Es_iNMDA_Tmax./(1+exp(-(L2FS_V(n,:)-p.L2FS_L2Es_iNMDA_Vpp)/p.L2FS_L2Es_iNMDA_Kp));
  L2FS_L2FS_iGABA_IGABA(n,:)=(p.L2FS_L2FS_iGABA_gGABA.*(L2FS_L2FS_iGABA_s(n,:)*L2FS_L2FS_iGABA_netcon).*(L2FS_V(n,:)-p.L2FS_L2FS_iGABA_EGABA));
  n=n+1;
end
T=T(1:downsample_factor:ntime);
